<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="VendorMaster">

	<insert id="insertVendor" parameterClass="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		<selectKey resultClass="int" type="pre" keyProperty="vendorMasterId">
			SELECT CMS_VENDORMASTER_SEQ.nextval AS VALUE FROM DUAL
		</selectKey>
		insert into CMS_VENDOR_MASTER
		(
		VENDOR_MASTER_ID,VENDOR_CODE,VENDOR_NAME,
		IS_VSBL_TO_ANLST,CLASSIFICATION,PRINCIPLE_CNTRY_ID,
		EXPERTISE,COSTS,COMMENTS,CONTACT_NAME,PHONE1,
		PHONE2,EMAIL1,EMAIL2,FAX,CREATED_DATE,
		CONTRACT_EXPIRE_DATE,ADDRESS,STATUS,
		LEGACY_VENDOR_CODE,VENDOR_TYPE_ID,
		UPDATED_BY,UPDATED_ON
		)
		values
		(
		#vendorMasterId#,
		 <!-- Script to generate VENDOR_CODE -->
		 <!--
		 	VENDOR_CODE = 'V' 
		 		+ CODE for the Principal Country 
		 		+ First letter of the Vendor Name 
		 		+ The next number in the sequence for the first letter of Vendor Name left padded with 0s to make it 5 digits long
		  -->
		(
			'V' 
			|| UPPER((SELECT CM.CODE FROM CMS_COUNTRY_MASTER CM WHERE CM.COUNTRY_MASTER_ID = #principleCountryId#)) 
			|| UPPER(SUBSTR(#vendorName#, 1, 1)) 
			|| LPAD(
				NVL((
					SELECT TO_NUMBER(MAX(SUBSTR(VM.VENDOR_CODE, 6))) + 1 
					FROM CMS_VENDOR_MASTER VM 
					WHERE UPPER(SUBSTR(#vendorName#, 1, 1)) = UPPER(SUBSTR(VM.VENDOR_NAME, 1, 1))),'00001'), 
				5, '0')
		),
		#vendorName#,#allowAnalystToView#,
		#vendorClassification#,#principleCountryId#,#expertise#,
		#costs#,#comments#,#contactName#,#phone1#,#phone2#,
		#email1#,#email2#,#fax#,SYSDATE,
		<isNotNull property="contractExpiry">
			<isNotEmpty property="contractExpiry">
				TO_DATE(#contractExpiry#, 'DD Mon YYYY'),
			</isNotEmpty>
			<isEmpty property="contractExpiry">
				NULL,
			</isEmpty>
		</isNotNull>
		<isNull property="contractExpiry">
			NULL,
		</isNull>
		#address#,1,#legacyVendorCode#,#vendorTypeId#,
		#updatedBy#,SYSDATE
		)
	</insert>

	<update id="updateVendor" parameterClass="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		UPDATE CMS_VENDOR_MASTER
		SET VENDOR_NAME = #vendorName#,
		IS_VSBL_TO_ANLST = #allowAnalystToView#,
		CLASSIFICATION = #vendorClassification#,
		PRINCIPLE_CNTRY_ID = #principleCountryId#,
		EXPERTISE = #expertise#,
		COSTS = #costs#,
		COMMENTS = #comments#,
		CONTACT_NAME = #contactName#,
		PHONE1 = #phone1#,
		PHONE2 = #phone2#,
		EMAIL1 = #email1#,
		EMAIL2 = #email2#,
		FAX = #fax#,
		CONTRACT_EXPIRE_DATE = 
		<isNotNull property="contractExpiry">
			<isNotEmpty property="contractExpiry">
				TO_DATE(#contractExpiry#, 'DD Mon YYYY'),
			</isNotEmpty>
			<isEmpty property="contractExpiry">
				NULL,
			</isEmpty>
		</isNotNull>
		<isNull property="contractExpiry">
			NULL,
		</isNull>
		ADDRESS = #address#,
		STATUS = #vendorStatusId#,
		LEGACY_VENDOR_CODE = #legacyVendorCode#,
		VENDOR_TYPE_ID = #vendorTypeId#,
		UPDATED_BY = #updatedBy#,
		UPDATED_ON = SYSDATE
		WHERE VENDOR_MASTER_ID = #vendorMasterId#
	</update>
	
	<delete id="deleteVendorCountryMapping" parameterClass="java.lang.Integer">
		DELETE FROM CMS_VENDOR_CNTRY_MAP
		WHERE VENDOR_ID = #vendorMasterId#
	</delete>
	
	<insert id="insertVendorCountryMapping" parameterClass="java.util.Map">
		<selectKey resultClass="int" type="pre" keyProperty="vendorCntryMapId">
			SELECT CMS_VENDOR_CNTRY_MAP_SEQ.nextval AS VALUE FROM DUAL
		</selectKey>
		INSERT INTO CMS_VENDOR_CNTRY_MAP
		(
			VENDOR_CNTRY_MAP_ID, VENDOR_ID, COUNTRY_ID, UPDATED_BY, UPDATED_ON
		)
		VALUES
		(
			#vendorCntryMapId#, #vendorMasterId#, #countryId#, #updatedBy#, SYSDATE
		)
	</insert>
	
	<select id="getVendorInfo" parameterClass="java.lang.String" resultClass="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		SELECT 
		VENDOR_MASTER_ID vendorMasterId,
		VENDOR_CODE vendorCode,
		VENDOR_NAME vendorName, 
		VENDOR_TYPE_ID vendorTypeId,
		CONTACT_NAME contactName,
		EXPERTISE expertise,
		LEGACY_VENDOR_CODE legacyVendorCode,
		STATUS vendorStatusId,
		IS_VSBL_TO_ANLST allowAnalystToView,
		CLASSIFICATION vendorClassification,
		PRINCIPLE_CNTRY_ID principleCountryId,
		TO_CHAR(CONTRACT_EXPIRE_DATE, 'DD Mon YYYY') contractExpiry,
		COSTS costs,
		COMMENTS comments,
		EMAIL1 email1,
		EMAIL2 email2,
		PHONE1 phone1,
		PHONE2 phone2,
		FAX fax,
		ADDRESS address
		FROM CMS_VENDOR_MASTER
		WHERE VENDOR_MASTER_ID = #vendorMasterId#
	</select>
	
	<select id="getVendorCountryList" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT VCM.COUNTRY_ID
		FROM CMS_VENDOR_CNTRY_MAP VCM
		WHERE VCM.VENDOR_ID = #vendorMasterId#
		<!-- AND VM.VENDOR_CODE = #vendorCode# -->
	</select>
	
	<select id="selectVendorType" resultClass="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		SELECT VENDOR_TYPE_ID "vendorTypeId", VENDOR_TYPE "vendorType" 
		FROM CMS_VENDOR_TYPE
	</select>

	<resultMap id="resultVendorMasterVO" class="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		<result property="vendorMasterId" column="VENDOR_MASTER_ID" />
		<result property="vendorCode" column="vendorCode" />
		<result property="vendorName" column="vendorName" />
		<result property="vendorType" column="vendorType" />
		<result property="vendorClassification" column="vendorClassification" />
		<result property="expertise" column="EXPERTISE" />
		<result property="country" column="COUNTRY" />
		<result property="comments" column="COMMENTS" />
		<result property="ndaExists" column="NDAEXISTS" />
		<result property="contractExists" column="CONTRACTEXISTS" />
	</resultMap>
	
	<select id="searchVendor" parameterClass="java.util.Map" resultMap="resultVendorMasterVO">
		SELECT * FROM (SELECT  searchResult.*, ROWNUM rn FROM (SELECT a.*, NVL(b.ndaExists, 'N') ndaExists, NVL(b.contractExists, 'N') contractExists
		FROM
		(
			(
				SELECT
				VM.VENDOR_MASTER_ID,
				VM.VENDOR_CODE vendorCode,
				VM.VENDOR_NAME vendorName,
				VMT.VENDOR_TYPE vendorType,
				VM.CLASSIFICATION vendorClassification,
				VM.EXPERTISE,
				CM.COUNTRY,
				VM.COMMENTS
				FROM
				CMS_VENDOR_MASTER VM,
				CMS_VENDOR_TYPE VMT,
				CMS_VENDOR_CNTRY_MAP VCM,
				CMS_COUNTRY_MASTER CM
				WHERE
				VMT.VENDOR_TYPE_ID(+) = VM.VENDOR_TYPE_ID
				AND VCM.VENDOR_ID = VM.VENDOR_MASTER_ID
				AND VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
				AND VM.STATUS = #vendorStatus#
				<isNotNull prepend="AND" property="vendorTypeId">
					<isNotEmpty property="vendorTypeId">
						VM.VENDOR_TYPE_ID = #vendorTypeId#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="countryList">
					<isNotEmpty property="countryList">
						CM.COUNTRY_MASTER_ID IN
						<iterate property="countryList" open="(" close=")" conjunction=",">
							#countryList[]#
						</iterate>
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorCode">
					<isNotEmpty property="vendorCode">
						VM.VENDOR_CODE = #vendorCode#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorName">
					<isNotEmpty property="vendorName">
						UPPER(VM.VENDOR_NAME) LIKE '%' || UPPER(#vendorName#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryStart">
					<isNotEmpty property="contractExpiryStart">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &gt;= TO_DATE(#contractExpiryStart#, 'YYYY-MM-DD')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryEnd">
					<isNotEmpty property="contractExpiryEnd">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &lt;= TO_DATE(#contractExpiryEnd#, 'YYYY-MM-DD')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="expertise">
					<isNotEmpty property="expertise">
						UPPER(VM.EXPERTISE) LIKE '%' || UPPER(#expertise#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="comments">
					<isNotEmpty property="comments">
						UPPER(VM.COMMENTS) LIKE '%' || UPPER(#comments#) || '%'
					</isNotEmpty>
				</isNotNull>
			) a LEFT JOIN
			(
				SELECT 
				VUM.VENDOR_MASTER_ID,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 1) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) ndaExists,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 0) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) contractExists
				FROM 
				CMS_VNDR_UPLOAD_MASTER VUM,
				CMS_VENDOR_MASTER VM
				WHERE 
				VUM.VENDOR_MASTER_ID = VM.VENDOR_MASTER_ID
				GROUP BY VUM.VENDOR_MASTER_ID
			) b
			ON a.VENDOR_MASTER_ID = b.VENDOR_MASTER_ID
		)
		ORDER BY upper($sort$) $dir$) searchResult WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#	 
	</select>

	<select id="getTotalCount" parameterClass="java.util.Map" resultClass="int">
		SELECT count(*)
		FROM
		(
			(
				SELECT
				VM.VENDOR_MASTER_ID,
				VM.VENDOR_CODE,
				VM.VENDOR_NAME ,
				VMT.VENDOR_TYPE,
				VM.CLASSIFICATION,
				VM.EXPERTISE,
				CM.COUNTRY,
				VM.COMMENTS
				FROM
				CMS_VENDOR_MASTER VM,
				CMS_VENDOR_TYPE VMT,
				CMS_VENDOR_CNTRY_MAP VCM,
				CMS_COUNTRY_MASTER CM
				WHERE
				VMT.VENDOR_TYPE_ID(+) = VM.VENDOR_TYPE_ID
				AND VCM.VENDOR_ID = VM.VENDOR_MASTER_ID
				AND VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
				AND VM.STATUS = #vendorStatus#
				<isNotNull prepend="AND" property="vendorTypeId">
					<isNotEmpty property="vendorTypeId">
						VM.VENDOR_TYPE_ID = #vendorTypeId#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="countryList">
					<isNotEmpty property="countryList">
						CM.COUNTRY_MASTER_ID IN
						<iterate property="countryList" open="(" close=")" conjunction=",">
							#countryList[]#
						</iterate>
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorCode">
					<isNotEmpty property="vendorCode">
						VM.VENDOR_CODE=#vendorCode#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorName">
					<isNotEmpty property="vendorName">
						UPPER(VM.VENDOR_NAME) LIKE '%' || UPPER(#vendorName#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryStart">
					<isNotEmpty property="contractExpiryStart">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &gt;= TO_DATE(#contractExpiryStart#, 'YYYY-MM-DD')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryEnd">
					<isNotEmpty property="contractExpiryEnd">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &lt;= TO_DATE(#contractExpiryEnd#, 'YYYY-MM-DD')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="expertise">
					<isNotEmpty property="expertise">
						UPPER(VM.EXPERTISE) LIKE '%' || UPPER(#expertise#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="comments">
					<isNotEmpty property="comments">
						UPPER(VM.COMMENTS) LIKE '%' || UPPER(#comments#) || '%'
					</isNotEmpty>
				</isNotNull>
			) a LEFT JOIN
			(
				SELECT 
				VUM.VENDOR_MASTER_ID,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 1) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) ndaExists,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 0) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) contractExists
				FROM 
				CMS_VNDR_UPLOAD_MASTER VUM,
				CMS_VENDOR_MASTER VM
				WHERE 
				VUM.VENDOR_MASTER_ID = VM.VENDOR_MASTER_ID
				GROUP BY VUM.VENDOR_MASTER_ID
			) b
			ON a.VENDOR_MASTER_ID = b.VENDOR_MASTER_ID
		)
	</select>
	
	<select id="getDataForExport" parameterClass="java.util.Map" resultClass="com.worldcheck.atlas.vo.masters.VendorMasterVO">
		SELECT a.*, NVL(b.ndaExists, 'N') ndaExists, NVL(b.contractExists, 'N') contractExists
		FROM
		(
			(
				SELECT
				VM.VENDOR_MASTER_ID vendorMasterId,
				VM.VENDOR_CODE vendorCode,
				VM.VENDOR_NAME vendorName,
				VMT.VENDOR_TYPE vendorType,
				VM.CLASSIFICATION vendorClassification,
				CM.COUNTRY country,
				VM.EXPERTISE expertise,
				VM.COSTS costs,
				VM.COMMENTS comments,
				VM.CONTACT_NAME contactName,
				VM.EMAIL1 email1,
				VM.EMAIL2 email2,
				VM.PHONE1 phone1,
				VM.PHONE2 phone2,
				VM.FAX fax, 
				VM.ADDRESS address,
				TO_CHAR(VM.CONTRACT_EXPIRE_DATE, 'DD Mon YYYY') contractExpiry,
				VM.LEGACY_VENDOR_CODE legacyVendorCode,
				VM.STATUS vendorStatusId
				FROM
				CMS_VENDOR_MASTER VM,
				CMS_VENDOR_TYPE VMT,
				CMS_VENDOR_CNTRY_MAP VCM,
				CMS_COUNTRY_MASTER CM
				WHERE
				VMT.VENDOR_TYPE_ID(+) = VM.VENDOR_TYPE_ID
				AND VCM.VENDOR_ID = VM.VENDOR_MASTER_ID
				AND VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
				AND VM.STATUS = #vendorStatus#
				<isNotNull prepend="AND" property="vendorTypeId">
					<isNotEmpty property="vendorTypeId">
						VM.VENDOR_TYPE_ID = #vendorTypeId#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="countryList">
					<isNotEmpty property="countryList">
						CM.COUNTRY_MASTER_ID IN
						<iterate property="countryList" open="(" close=")" conjunction=",">
							#countryList[]#
						</iterate>
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorCode">
					<isNotEmpty property="vendorCode">
						VM.VENDOR_CODE=#vendorCode#
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="vendorName">
					<isNotEmpty property="vendorName">
						UPPER(VM.VENDOR_NAME) LIKE '%' || UPPER(#vendorName#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryStart">
					<isNotEmpty property="contractExpiryStart">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &gt;= TO_DATE(#contractExpiryStart#, 'DD Mon YYYY')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="contractExpiryEnd">
					<isNotEmpty property="contractExpiryEnd">
						TRUNC(VM.CONTRACT_EXPIRE_DATE) &lt;= TO_DATE(#contractExpiryEnd#, 'DD Mon YYYY')
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="expertise">
					<isNotEmpty property="expertise">
						UPPER(VM.EXPERTISE) LIKE '%' || UPPER(#expertise#) || '%'
					</isNotEmpty>
				</isNotNull>
				<isNotNull prepend="AND" property="comments">
					<isNotEmpty property="comments">
						UPPER(VM.COMMENTS) LIKE '%' || UPPER(#comments#) || '%'
					</isNotEmpty>
				</isNotNull>
			) a LEFT JOIN
			(
				SELECT 
				VUM.VENDOR_MASTER_ID vendorMasterId,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 1) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) ndaExists,
				(CASE WHEN (SUM((CASE WHEN (VUM.ISNDA = 0) THEN '1' ELSE '0' END))) > 0 THEN 'Y' ELSE 'N' END) contractExists
				FROM 
				CMS_VNDR_UPLOAD_MASTER VUM,
				CMS_VENDOR_MASTER VM
				WHERE 
				VUM.VENDOR_MASTER_ID = VM.VENDOR_MASTER_ID
				GROUP BY VUM.VENDOR_MASTER_ID
			) b
			ON a.vendorMasterId = b.vendorMasterId
		)
		ORDER BY a.vendorCode ASC
	</select>
	
	<update id="changeVendorStatus" parameterClass="java.util.Map">
		UPDATE CMS_VENDOR_MASTER
		SET CMS_VENDOR_MASTER.STATUS =
		<isEqual property="vendorStatus" compareValue="0">
			1,
		</isEqual>
		<isEqual property="vendorStatus" compareValue="1">
			0,
		</isEqual>
		CMS_VENDOR_MASTER.UPDATED_BY = #updatedBy#,
		CMS_VENDOR_MASTER.UPDATED_ON = SYSDATE
		WHERE CMS_VENDOR_MASTER.VENDOR_MASTER_ID = #selectedVendorId#
	</update>

	<select id="getAssociatedWIPCases" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT
	    CC.CRN
	    FROM
	    CMS_CLIENTCASE CC,
		CMS_VENDOR_INVOICE VI
	    WHERE
	    CC.CRN = VI.CRN
		AND CC.CASE_STATUS_ID IN (1, 2, 3) <!-- Check for On Hold, New Case or Work In Progress cases -->
		AND VI.VENDOR_ID = #selectedVendorId#
	</select>
		
	<insert id="addVendorUpload" parameterClass="com.worldcheck.atlas.vo.masters.VendorUploadMasterVO">
		<selectKey resultClass="int" type="pre" keyProperty="vendorUploadId">
			SELECT CMS_VNDRUPLOADMASTER_SEQ.nextval AS VALUE FROM DUAL
		</selectKey>
		insert into CMS_VNDR_UPLOAD_MASTER
		(
			VNDRUPLOAD_ID,VENDOR_MASTER_ID,UPLOADED_BY,
			ISNDA,FILE_NAME,UPLOAD_TIME
		)
		values
		(
			#vendorUploadId#,
			(SELECT VM.VENDOR_MASTER_ID FROM CMS_VENDOR_MASTER VM WHERE VM.VENDOR_CODE = #vendorCode#),
			#uploadedBy#,#isNda#,#fileName#,TO_DATE(#uploadedOn#, 'DD Mon YYYY hh24:mi:ss')
		)
	</insert>
	
	<select id="getVendorUploads" parameterClass="java.util.Map" resultClass="com.worldcheck.atlas.vo.masters.VendorUploadMasterVO">
		SELECT 
		FILE_NAME fileName,
		DECODE(ISNDA, '1', 'NDA', 'Contract') fileType,
		UPLOADED_BY uploadedBy,
		TO_CHAR(UPLOAD_TIME, 'DD Mon YYYY hh24:mi:ss') uploadedOn
		FROM 
		CMS_VNDR_UPLOAD_MASTER
		WHERE
		VENDOR_MASTER_ID = (SELECT VENDOR_MASTER_ID FROM CMS_VENDOR_MASTER WHERE VENDOR_CODE = #vendorCode#)
		ORDER BY fileType ASC, UPPER(fileName) ASC
	</select>
	
	<delete id="deleteVendorUploads" parameterClass="java.util.Map">
		DELETE FROM CMS_VNDR_UPLOAD_MASTER
		WHERE
		VENDOR_MASTER_ID = (SELECT VENDOR_MASTER_ID FROM CMS_VENDOR_MASTER WHERE VENDOR_CODE = #vendorCode#)
		AND
		FILE_NAME 
		<iterate prepend="IN" property="vendorFileNames" open="(" close=")" conjunction=",">
			#vendorFileNames[]#
		</iterate>
	</delete>
	
	<select id="vendorExists" parameterClass="java.util.Map" resultClass="java.lang.String">
		SELECT VENDOR_CODE FROM CMS_VENDOR_MASTER WHERE VENDOR_NAME = #vendorName#
	</select>
	
	<resultMap id="resultCountryMasterVO" class="com.worldcheck.atlas.vo.masters.CountryMasterVO">
	    <result property="countryMasterId" column="COUNTRY_MASTER_ID"/>
	    <result property="country" column="COUNTRY"/>
	</resultMap>
	
	<select id="getAllCountries" resultMap="resultCountryMasterVO" parameterClass="java.util.Map">
		SELECT * FROM
		(
			SELECT COUNTRY_MASTER_ID,COUNTRY 
			FROM DW_TOP10_COUNTRY 
			<isNotNull prepend="WHERE" property="vendorMasterId">
				<isNotEmpty property="vendorMasterId">
					COUNTRY_MASTER_ID NOT IN 
					(
						SELECT CM.COUNTRY_MASTER_ID
						FROM CMS_VENDOR_CNTRY_MAP VCM, CMS_COUNTRY_MASTER CM
						WHERE VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
						AND VCM.VENDOR_ID = #vendorMasterId#
					)
				</isNotEmpty>
			</isNotNull>
			ORDER BY RANK_1, UPPER(COUNTRY)
		)
		UNION ALL
		SELECT 0, '=============' FROM DUAL
		UNION ALL
		SELECT * FROM
		(
			SELECT COUNTRY_MASTER_ID,COUNTRY 
			FROM CMS_COUNTRY_MASTER 
			WHERE STATUS = 1
			AND COUNTRY_MASTER_ID NOT IN
			(
				SELECT COUNTRY_MASTER_ID FROM DW_TOP10_COUNTRY 
			)
			<isNotNull prepend="AND" property="vendorMasterId">
				<isNotEmpty property="vendorMasterId">
					COUNTRY_MASTER_ID NOT IN 
					(
						SELECT CM.COUNTRY_MASTER_ID
						FROM CMS_VENDOR_CNTRY_MAP VCM, CMS_COUNTRY_MASTER CM
						WHERE VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
						AND VCM.VENDOR_ID = #vendorMasterId#
					)
				</isNotEmpty>
			</isNotNull>
			ORDER BY UPPER(COUNTRY)
		)
	</select>
	
	<select id="getSelectedCountries" resultMap="resultCountryMasterVO" parameterClass="java.lang.String">
        SELECT CM.COUNTRY_MASTER_ID, CM.COUNTRY
		FROM CMS_VENDOR_CNTRY_MAP VCM, CMS_COUNTRY_MASTER CM
		WHERE VCM.COUNTRY_ID = CM.COUNTRY_MASTER_ID
		AND VCM.VENDOR_ID = #vendorMasterId#
	</select>
	
</sqlMap>


