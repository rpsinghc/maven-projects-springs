<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="CaseSearch">

	<select id="getCaseCreator" resultClass="com.worldcheck.atlas.vo.masters.UserMasterVO">
		SELECT
		distinct(LOGIN_ID) "username",USER_MASTER_ID "userMasterId"
		,USER_FULL_NAME "userFullName"
		FROM CMS_USER_MASTER
		CUM,CMS_USER_ROLE_MAP CURM
		WHERE CUM.USER_MASTER_ID = CURM.USER_ID
		AND
		CURM.ROLE_ID in ('R1', 'R2', 'R7','R9')
		AND CUM.STATUS = 1
		ORDER BY UPPER(USER_FULL_NAME)
	</select>


	<select id="getCaseList" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">

	SELECT * FROM (SELECT a.*,rownum rn	FROM (SELECT finalres.*,duedate.*, otherSubjects.* FROM (SELECT DISTINCT(cc.crn) crnno,
  cc.client_ref clientRefNo,
  to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,
  crtm.report_type reportType,
  ccsm.description caseStatus,
	decode(casecreator.USER_FULL_NAME,null,cc.case_creator_id,casecreator.USER_FULL_NAME)
	caseCreator,
  sub.subject_name primarySub,
  sub.country priCountry,
  cum.USER_FULL_NAME caseManager,
  to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,
  '0' isLegacyData,
  to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate,
  ctdsub.office primaryTeamOffice
FROM cms_clientcase cc,
  CMS_SUBJECT csub,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
	(select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master
	ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
          (SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub
    
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
 AND sub.CRN(+) = cc.CRN
 AND ctdsub.CRN(+)= cc.CRN
 AND csub.CRN(+) = cc.crn
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
  	<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				<isEqual property="exactMatch" compareValue='true'>
				 upper(csub.SUBJECT_NAME) = UPPER(#subjectName#)
		        </isEqual>
			     <isEqual property="exactMatch" compareValue='false'> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			     </isEqual> 
			      <isEqual property="exactMatch" compareValue=''> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			     </isEqual> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(csub.OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 csub.COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    ORDER BY upper($sortColumnName$) $sortType$
		)finalres join((
		
		
		<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
              			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>
		 ) duedate) on duedate.crn = finalres.crnno 
		 left JOIN(
         SELECT csub.crn As crn1, tab_to_clob(CAST(COLLECT(subject_name
			ORDER BY 
		  CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN csub.entity_type_id      
			END  ,
			  
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 2 THEN csub.entity_type_id 
			 
			END  desc, upper(csub.SUBJECT_NAME) asc,
			csub.SUBJECT_ID ASC
			) AS t_varchar2_tab)) AS othersubject
           FROM cms_subject csub
          WHERE csub.IS_PRIMARY_SUB = 0
       
       GROUP BY csub.crn
        ) otherSubjects 
        on otherSubjects.crn1 = finalres.crnno )
		
		 a WHERE ROWNUM <![CDATA[ <= ]]> #maxRecord#
		 <isNotNull property="keyWord" prepend="AND">
		 	<isNotEmpty property="keyWord">
		 		a.crnno = (select case_id from RG_GENERATED_REPORTS_KW_SEARCH rg where rg.case_id=a.crnNo and
			    rg.search_flag = 'Y'
			    AND contains(rg.GENERATED_REPORT, '{'|| upper(#keyWord#) || '}') > 0)
		 	</isNotEmpty>
		 </isNotNull>
		  ) WHERE rn <![CDATA[ >= ]]>
		#minRecord#
	</select>
	
	<select id="getCaseListCount" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM (select a.* from(select finalres.*,duedate.*, otherSubjects.* from(SELECT distinct(cc.crn) crnNo,
  cc.client_ref clientRefNo,
  to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,
  crtm.report_type reportType,
  ccsm.description caseStatus,
  decode(casecreator.USER_FULL_NAME,null,cc.case_creator_id,casecreator.USER_FULL_NAME) caseCreator,
  sub.subject_name primarySub,
  sub.country priCountry,
  cum.USER_FULL_NAME caseManager,
        to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,
  '0' isLegacyData,
  to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate,
  
 ctdsub.office
FROM cms_clientcase cc,
  CMS_SUBJECT csub,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
  (select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
          (SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub
    
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
 AND sub.CRN(+) = cc.CRN
 AND ctdsub.CRN(+)= cc.CRN
 AND csub.CRN(+) = cc.crn
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
 		<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				<isEqual property="exactMatch" compareValue='true'>
				 upper(csub.SUBJECT_NAME) = UPPER(#subjectName#)
		        </isEqual>
			     <isEqual property="exactMatch" compareValue='false'> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			     </isEqual>  
			     <isEqual property="exactMatch" compareValue=''> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			     </isEqual>  
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(csub.OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 csub.COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
		)finalres join((
		
		
		<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>
		 ) duedate) on duedate.crn = finalres.crnno 
		 left JOIN(
         SELECT csub.crn As crn1, tab_to_clob(CAST(COLLECT(subject_name
		 ORDER BY 
		  CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN csub.entity_type_id      
			END  ,
			  
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 2 THEN csub.entity_type_id 
			 
			END  desc, upper(csub.SUBJECT_NAME) asc,
			csub.SUBJECT_ID ASC
		 ) AS t_varchar2_tab)) AS othersubject
           FROM cms_subject csub
          WHERE csub.IS_PRIMARY_SUB = 0
       
       GROUP BY csub.crn
        ) otherSubjects 
        on otherSubjects.crn1 = finalres.crnno ) a
		 <isNotNull property="keyWord">
		 	<isNotEmpty property="keyWord">
		 		where a.crnno = (select case_id from RG_GENERATED_REPORTS_KW_SEARCH rg where rg.case_id=a.crnNo and
			    rg.search_flag = 'Y'
			    AND contains(rg.GENERATED_REPORT, '{' || upper(#keyWord#) ||'}') > 0)
		 	</isNotEmpty>
		 </isNotNull> )
	</select>
	
	
		<select id="getExportCaseList" parameterClass="java.util.Map"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">

		 select a.* from(select finalres.*,duedate.*, otherSubjects.* from(SELECT distinct(cc.crn) crnNo,
  cc.client_ref clientRefNo,
  to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,
  crtm.report_type reportType,
  ccsm.description caseStatus,
  decode(casecreator.USER_FULL_NAME,null,cc.case_creator_id,casecreator.USER_FULL_NAME) caseCreator,
  sub.subject_name primarySub,
  sub.country priCountry,
  cum.USER_FULL_NAME caseManager,
  to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,
  '0' isLegacyData,
  to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate,
  
ctdsub.office primaryTeamOffice
FROM cms_clientcase cc,
  CMS_SUBJECT csub,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
  (select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
          (SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub
    
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
 AND sub.CRN(+) = cc.CRN
 AND csub.CRN(+) = cc.crn
 AND ctdsub.CRN(+)                 = cc.CRN
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
   	<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				 <isEqual property="exactMatch" compareValue='true'>
				 upper(csub.SUBJECT_NAME) = UPPER(#subjectName#)
		         </isEqual>
			     <isEqual property="exactMatch" compareValue='false'> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			    </isEqual>
			     <isEqual property="exactMatch" compareValue=''> 
				 upper(csub.SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			    </isEqual>
				
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(csub.OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 csub.COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
		) finalres join((
		
		
		<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>
		 ) duedate) on duedate.crn = finalres.crnno 
		  left JOIN(
         SELECT csub.crn As crn1, tab_to_clob(CAST(COLLECT(subject_name
		 ORDER BY 
		  CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN csub.entity_type_id      
			END  ,
			  
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 2 THEN csub.entity_type_id 
			 
			END  desc, upper(csub.SUBJECT_NAME) asc,
			csub.SUBJECT_ID ASC
		 ) AS t_varchar2_tab)) AS othersubject
           FROM cms_subject csub
          WHERE csub.IS_PRIMARY_SUB = 0
       
       GROUP BY csub.crn
        ) otherSubjects 
        on otherSubjects.crn1 = finalres.crnno
		 ORDER BY upper(crnno) Asc) a
		  <isNotNull property="keyWord">
		 	<isNotEmpty property="keyWord">
		 		where a.crnno = (select case_id from RG_GENERATED_REPORTS_KW_SEARCH rg where rg.case_id=a.crnNo and
			    rg.search_flag = 'Y'
			    AND contains(rg.GENERATED_REPORT, '{'||upper(#keyWord#) || '}') > 0)
		 	</isNotEmpty>
		 </isNotNull> 
	</select>
	
	
	<select id="getLegacyCaseList" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">
	Select caseSe.*,
	decode (caseSe.isLegacyData,0, (SELECT tab_to_clob(CAST(COLLECT(csub.subject_name) AS t_varchar2_tab))  
	FROM   cms_subject csub where csub.IS_PRIMARY_SUB = 0 and csub.crn = caseSe.crnno GROUP BY csub.crn),
	1,(SELECT tab_to_clob(CAST(COLLECT(csub2.subjectname) AS t_varchar2_tab))    FROM SUBJECT_MV csub2        
	 WHERE csub2.isprimarysub = 0  and csub2.crn = caseSe.crnno GROUP BY csub2.crn ) ) otherSubject
	from (SELECT * FROM (SELECT a.*, ROWNUM rn FROM (SELECT * FROM (select * from(SELECT finalres.*,duedate.* FROM 
	(SELECT (cc.crn) crnno,  cc.client_ref clientRefNo,   to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,   
	crtm.report_type reportType,   ccsm.description caseStatus, cum.USER_FULL_NAME caseManager,  
	decode(casecreator.USER_FULL_NAME,null,cc.case_creator_id,casecreator.USER_FULL_NAME)  caseCreator,   
	sub.subject_name primarySub,   sub.country priCountry, '0' isLegacyData, 
	to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,   to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2, 
	to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,   to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1, 
	to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,     
	to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate,
	 ctdsub.office primaryTeamOffice
	FROM cms_clientcase cc,
  	( select distinct crn from  CMS_SUBJECT   
  	<dynamic prepend="WHERE"> 
  		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
			 <isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECT_NAME) = UPPER(#subjectName#)
		    </isEqual>
			 <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			 <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			</isNotEmpty>
		</isNotNull>			
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
	</dynamic>) csub,
       (select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
          (SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub ,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator
  
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
  AND sub.CRN(+) = cc.CRN  
  AND ctdsub.CRN(+)= cc.CRN
  AND cc.CRN(+) = csub.crn 
 
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
  
		<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-mm-yy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-mm-yy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>		
				
        
		)  finalres join((              
 <isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>) duedate) 
 on duedate.crn = finalres.crnno 
 
 ) 
			
		
    
    	UNION AlL
      
      
      
select * from(select finalres.*,duedate.* from (   
SELECT (cc.crn) crnno,   cc.clientref clientrefno,     to_char(cc.reqrecddt,   'dd-mm-yy HH24:MI:SS') reqrecddate,     crtm.report_type reporttype,     
ccsm.description casestatus,      decode(cum.USER_FULL_NAME,   NULL,   cc.casemgrid,   cum.USER_FULL_NAME) caseManager,  
 decode(casecreator.user_full_name,   NULL,  cc.casecreatorid,   casecreator.user_full_name) casecreator,   
 sub.subjectname primarySub,   sub.country priCountry,   '1' isLegacyData,  
to_char(cc.INTCLIENTDUEDATE1,'dd-mm-yy HH24:MI:SS') cinterim1,   to_char(cc.INTCLIENTDUEDATE2,'dd-mm-yy HH24:MI:SS') cinterim2,   
to_char(cc.FINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalduedate,   to_char(cc.INTRESEARCHDUEDATE1,'dd-mm-yy HH24:MI:SS') rinterim1, 
to_char(cc.INTRESEARCHDUEDATE2,'dd-mm-yy HH24:MI:SS') rinterim2,   to_char(cc.RESEARCHFINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalrduedate,
ctdsub.description primaryTeamOffice
FROM CLIENTCASE_MV cc,
   ( select distinct crn from SUBJECT_MV 
   <dynamic prepend="WHERE">
	   <isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
			
			 <isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECTNAME) = UPPER(#subjectName#) 
		    </isEqual>
			 <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			  <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHERDETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRYID = (select ccm.CODE from cms_country_master ccm where ccm.country_master_id = #subjectCountry#)
			</isNotEmpty>
		</isNotNull>
	</dynamic>
		) csub,
   (SELECT officemaster.description,
          caseteam.crn
           FROM caseteam @LEGACY ,
          officemaster @LEGACY            
          WHERE caseteam.isprimary   = '1'
        AND officemaster.OFFICEID = caseteam.officeid
     ) ctdsub ,  
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
  (select subjectname,ccm1.country,crn from SUBJECT_MV sub1,cms_country_master  ccm1 
	where sub1.isprimarysub = 1  AND sub1.countryid = ccm1.CODE) sub
 
WHERE crtm.report_code = cc.reporttypeid 
AND ccsm.STATUS_CODE = cc.STATUSCODE
AND cc.crn(+) = csub.crn 
and sub.crn(+)=cc.crn
AND ctdsub.CRN(+)= cc.CRN
 AND cum.login_id(+) = cc.casemgrid
 AND casecreator.login_id(+) = cc.casecreatorid
 AND sub.subjectname is not null 
		<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
			<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.casecreatorid = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.casemgrid = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.ORDERID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.clientref) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 ccsm.CASE_STATUS_ID = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
				
       ) finalres join((              
<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINALDUEDATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE2
          end ClientDueDate
   from CLIENTCASE_MV
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CLIENTCASE_MV
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CLIENTCASE_MV
			 			</isEmpty>
			 		</isNotNull>
		</isNull> ) duedate) 
 on duedate.crn = finalres.crnno 
 )  	
)			
		ORDER BY upper($sortColumnName$) $sortType$ ) a WHERE ROWNUM <![CDATA[ <= ]]>
		#maxRecord#) WHERE rn <![CDATA[ >= ]]>
		#minRecord#	) caseSe
		

		
	</select>
	
	
	<select id="getLegacyCaseCount" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="java.lang.Integer">

SELECT COUNT(*) FROM (select * from(select finalres.*,duedate.* from 
(SELECT (cc.crn) crnNo,cc.client_ref clientRefNo,
  to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,
  crtm.report_type reportType,
  ccsm.description caseStatus,
 decode(cum.USER_FULL_NAME,   NULL,   cc.CASE_MGR_ID,   cum.USER_FULL_NAME) caseManager,
  decode(casecreator.user_full_name,   NULL,   cc.case_creator_id,   casecreator.user_full_name) casecreator,
  sub.subject_name primarySub,
  sub.country priCountry,
  to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,
  to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate, 
  ctdsub.office primaryTeamOffice,
  'null' otherSubject

FROM cms_clientcase cc,
  	( select distinct crn from  CMS_SUBJECT   
  	<dynamic prepend="WHERE"> 
  		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				 <isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECT_NAME) = UPPER(#subjectName#)
		    </isEqual>
			 <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual>  
			  <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			</isNotEmpty>
		</isNotNull>			
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
	</dynamic>) csub,
       (select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
      (SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub ,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator
  
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
  AND sub.CRN(+) = cc.CRN  
AND ctdsub.CRN(+)= cc.CRN
  AND cc.CRN(+) = csub.crn 
 
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
   	<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>		
				
        
		)  finalres join((              
 <isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>) duedate) 
 on duedate.crn = finalres.crnno  
 
 ) 
			
		
    
    	UNION AlL
      
      
      
select * from(select finalres.*,duedate.* from (   
SELECT (cc.crn) crnno,   cc.clientref clientrefno,     
    to_char(cc.reqrecddt,   'dd-mm-yy HH24:MI:SS') reqrecddate,
    crtm.report_type reporttype,
    ccsm.description casestatus,
     decode(cum.USER_FULL_NAME,   NULL,   cc.casemgrid,   cum.USER_FULL_NAME) caseManager,
  decode(casecreator.user_full_name,   NULL,   cc.casecreatorid,   casecreator.user_full_name) casecreator,
  sub.subjectname primarySub,
  sub.country priCountry,
  to_char(cc.INTCLIENTDUEDATE1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.INTCLIENTDUEDATE2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.FINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.INTRESEARCHDUEDATE1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.INTRESEARCHDUEDATE2,'dd-mm-yy HH24:MI:SS') rinterim2,
 to_char(cc.RESEARCHFINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalrduedate ,
 ctdsub.description primaryTeamOffice,
 'null' otherSubject   
FROM CLIENTCASE_MV cc,
   ( select distinct crn from SUBJECT_MV 
   <dynamic prepend="WHERE">
	   <isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				<isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECTNAME) = UPPER(#subjectName#)
		               </isEqual>
			 <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			  <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			 </isEqual> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHERDETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRYID = (select ccm.CODE from cms_country_master ccm where ccm.country_master_id = #subjectCountry#)
			</isNotEmpty>
		</isNotNull>
	</dynamic>
		) csub,
(SELECT officemaster.description,
          caseteam.crn
           FROM caseteam @LEGACY ,
          officemaster @LEGACY            
          WHERE caseteam.isprimary   = '1'
        AND officemaster.OFFICEID = caseteam.officeid
     ) ctdsub ,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
  (select subjectname,ccm1.country,crn from SUBJECT_MV sub1,cms_country_master  ccm1 
	where sub1.isprimarysub = 1  AND sub1.countryid = ccm1.CODE) sub
 
WHERE crtm.report_code = cc.reporttypeid 
AND ccsm.STATUS_CODE = cc.STATUSCODE
AND cc.crn(+) = csub.crn  and sub.crn(+)=cc.crn
AND ctdsub.CRN(+)= cc.CRN
 AND cum.login_id(+) = cc.casemgrid
 AND casecreator.login_id(+) = cc.casecreatorid
 AND sub.subjectname is not null
		<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
			<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.casecreatorid = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.casemgrid = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.ORDERID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.clientref) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 ccsm.CASE_STATUS_ID = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
				
       ) finalres join((              
<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate ,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINALDUEDATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE1
               when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE2
          end ClientDueDate
   from CLIENTCASE_MV
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3 ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CLIENTCASE_MV
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CLIENTCASE_MV
			 			</isEmpty>
			 		</isNotNull>
		</isNull> ) duedate) 
 on duedate.crn = finalres.crnno
 
 )  	
)			
				
	</select>
	
	<select id="getExportLegacyCaseList" parameterClass="java.util.Map"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">

SELECT * FROM (select * from(select finalres.*,duedate.* from 
(SELECT (cc.crn) crnNo, cc.client_ref clientRefNo,
  to_char(cc.req_recd_dt,   'dd-mm-yy HH24:MI:SS') reqRecdDate,
  crtm.report_type reportType,
  ccsm.description caseStatus,
 decode(cum.USER_FULL_NAME,   NULL,   cc.CASE_MGR_ID,   cum.USER_FULL_NAME) caseManager,
  decode(casecreator.user_full_name,   NULL,   cc.case_creator_id,   casecreator.user_full_name) casecreator,
  sub.subject_name primarySub,
  sub.country priCountry,
  to_char(cc.client_int_duedate1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.client_int_duedate2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.final_due_date,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.rsrch_int_duedate1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.rsrch_int_duedate2,'dd-mm-yy HH24:MI:SS') rinterim2,
  to_char(cc.rsrch_final_due_date,'dd-mm-yy HH24:MI:SS') finalrduedate,
 ctdsub.office primaryTeamOffice,
(SELECT tab_to_clob(CAST(COLLECT(subject_name
ORDER BY 
		  CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN csub.entity_type_id      
			END  ,
			  
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=csub.crn AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 2 THEN csub.entity_type_id 
			 
			END  desc, upper(csub.SUBJECT_NAME) asc,
			csub.SUBJECT_ID ASC
) AS t_varchar2_tab)) AS othersubjects
	FROM   cms_subject csub where csub.IS_PRIMARY_SUB = 0 and csub.crn = cc.crn GROUP BY crn) otherSubject 
FROM cms_clientcase cc,
  	( select distinct crn from  CMS_SUBJECT   
  	<dynamic prepend="WHERE"> 
  		<isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
			 <isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECT_NAME) = UPPER(#subjectName#)
		      </isEqual>
		       <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			  </isEqual> 
			  <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECT_NAME) like '%' || UPPER(#subjectName#) || '%'
			  </isEqual> 				
			</isNotEmpty>
		</isNotNull>			
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHER_DETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRY_ID = #subjectCountry#
			</isNotEmpty>
		</isNotNull>
	</dynamic>) csub,
       (select subject_name,ccm1.country,crn from cms_subject sub,cms_country_master ccm1 where sub.is_primary_sub = 1
           AND sub.country_id = ccm1.country_master_id) sub,
(SELECT com.office,
          ctd.crn
           FROM cms_team_details ctd,
          cms_office_master com     ,
          cms_team_type ctt
          WHERE ctd.team_type_id = ctt.TEAM_TYPE_ID
        AND ctt.TEAM_TYPE        = 'Primary'
        AND com.OFFICE_MASTER_ID = ctd.office_id
        ) ctdsub ,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator
WHERE crtm.report_type_master_id = cc.report_type_id
 AND ccsm.case_status_id = cc.case_status_id
  AND sub.CRN(+) = cc.CRN   AND cc.CRN(+) = csub.crn 
 AND ctdsub.CRN(+)= cc.CRN
  and cum.LOGIN_ID(+) = cc.CASE_MGR_ID
  and casecreator.LOGIN_ID(+) = cc.CASE_CREATOR_ID
   	<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.case_creator_id = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.CASE_MGR_ID = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.BULK_ORDER_ID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.CLIENT_REF) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 upper(cc.CASE_STATUS_ID) = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.REQ_RECD_DT)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>		
				
        
		)  finalres join((              
 <isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINAL_DUE_DATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				CLIENT_INT_DUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			CLIENT_INT_DUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then CLIENT_INT_DUEDATE2
          end ClientDueDate
   from CMS_CLIENTCASE
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn,to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CMS_CLIENTCASE WHERE 
			 						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CMS_CLIENTCASE
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CMS_CLIENTCASE
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CMS_CLIENTCASE
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CMS_CLIENTCASE WHERE 
			 				FINAL_DUE_DATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINAL_DUE_DATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(final_due_date,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CMS_CLIENTCASE
			 			</isEmpty>
			 		</isNotNull>
		</isNull>) duedate) 
 on duedate.crn = finalres.crnno
 ) 
			
		
    
    	UNION AlL
      
      
      
select * from(select finalres.*,duedate.* from ( 
 SELECT (cc.crn) crnno, cc.clientref clientrefno,
    to_char(cc.reqrecddt,   'dd-mm-yy HH24:MI:SS') reqrecddate,
    crtm.report_type reporttype,
    ccsm.description casestatus,
     decode(cum.USER_FULL_NAME,   NULL,   cc.casemgrid,   cum.USER_FULL_NAME) caseManager,
  decode(casecreator.user_full_name,   NULL,   cc.casecreatorid,   casecreator.user_full_name) casecreator,
  sub.subjectname primarySub,
  sub.country priCountry,
  to_char(cc.INTCLIENTDUEDATE1,'dd-mm-yy HH24:MI:SS') cinterim1,
  to_char(cc.INTCLIENTDUEDATE2,'dd-mm-yy HH24:MI:SS') cinterim2,
  to_char(cc.FINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalduedate,
  to_char(cc.INTRESEARCHDUEDATE1,'dd-mm-yy HH24:MI:SS') rinterim1,
  to_char(cc.INTRESEARCHDUEDATE2,'dd-mm-yy HH24:MI:SS') rinterim2,
 to_char(cc.RESEARCHFINALDUEDATE,'dd-mm-yy HH24:MI:SS') finalrduedate ,
ctdsub.description primaryTeamOffice,
(SELECT tab_to_clob(CAST(COLLECT(subjectname) AS t_varchar2_tab)) AS othersubjects  
FROM SUBJECT_MV csub2           WHERE csub2.isprimarysub = 0  and csub2.crn = cc.crn GROUP BY csub2.crn ) otherSubject  
FROM CLIENTCASE_MV cc,
   ( select distinct crn from SUBJECT_MV 
   <dynamic prepend="WHERE">
	   <isNotNull prepend="AND" property="subjectName">
			<isNotEmpty property="subjectName">
				 <isEqual property="exactMatch" compareValue='true'>
				 upper(SUBJECTNAME) = UPPER(#subjectName#)
		      </isEqual>
		       <isEqual property="exactMatch" compareValue='false'> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			  </isEqual> 
			  <isEqual property="exactMatch" compareValue=''> 
				 upper(SUBJECTNAME) like '%' || UPPER(#subjectName#) || '%'
			  </isEqual> 			 
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectOtherdetails">
			<isNotEmpty property="subjectOtherdetails">
				 upper(OTHERDETAILS) like '%' || UPPER(#subjectOtherdetails#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="subjectCountry">
			<isNotEmpty property="subjectCountry">
				 COUNTRYID = (select ccm.CODE from cms_country_master ccm where ccm.country_master_id = #subjectCountry#)
			</isNotEmpty>
		</isNotNull>
	</dynamic>
		) csub,
(SELECT officemaster.description,
          caseteam.crn
           FROM caseteam @LEGACY ,
          officemaster @LEGACY            
          WHERE caseteam.isprimary   = '1'
        AND officemaster.OFFICEID = caseteam.officeid
     ) ctdsub ,
  cms_report_type_master crtm,
  cms_case_status_master ccsm,
  cms_user_master cum,
  cms_user_master casecreator,
  (select subjectname,ccm1.country,crn from SUBJECT_MV sub1,cms_country_master  ccm1 
	where sub1.isprimarysub = 1  AND sub1.countryid = ccm1.CODE) sub
 
WHERE crtm.report_code = cc.reporttypeid 
AND ccsm.STATUS_CODE = cc.STATUSCODE
AND cc.crn(+) = csub.crn  and sub.crn(+)=cc.crn
AND ctdsub.CRN(+)= cc.CRN
 AND cum.login_id(+) = cc.casemgrid
 AND casecreator.login_id(+) = cc.casecreatorid
 AND sub.subjectname is not null 
		<isNotNull prepend="AND" property="crnNumbers">
			<isNotEmpty property="crnNumbers">
				<iterate property="crnNumbers" conjunction="OR" open="("
					close=")">
					upper(cc.CRN) LIKE '%' || trim(upper(#crnNumbers[]#)) || '%'
        		</iterate>
			</isNotEmpty>
		</isNotNull>
			<isNotNull prepend="AND" property="caseCreator">
			<isNotEmpty property="caseCreator">
				cc.casecreatorid = (#caseCreator#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseManager">
			<isNotEmpty property="caseManager">
				cc.casemgrid = (#caseManager#)
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="isisBulkOrder">
			<isNotEmpty property="isisBulkOrder">
				upper(cc.ORDERID) like '%' || upper(#isisBulkOrder#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="clientRefNo">
			<isNotEmpty property="clientRefNo">
				upper(cc.clientref) like '%' || upper(#clientRefNo#) || '%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="caseStatus">
			<isNotEmpty property="caseStatus">
				 ccsm.CASE_STATUS_ID = #caseStatus#
			</isNotEmpty>
		</isNotNull>
		<isNotNull prepend="AND" property="startCaseRecvDate">
				<isNotEmpty property="startCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ >= ]]> to_date(#startCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="endCaseRecvDate">
				<isNotEmpty property="endCaseRecvDate">
					trunc(cc.reqrecddt)  <![CDATA[ <= ]]>  to_date(#endCaseRecvDate#,'dd-Mon-yyyy HH24:MI:SS')
			 </isNotEmpty>
	    </isNotNull>
				
       ) finalres join((              
<isNotNull property="includeIntrimDueDate">
			 <isEqual property="includeIntrimDueDate" compareValue="true">
			 	select crn,to_char(clientduedate,'dd-mm-yy HH24:MI:SS') clientduedate,dollar_name from (select CRN
         ,case
              when dollar_type.rowno = 1 then 'FINAL_DUE_DATE'
              when dollar_type.rowno = 2 then 'INTERIM_DUE_DATE1'
              when dollar_type.rowno = 3 then 'INTERIM_DUE_DATE2'
          end dollar_name
         ,case
              when dollar_type.rowno = 1 
              <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate">
              			 FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
              		</isNotEmpty>
              </isNotNull>
              <isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
              			FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              		</isNotEmpty>
              </isNotNull>
 		  		then FINALDUEDATE
                when dollar_type.rowno = 2 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE1 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE1 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE1
              when dollar_type.rowno = 3 
                <isNotNull prepend="AND" property="startClientDueDate">
              		<isNotEmpty property="startClientDueDate"> 
               				INTCLIENTDUEDATE2 <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
					</isNotEmpty>
              	</isNotNull>
              	<isNotNull prepend="AND" property="endClientDueDate">
              		<isNotEmpty property="endClientDueDate">
               			INTCLIENTDUEDATE2 <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
                </isNotEmpty>
              </isNotNull>
              then INTCLIENTDUEDATE2
          end ClientDueDate
   from CLIENTCASE_MV
       ,(
         select rownum rowno
         from dual
         connect by level <![CDATA[ <= ]]> 3
        ) dollar_type )
where clientduedate is not null
			 </isEqual>
			 <isNotEmpty property="includeIntrimDueDate">
			 	<isEqual property="includeIntrimDueDate" compareValue="false">
			 		<isNull property="startClientDueDate">
			 			<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 		</isNull>
			 		<isNull property="startClientDueDate">
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 		</isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isNotNull property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE2' dollar_name from CLIENTCASE_MV WHERE 
			 						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
              			</isEmpty>
			 			<isEmpty property="startClientDueDate">
			 				<isEmpty property="endClientDueDate">
			 					select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE1' dollar_name from CLIENTCASE_MV
			 				</isEmpty>
			 			</isEmpty>
			 		</isNotNull>
			 	</isEqual>
			 </isNotEmpty>
			 <isEmpty property="includeIntrimDueDate">
			 	<isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 	</isNull>
			 	<isNotNull property="startClientDueDate">
			 		<isEmpty property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE3' dollar_name from CLIENTCASE_MV
			 		</isEmpty>
			 		<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE4' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 		</isNotNull>
			 </isEmpty>
		</isNotNull>
		<isNull property="includeIntrimDueDate">
			 <isNull property="startClientDueDate">
			 			select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE5' dollar_name from CLIENTCASE_MV
			 </isNull>
			 		<isNotNull property="startClientDueDate">
			 			<isNotEmpty property="startClientDueDate"> 
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE6' dollar_name from CLIENTCASE_MV WHERE 
			 				FINALDUEDATE <![CDATA[ >= ]]> to_date(#startClientDueDate#,'DD-MM-YYYY') 
			 				<isNotNull prepend="AND" property="endClientDueDate">
              					<isNotEmpty property="endClientDueDate">
              						FINALDUEDATE <![CDATA[ <= ]]> to_date(#endClientDueDate#,'DD-MM-YYYY')
              					</isNotEmpty>
              				</isNotNull>
			 			</isNotEmpty>
			 			<isEmpty>
			 				select crn, to_char(FINALDUEDATE,'dd-mm-yy HH24:MI:SS') clientDueDate,'FINAL_DUE_DATE7' dollar_name from CLIENTCASE_MV
			 			</isEmpty>
			 		</isNotNull>
		</isNull> ) duedate) 
 on duedate.crn = finalres.crnno 
 
 ORDER BY upper(crnno) asc)  	
) ORDER BY upper(crnno) asc
	</select>
	
<select id="getRecCaseList" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">	
	SELECT * FROM (SELECT a.*, ROWNUM rn FROM (SELECT crc.LAST_RECURR_NUM recurrNumber,
			crc.crn crnno,
			ccm.client_code clientCode,
			crtm.report_type reportType,
			cum.user_full_name caseManager,
			crc.RECURR_PATTERN recurrPattern
FROM cms_clientcase ccm,
  	 cms_report_type_master crtm,
     cms_recurr_clientcase crc,
     cms_user_master cum
WHERE ccm.crn = crc.crn
	 AND cum.login_id(+) = ccm.case_mgr_id
	 AND ccm.is_recur_case = 1
	 AND crtm.report_type_master_id = ccm.report_type_id
	 <isNotNull prepend="AND" property="crnNo">
				<isNotEmpty property="crnNo">
				 crc.LAST_RECURR_NUM = #crnNo#
				</isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="clientCode">
				<isNotEmpty property="clientCode">
					ccm.client_code = #clientCode#
			 </isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="reportCode">
				<isNotEmpty property="reportCode">
					crtm.REPORT_CODE = #reportCode#
			 </isNotEmpty>
	    </isNotNull>
	     <isNotNull prepend="AND" property="caseManager">
				<isNotEmpty property="caseManager">
					ccm.CASE_MGR_ID = #caseManager#
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="recurrPattern">
				<isNotEmpty property="recurrPattern">
					crc.RECURR_PATTERN = #recurrPattern#
			 </isNotEmpty>
	    </isNotNull>
	Order by upper($sortColumnName$) $sortType$ ) a WHERE ROWNUM <![CDATA[ <= ]]>
		#maxRecord#) WHERE rn <![CDATA[ >= ]]>
		#minRecord#
</select>	

<select id="getRecCaseCount" parameterClass="com.worldcheck.atlas.bl.search.SearchCriteria"
		resultClass="java.lang.Integer">	
	SELECT count(*)
	FROM cms_clientcase ccm,
  	 cms_report_type_master crtm,
     cms_recurr_clientcase crc,
     cms_user_master cum
WHERE ccm.crn = crc.crn
	 AND cum.login_id(+) = ccm.case_mgr_id
	 AND ccm.is_recur_case = 1
	 AND crtm.report_type_master_id = ccm.report_type_id
	 <isNotNull prepend="AND" property="crnNo">
				<isNotEmpty property="crnNo">
				 crc.LAST_RECURR_NUM = #crnNo#
				</isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="clientCode">
				<isNotEmpty property="clientCode">
					ccm.client_code = #clientCode#
			 </isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="reportCode">
				<isNotEmpty property="reportCode">
					crtm.REPORT_CODE = #reportCode#
			 </isNotEmpty>
	    </isNotNull>
	     <isNotNull prepend="AND" property="caseManager">
				<isNotEmpty property="caseManager">
					ccm.CASE_MGR_ID = #caseManager#
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="recurrPattern">
				<isNotEmpty property="recurrPattern">
					crc.RECURR_PATTERN = #recurrPattern#
			 </isNotEmpty>
	    </isNotNull>
</select>

<select id="getExportRecCaseList" parameterClass="java.util.Map"
		resultClass="com.worldcheck.atlas.vo.search.CaseSearchVO">	
	SELECT crc.LAST_RECURR_NUM crnno,
			ccm.client_code clientCode,
			crtm.report_type reportType,
			cum.user_full_name caseManager,
			crc.RECURR_PATTERN recurrPattern
FROM cms_clientcase ccm,
  	 cms_report_type_master crtm,
     cms_recurr_clientcase crc,
     cms_user_master cum
WHERE ccm.crn = crc.crn
	 AND cum.login_id(+) = ccm.case_mgr_id
	 AND ccm.is_recur_case = 1
	 AND crtm.report_type_master_id = ccm.report_type_id
	 <isNotNull prepend="AND" property="crnNo">
				<isNotEmpty property="crnNo">
				 crc.LAST_RECURR_NUM = #crnNo#
				</isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="clientCode">
				<isNotEmpty property="clientCode">
					ccm.client_code = #clientCode#
			 </isNotEmpty>
	    </isNotNull>
	 <isNotNull prepend="AND" property="reportCode">
				<isNotEmpty property="reportCode">
					crtm.REPORT_CODE = #reportCode#
			 </isNotEmpty>
	    </isNotNull>
	     <isNotNull prepend="AND" property="caseManager">
				<isNotEmpty property="caseManager">
					ccm.CASE_MGR_ID = #caseManager#
			 </isNotEmpty>
	    </isNotNull>
	    <isNotNull prepend="AND" property="recurrPattern">
				<isNotEmpty property="recurrPattern">
					crc.RECURR_PATTERN = #recurrPattern#
			 </isNotEmpty>
	    </isNotNull>
	    order by crnNo Asc
</select>		
</sqlMap>