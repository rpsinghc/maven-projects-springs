<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="OfficeAssignment">

		<resultMap id="teamTypeVO" class="com.worldcheck.atlas.vo.TeamTypeVO">
			<result property="teamTypeId" column="TEAM_TYPE_ID" />
			<result property="teamType" column="TEAM_TYPE" />
		</resultMap>
		
		<resultMap id="caseDetailsVO" class="com.worldcheck.atlas.vo.CaseDetails">
			<result property="crn" column="CRN" />
			<result property="rInterim1" column="RSRCH_INT_DUEDATE1" />
			<result property="rInterim2" column="RSRCH_INT_DUEDATE2" />
			<result property="finalRDueDate" column="RSRCH_FINAL_DUE_DATE" />
			<result property="cInterim1" column="CLIENT_INT_DUEDATE1" />
			<result property="cInterim2" column="CLIENT_INT_DUEDATE2" />
			<result property="finalDueDate" column="FINAL_DUE_DATE" />
			<result property="reqRecdDate" column="REQ_RECD_DT" />
		</resultMap>
		
		<resultMap id="researchElementMasterVO" class="com.worldcheck.atlas.vo.masters.ResearchElementMasterVO">
		    <result property="rEMasterId" column="RE_MASTER_ID"/>
		 	<result property="researchElementName" column="NAME"/>
		  	<result property="points" column="JLPOINTS"/>
		   	<result property="supportingVendorTeam" column="ST_OR_VT"/>
		    <result property="biTeam" column="BI_TEAM"/>
			<result property="removeForEnglishCountry" column="REMOVE_ENGLISH"/>
			<result property="localLanguage" column="LOCAL_LANGUAGE"/>
	    </resultMap>

	    <resultMap id="caseDetailVO" class="com.worldcheck.atlas.vo.CaseDetails">
			<result property="crn" column="CRN" />
			<result property="officeName" column="OFFICE" />
			<result property="officeId" column="OFFICE_ID" />
			<result property="rInterim1" column="RSRCH_INT_DUEDATE1" />
			<result property="rInterim2" column="RSRCH_INT_DUEDATE2" />
			<result property="finalRDueDate" column="RSRCH_FINAL_DUE_DATE" />
			<result property="cInterim1" column="CLIENT_INT_DUEDATE1" />
			<result property="cInterim2" column="CLIENT_INT_DUEDATE2" />
			<result property="finalDueDate" column="FINAL_DUE_DATE" />
			<result property="reqRecdDate" column="REQ_RECD_DT" />
			<result property="pid" column="PID" />
			<result property="caseStatusId" column="caseStatusId" />
			<result property="caseStatus" column="caseStatus" />
			<result property="caseManagerName" column="caseManager"/>
		</resultMap>

		<select id="getTeamTypes" resultMap="teamTypeVO">
			SELECT TEAM_TYPE_ID,TEAM_TYPE
			from CMS_TEAM_TYPE 
			order by TEAM_TYPE_ID 
		</select>
		
		<select id="getCaseDueDates" resultMap="caseDetailsVO" parameterClass="java.lang.String">
			select CRN,RSRCH_INT_DUEDATE1,RSRCH_INT_DUEDATE2,RSRCH_FINAL_DUE_DATE,
				CLIENT_INT_DUEDATE1,CLIENT_INT_DUEDATE2,FINAL_DUE_DATE,REQ_RECD_DT 
			from CMS_CLIENTCASE 
			where CRN = #crn#
		</select>
		
		<select id="getCaseDetails" resultMap="caseDetailVO" parameterClass="java.lang.String">
			select ccm.CRN,com.OFFICE,ccm.OFFICE_ID,ccm.RSRCH_INT_DUEDATE1,ccm.RSRCH_INT_DUEDATE2,
ccm.RSRCH_FINAL_DUE_DATE,ccm.CLIENT_INT_DUEDATE1,ccm.CLIENT_INT_DUEDATE2,ccm.FINAL_DUE_DATE,
			ccm.REQ_RECD_DT, ccm.PID,ccm.CASE_STATUS_ID caseStatusId,ccsm.DESCRIPTION caseStatus,
			cum.USER_FULL_NAME caseManager
			from CMS_CLIENTCASE ccm
			LEFT JOIN CMS_USER_MASTER cum ON ccM.CASE_MGR_ID = cum.LOGIN_ID
			LEFT JOIN CMS_CASE_STATUS_MASTER ccsm ON ccsm.CASE_STATUS_ID = ccm.CASE_STATUS_ID
            LEFT JOIN CMS_OFFICE_MASTER com ON ccm.OFFICE_ID = com.OFFICE_MASTER_ID
			where CRN = #crn#
		</select>

<select id="getDetailForCase" resultClass="com.worldcheck.atlas.vo.CaseDetails">
			SELECT ccm.client_ref clientRef,
		ccm.CRN crn,
		ccm.REPORT_TYPE_ID reportTypeId,
		crtm.REPORT_TYPE reportType,
		ccm.OFFICE_ID officeId,
        com.OFFICE officeName,
        ccm.CASE_CREATOR_ID caseCreatorId,
        ccreator.USER_FULL_NAME caseCreatorFullName,
		TO_CHAR(ccm.REQ_RECD_DT,'dd-Mon-yyyy HH24:MI:SS') reqRecdDate1,
		ccm.SUB_REPORT_TYPE_ID subReportTypeId,
		csrtm.SUB_REPORT subReportType,
		ccm.IS_EXPRESS expressCase,
		ccm.CLIENT_INT_DUEDATE1 cInterim1,
		ccm.CLIENT_INT_DUEDATE2 cInterim2,
		ccm.FINAL_DUE_DATE finalDueDate,
		ccm.RSRCH_INT_DUEDATE1 rInterim1,
		ccm.RSRCH_INT_DUEDATE2 rInterim2,
		ccm.RSRCH_FINAL_DUE_DATE finalRDueDate,
		CONCAT(CONCAT( ccm.CLIENT_CODE , ' - '),cmm.CLIENT_NAME) clientName,
		ccm.CLIENT_CODE clientCode,
		ccm.CASE_MGR_ID caseMgrId,
        cum.USER_FULL_NAME caseManagerName,
		ccm.IS_AUTO_OFC_ASSIGN isAutoOfcAssign,
		ccm.CASE_INFO caseInfoBlock,
		ccm.CASE_STATUS_ID caseStatusId,
        ccsm.DESCRIPTION caseStatus,
        ccm.IS_RECUR_CASE isRecurCase,
        ccm.PID pid,
        ccm.IS_ISIS isISIS,
        ccm.CLIENT_INT_SENTDATE1 clientSentDate1,
        ccm.CLIENT_INT_SENTDATE2 clientSentDate2,
        ccm.CLIENT_FINAL_SENTDATE clientFinalDate,
        ccm.CLIENT_FEEDBACK clientFeedBack
		FROM
		cms_clientcase ccm,cms_client_master cmm,cms_user_master cum,cms_user_master ccreator,
		CMS_REPORT_TYPE_MASTER crtm,CMS_SUBREPORT_TYPE_MASTER csrtm,cms_office_master com,CMS_CASE_STATUS_MASTER ccsm
		WHERE cmm.CLIENT_CODE = ccm.CLIENT_CODE
		and crtm.REPORT_TYPE_MASTER_ID = ccm.REPORT_TYPE_ID
                and ccsm.CASE_STATUS_ID = ccm.CASE_STATUS_ID
                and ccreator.LOGIN_ID(+) = ccm.CASE_CREATOR_ID
                and com.OFFICE_MASTER_ID(+) = ccm.OFFICE_ID 
		and csrtm.SUBREPORT_TYPE_MASTER_ID(+) = ccm.SUB_REPORT_TYPE_ID
                and cum.LOGIN_ID(+) = ccm.CASE_MGR_ID
		and crn = #crn#
		</select>
		
		<select id="getREDetails" resultMap="researchElementMasterVO" parameterClass="java.util.HashMap">
			select RE_MASTER_ID,NAME,ROUND(JLPOINTS,1) JLPOINTS,ST_OR_VT,BI_TEAM,REMOVE_ENGLISH,LOCAL_LANGUAGE
			from CMS_RE_MASTER 
			where RE_MASTER_ID in ($reIds$) and STATUS = 1
		</select>
		
		<select id="getResearchHeads" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.lang.String">
			select cum.researchHead,cum.rhFullName,com.OFFICE_MASTER_ID office, com.OFFICE officeName 
			from (select OFFICE_MASTER_ID,OFFICE from CMS_OFFICE_MASTER where STATUS = 1 and OFFICE_MASTER_ID in ($officeIds$)) com 
			left join (select OFFICE_ID,LOGIN_ID researchHead,USER_FULL_NAME rhFullName from CMS_USER_MASTER where IS_OFFICE_HEAD = 1 and STATUS = 1)cum 
			on com.OFFICE_MASTER_ID = cum.OFFICE_ID
		</select>
		
		<select id="getAllResearchHeads" resultClass="com.worldcheck.atlas.vo.TeamDetails">
			select cum.researchHead,cum.rhFullName,com.OFFICE_MASTER_ID office, com.OFFICE officeName 
			from (select OFFICE_ID,LOGIN_ID researchHead, USER_FULL_NAME rhFullName from CMS_USER_MASTER where IS_OFFICE_HEAD = 1 and STATUS = 1)cum 
			left join (select OFFICE_MASTER_ID,OFFICE from CMS_OFFICE_MASTER where STATUS = 1) com  
			on com.OFFICE_MASTER_ID = cum.OFFICE_ID
		</select>
		
		<select id="getInactiveOffices" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.lang.String">
			select OFFICE_MASTER_ID office,OFFICE officeName from CMS_OFFICE_MASTER where STATUS = 0 and OFFICE_MASTER_ID in ($officeIds$)
		</select>
		
		<select id="getManagerDetails" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.util.HashMap">
			select LOGIN_ID managerName, USER_FULL_NAME managerFullName 
			from CMS_USER_MASTER 
			where LOGIN_ID in 
					<iterate property="managerIds" open="(" close=")" conjunction=",">
			      		#managerIds[]#
			      	</iterate>
				 and STATUS = 1
		</select>

		<insert id="addPSTOffice" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			<selectKey resultClass="int" type="pre" keyProperty="teamId">
					SELECT CMS_TEAMDET_TEAMID_SEQ.nextval AS VALUE FROM DUAL
		    </selectKey>
		   INSERT INTO CMS_TEAM_DETAILS( TEAM_ID,CRN,TEAM_TYPE_ID,OFFICE_ID, REV_INTDUEDATE1, REV_INTDUEDATE2, REV_FINDUEDATE,RESEARCH_HEAD,
                BYPASS_INTERIM,UPDATED_BY,UPDATED_ON,ALLOCATION_DATE)
			VALUES (#teamId#,#crn#,#teamTypeId#,#office#, decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')),
				decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')),to_date(#finalDueDate#,'dd-MM-YY'),#researchHead#,#byPassInterim#,#updatedBy#,SYSDATE,SYSDATE)  							
		</insert>
		
		<insert id="addBIVTOffice" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			<selectKey resultClass="int" type="pre" keyProperty="teamId">
					SELECT CMS_TEAMDET_TEAMID_SEQ.nextval AS VALUE FROM DUAL
		    </selectKey>
		   INSERT INTO CMS_TEAM_DETAILS( TEAM_ID,CRN,TEAM_TYPE_ID,MANAGER_ID, REV_INTDUEDATE1, REV_INTDUEDATE2, REV_FINDUEDATE,
                BYPASS_INTERIM,UPDATED_BY,UPDATED_ON,ALLOCATION_DATE)
			VALUES (#teamId#,#crn#,#teamTypeId#,#managerName#, decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')),
                        decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')),to_date(#finalDueDate#,'dd-MM-YY'),#byPassInterim#,#updatedBy#,SYSDATE,SYSDATE)  							
		</insert>
		
		<insert id="addTeamDetails" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			<selectKey resultClass="int" type="pre" keyProperty="teamId">
					SELECT CMS_TEAMDET_TEAMID_SEQ.nextval AS VALUE FROM DUAL
		    </selectKey>
		   INSERT INTO CMS_TEAM_DETAILS( TEAM_ID,CRN,TEAM_TYPE_ID,OFFICE_ID,MANAGER_ID,MAIN_ANALYST,REVIEWER1, REV_INTDUEDATE1, REV_INTDUEDATE2, REV_FINDUEDATE,
		   		RESEARCH_HEAD,BYPASS_INTERIM,UPDATED_BY,UPDATED_ON,ALLOCATION_DATE,ANALYSTS)
			VALUES (#teamId#,#crn#,#teamTypeId#,#office#,#managerName#,#mainAnalyst#,#reviewer1#, decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')),
				decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')),to_date(#finalDueDate#,'dd-MM-YY'),#researchHead#,#byPassInterim#,#updatedBy#,SYSDATE,SYSDATE,#mainAnalyst#)  							
		</insert>
		
		<insert id="addTeamREDetails" parameterClass="com.worldcheck.atlas.vo.SubTeamReMapVO">
			<selectKey resultClass="int" type="pre" keyProperty="subTeamReMapId">
					SELECT CMS_SUBTEAMREMAP_SEQ.nextval AS VALUE FROM DUAL
		    </selectKey>
		   INSERT INTO CMS_SUB_TEAM_RE_MAP( MAP_ID,CRN,TEAM_ID,SUBJECT_ID, RE_ID, JLPOINTS,PERFORMER,UPDATED_BY,UPDATED_ON)
    			values (#subTeamReMapId#,#crn#,#teamId#,#subjectId#, #reId#,#jlpPoints#,#performer#,#updatedBy#,SYSDATE) 							
		</insert>
		
		<update id="updateTeamReJlp" parameterClass="com.worldcheck.atlas.vo.SubTeamReMapVO">
			UPDATE CMS_SUB_TEAM_RE_MAP 
			  SET JLPOINTS = #jlpPoints#,
			  UPDATED_BY = #updatedBy#,
			  UPDATED_ON = SYSDATE
			  WHERE TEAM_ID =#teamId# and CRN = #crn# 
			  <isNotNull prepend="AND" property="performer">
		 		 <isNotEmpty property="performer">
				 	PERFORMER = #performer#
				 </isNotEmpty>
			</isNotNull>
			and SUBJECT_ID = #subjectId# and RE_ID = #reId#
	   </update>
		
		<resultMap id="subjectDetailsVO" class="com.worldcheck.atlas.vo.SubjectDetails" groupBy="subjectId">
			<result property="crn" column="CRN"/>
			<result property="subjectId" column="SUBJECT_ID"/>
			<result property="subjectName" column="SUBJECT_NAME"/>
			<result property="primarySub" column="IS_PRIMARY_SUB"/>
			<result property="reIds" column="RE_IDS"/>
			<result property="countryId" column="COUNTRY_ID"/>
			<result property="countryVO" resultMap="OfficeAssignment.countryMasterVO"/>
			<result property="reList" resultMap="OfficeAssignment.ResearchElementMasterVO"/>
			<result property="entityVO" resultMap="OfficeAssignment.entityTypeMasterVO"/>
		</resultMap>
		
		<resultMap id="countryMasterVO" class="com.worldcheck.atlas.vo.masters.CountryMasterVO">
			<result property="country" column="COUNTRY"/>
			<result property="countryMasterId" column="COUNTRY_ID"/>
		</resultMap>
		
		<resultMap id="entityTypeMasterVO" class="com.worldcheck.atlas.vo.masters.EntityTypeMasterVO">
			<result property="entityType" column="ENTITY_NAME"/>
			<result property="entityTypeID" column="ENTITY_TYPE_ID"/>
		</resultMap>
		
		<resultMap id="ResearchElementMasterVO" class="com.worldcheck.atlas.vo.masters.ResearchElementMasterVO">
			<result property="rEMasterId" column="RE_ID"/>
		 	<result property="researchElementName" column="NAME"/>
		  	<result property="points" column="JLPOINTS"/>
		   	<result property="supportingVendorTeam" column="ST_OR_VT"/>
		    <result property="biTeam" column="BI_TEAM"/>
		    <result property="localLanguage" column="LOCAL_LANGUAGE"/>
			<result property="officeOn_RECountry" column="OFFICEON_RECOUNTRY"/>
		</resultMap>
		
		 <!--Added by Juheen.For CR-2 Part-1(Release 1.3.2)-->
		<resultMap id="SubjectREDetailsVO" class="com.worldcheck.atlas.vo.SubjectDetails">
		      <result property="crn" column="CRN"/>
		       <result property="subjectId" column="SUBJECT_ID"/>
		       <result property="reIds" column="RE_ID"/>
			   <result property="teamType" column="TEAM_TYPE"/>
			   <result property="teamTypeId" column="TEAM_TYPE_ID"/>
			   <result property="rePoints" column="RE_POINTS"/>
			   <result property="office" column="OFFICE"/>
			   <result property="isShared" column="IS_SHARED"/>
			   
		</resultMap>
		 <!-- Ended Here -->
		 
		  <!--Added by Juheen.For CR-2 Part-3(Release 1.3.2)-->
		<resultMap id="ReplicatedSubjectsVO" class="java.lang.String">
		       <result property="subjectId" column="SUBJECT_ID"/>
		</resultMap>
		 <!-- Ended Here -->
		 
		 
		
		<select id="getCaseSubjectDetails" resultMap="subjectDetailsVO" parameterClass="java.lang.String">
			Select a.*,
			(select a.COUNTRY || '_' || crm.NAME || '_' || cfm.office from cms_matrix_map_exclusions matrix, cms_office_master cfm 
			where cfm.office_master_id = matrix.office_id AND
			a.COUNTRY_ID=matrix.country_master_id AND a.RE_ID = matrix.re_id) officeOn_RECountry,
			crm.NAME,ROUND(crm.JLPOINTS,1) JLPOINTS,crm.ST_OR_VT,crm.BI_TEAM,crm.RE_MASTER_ID,crm.LOCAL_LANGUAGE 
			from (SELECT 	CRN,SUBJECT_ID,SUBJECT_NAME,IS_PRIMARY_SUB,ENTITY_TYPE_ID,ENTITY_NAME,COUNTRY_ID,RE_IDS,COUNTRY,
			            r,substr(','||csv||',',instr(','||csv||',',',',1,r)+1,instr(','||csv||',',',',1,r+1)-instr(','||csv||',',',',1,r)-1) RE_ID
			      FROM (SELECT 	ccc.CRN,SUB.SUBJECT_ID,SUB.SUBJECT_NAME,SUB.IS_PRIMARY_SUB,SUB.ENTITY_TYPE_ID,cem.ENTITY_NAME,
			                SUB.COUNTRY_ID , SUB.RE_IDS, SUB.RE_IDS csv,ccm.COUNTRY
			            FROM CMS_CLIENTCASE ccc,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER ccm,CMS_ENTITYTYPE_MASTER cem
			            WHERE ccc.CRN=#crn# AND SUB.CRN=ccc.CRN  
			                AND SUB.COUNTRY_ID=ccm.COUNTRY_MASTER_ID and SUB.ENTITY_TYPE_ID = cem.ENTITY_TYPE_ID ),
			            (select rownum r from dual connect by level <![CDATA[ <= ]]> 500) 
			      where  instr(csv||',',',',1,r) > 0) a, CMS_RE_MASTER crm 
			where a.re_id = crm.RE_MASTER_ID and crm.STATUS = 1
			ORDER BY a.IS_PRIMARY_SUB DESC, 
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=#crn# AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN a.entity_type_id      
			END  
		</select>
		
		<!--Added by Juheen.For CR-2 Part-1(Release 1.3.2)-->
		  <select id="getSubjectCountryREDetails" resultMap="SubjectREDetailsVO" parameterClass="java.lang.String">
			SELECT
			crn,
			subject_id, 
			(select cms_team_type.team_type from cms_team_type where team_type_id = matrix.team_type_id) as team_type,
			 matrix.team_type_id,
			 matrix.re_id,
			 matrix.is_shared,
			(select om.office from cms_office_master om where om.office_master_id = matrix.office_id) as office,
			(select JLPOINTS from cms_re_master where re_master_id = matrix.re_id) as re_points
			FROM CMS_MATRIX_MAP matrix,
			(SELECT ccc.crn,
			sub.subject_id,
			sub.subject_name,
			sub.is_primary_sub,
			sub.entity_type_id,
			cem.entity_name,
			sub.country_id,
			sub.re_ids,
			sub.re_ids csv,
			ccm.country
			FROM cms_clientcase ccc,
			cms_subject sub,
			cms_country_master ccm,
			cms_entitytype_master cem
			WHERE ccc.crn =#crn#
			AND sub.crn = ccc.crn
			AND sub.country_id = ccm.country_master_id
			AND sub.entity_type_id =
			cem.entity_type_id  
			order by ccc.crn) a,
			(select rownum r from dual connect by level <![CDATA[ <= ]]>
			500)
			WHERE instr(csv || ',', ',', 1, r) > 0
			AND a.entity_type_id = matrix.entity_type_id
			AND a.country_id = matrix.COUNTRY_MASTER_ID
			AND matrix.status = 1
			AND SUBSTR(',' || csv || ',', instr(',' || csv || ',', ',', 1, r) + 1,
			instr(',' || csv || ',', ',', 1, r + 1) -instr(',' || csv || ',', ',',
			1, r) -1) = matrix.RE_ID

		</select>
      <!--Ended Here-->
	  
	  	<!--Added by Juheen.For CR-2 Part-3(Release 1.3.2)-->
		  <select id="getReplicatedSubjects" resultMap="ReplicatedSubjectsVO" parameterClass="java.lang.String">
			SELECT subject_id FROM cms_subject WHERE isreplicated = 1 and crn = #crn#
		   </select>
		
		   <select id="getAutoAddedTeams" resultClass="com.worldcheck.atlas.vo.TeamOfficeVO">
			SELECT ofc.office FROM cms_subrep_auto_team autoTeam, cms_office_master ofc 
			WHERE autoteam.officeid = ofc.office_master_id
		   </select>
      <!--Ended Here-->
			  
		<select id="getColorDetails" resultClass="com.worldcheck.atlas.vo.TaskColorVO" parameterClass="java.util.HashMap">
		    SELECT distinct COLOR
		   	FROM CMS_COLOR_DETAILS 
		   	WHERE CRN = #crn# and TASK_NAME = #taskName#
		</select>
		
		<!--Added by Juheen.For CR L-10(Release 1.3)-->
		
		<select id="checkClientDueDatesTab" parameterClass="java.util.HashMap"	resultClass="java.lang.Integer">
		
		 select count(*) from cms_holiday_master 
		 where  dated_on = to_date(#cFinal#,'dd-mm-yy')
		 <isNotEmpty property="cInterim1" prepend="or">
		 dated_on = to_date(#cInterim1#,'dd-mm-yy') 
		 </isNotEmpty>
		  <isNotEmpty property="cInterim2" prepend="or">
		    dated_on = to_date(#cInterim2#,'dd-mm-yy') 
		  </isNotEmpty>
		 
		 and office_id = #officeId#
		 
	    </select>
		
		
		
		<select id="isHoliday" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		 select count(*) from cms_holiday_master where
		 dated_on=to_date(#holidayDate#) and office_id= #officeId#
	    </select>
		
		
		<update id="updateClientDueDates" parameterClass="com.worldcheck.atlas.vo.CaseDetails">
		 UPDATE CMS_CLIENTCASE 
		 SET
		   <isNotNull  property="cInterim1">
	           <isNotEmpty property="cInterim1">
		           <!-- CLIENT_INT_DUEDATE1  = #cInterim1#,'DD-MON-YY'),-->
				   CLIENT_INT_DUEDATE1  = to_char(to_date(#cInterim1#, 'YYYY-MM-DD'),'yy-MON-dd'),
	           </isNotEmpty>
          </isNotNull>
           <isNotNull  property="cInterim2">
	          <isNotEmpty property="cInterim2">
		           <!-- CLIENT_INT_DUEDATE2  = to_date(#cInterim2#,'dd-mmm-yy') ,-->
				   CLIENT_INT_DUEDATE2  = to_char(to_date(#cInterim2#, 'YYYY-MM-DD'),'yy-MON-dd') , 
	          </isNotEmpty>
           </isNotNull>
           <isNotNull  property="clientFinalDate">
	            <isNotEmpty property="clientFinalDate">
		           <!-- FINAL_DUE_DATE  =  to_date(#clientFinalDate#,'dd-mmm-yy'), -->
				   FINAL_DUE_DATE  =  to_char(to_date(#clientFinalDate#, 'YYYY-MM-DD'),'yy-MON-dd'),
	            </isNotEmpty>
            </isNotNull>
			   
		         UPDATED_ON = SYSDATE
			     WHERE CRN = #crn#
	   </update>
	   <!--Ended by Juheen,For CR-L10-->
	
		<resultMap id="tabCaseDetailsVO" class="com.worldcheck.atlas.vo.CaseDetails" groupBy="crn">
			<result property="crn" column="CRN" />
			<result property="caseManagerName" column="USER_FULL_NAME" />
			<result property="rInterim1" column="RSRCH_INT_DUEDATE1" />
			<result property="rInterim2" column="RSRCH_INT_DUEDATE2" />
			<result property="finalRDueDate" column="RSRCH_FINAL_DUE_DATE" />
			<result property="cInterim1" column="CLIENT_INT_DUEDATE1" />
			<result property="cInterim2" column="CLIENT_INT_DUEDATE2" />
			<result property="finalDueDate" column="FINAL_DUE_DATE" />
			<result property="reqRecdDate" column="REQ_RECD_DT" />
			<result property="officeId" column="OFFICE_ID" />
			<result property="subjectList" resultMap="OfficeAssignment.subjectDetailsVO"/>
		</resultMap>
		
		<select id="getTabCaseSubjectDetails" resultMap="tabCaseDetailsVO" parameterClass="java.util.HashMap">
			Select a.*,
			(select a.COUNTRY || '_' || crm.NAME || '_' || cfm.office from cms_matrix_map_exclusions matrix, cms_office_master cfm 
			where cfm.office_master_id = matrix.office_id AND
			a.COUNTRY_ID=matrix.country_master_id AND a.RE_ID = matrix.re_id) OFFICEON_RECOUNTRY,
			crm.NAME,ROUND(crm.JLPOINTS,1) JLPOINTS,crm.ST_OR_VT,crm.BI_TEAM,crm.RE_MASTER_ID,crm.LOCAL_LANGUAGE 
			from (SELECT CRN,USER_FULL_NAME,RSRCH_INT_DUEDATE1,RSRCH_INT_DUEDATE2,RSRCH_FINAL_DUE_DATE,CLIENT_INT_DUEDATE1,CLIENT_INT_DUEDATE2,FINAL_DUE_DATE,REQ_RECD_DT,
						OFFICE_ID,SUBJECT_ID,SUBJECT_NAME,IS_PRIMARY_SUB,ENTITY_TYPE_ID,ENTITY_NAME,COUNTRY_ID,RE_IDS,COUNTRY,
			            r,substr(','||csv||',',instr(','||csv||',',',',1,r)+1,instr(','||csv||',',',',1,r+1)-instr(','||csv||',',',',1,r)-1) RE_ID
			      FROM (SELECT ccc.CRN,umuser.USER_FULL_NAME,ccc.RSRCH_INT_DUEDATE1,ccc.RSRCH_INT_DUEDATE2,ccc.RSRCH_FINAL_DUE_DATE,ccc.CLIENT_INT_DUEDATE1,ccc.CLIENT_INT_DUEDATE2,ccc.FINAL_DUE_DATE,ccc.REQ_RECD_DT,ccc.OFFICE_ID,
			      			SUB.SUBJECT_ID,SUB.SUBJECT_NAME,SUB.IS_PRIMARY_SUB,SUB.ENTITY_TYPE_ID,cem.ENTITY_NAME,SUB.COUNTRY_ID , SUB.RE_IDS, SUB.RE_IDS csv,ccm.COUNTRY
			            FROM CMS_CLIENTCASE ccc,CMS_SUBJECT SUB,CMS_COUNTRY_MASTER ccm,CMS_ENTITYTYPE_MASTER cem,CMS_USER_MASTER umuser
			            WHERE ccc.CRN in 
			            		<iterate property="taskList" open="(" close=")" conjunction=",">
						      		#taskList[].crn#
						      	</iterate> 
      	 					AND SUB.CRN=ccc.CRN  
			                AND SUB.COUNTRY_ID=ccm.COUNTRY_MASTER_ID and SUB.ENTITY_TYPE_ID = cem.ENTITY_TYPE_ID 
			                AND umuser.LOGIN_ID=ccc.CASE_MGR_ID),
			            (select rownum r from dual connect by level <![CDATA[ <= ]]> 500) 
			      where  instr(csv||',',',',1,r) > 0) a, CMS_RE_MASTER crm 
			where a.re_id = crm.RE_MASTER_ID and crm.STATUS = 1
			ORDER BY a.crn DESC,a.IS_PRIMARY_SUB DESC,
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=a.CRN AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 1 THEN a.entity_type_id      
			END  ,			  
			CASE WHEN (SELECT SUB.ENTITY_TYPE_ID    
				FROM CMS_CLIENTCASE CASE,CMS_SUBJECT SUB ,  CMS_COUNTRY_MASTER COUNT,CMS_ENTITYTYPE_MASTER ENTITY    
				WHERE 	CASE.CRN=a.CRN AND SUB.CRN=CASE.CRN  AND SUB.COUNTRY_ID=COUNT.COUNTRY_MASTER_ID 
				and SUB.ENTITY_TYPE_ID = ENTITY.ENTITY_TYPE_ID       AND SUB.IS_PRIMARY_SUB = 1) = 2 THEN a.entity_type_id			 
			END  desc, upper(a.SUBJECT_NAME) ASC, a.SUBJECT_ID ASC, upper(crm.GROUP_ID), upper(crm.NAME)
		</select>
		
		<resultMap id="teamDetailsVO" class="com.worldcheck.atlas.vo.TeamDetails" groupBy="teamId">
			<result property="crn" column="CRN"/>
			<result property="teamId" column="TEAM_ID"/>
			<result property="teamTypeId" column="TEAM_TYPE_ID"/>
			<result property="teamType" column="TEAM_TYPE"/>
			<result property="office" column="OFFICE_ID"/>
			<result property="officeName" column="OFFICE"/>
			<result property="managerName" column="MANAGER_ID"/>
			<result property="managerFullName" column="USER_FULL_NAME"/>
		 	<result property="mainAnalyst" column="MAIN_ANALYST"/>
		 	<result property="researchHead" column="RESEARCH_HEAD"/>
		  	<result property="dueDate1" column="REV_INTDUEDATE1"/>
		   	<result property="dueDate2" column="REV_INTDUEDATE2"/>
		    <result property="finalDueDate" column="REV_FINDUEDATE"/>
			<result property="byPassInterim" column="BYPASS_INTERIM"/>
			<result property="teamSubjectREDetails" resultMap="OfficeAssignment.SubTeamREMap"/>
		</resultMap>
		
		<resultMap id="SubTeamREMap" class="com.worldcheck.atlas.vo.SubTeamReMapVO">
			<result property="teamId" column="TEAM_ID"/>
			<result property="subjectId" column="SUBJECT_ID"/>
			<result property="reId" column="RE_ID"/>
			<result property="jlpPoints" column="JLPOINTS"/>
		</resultMap>
		
		<select id="getTeamDetails" resultMap="teamDetailsVO" parameterClass="java.lang.String">
			select a.*,d.SUBJECT_ID,d.RE_ID,trunc(d.JLPOINTS,4) JLPOINTS,b.OFFICE,c.USER_FULL_NAME 
			from (select ctd.TEAM_ID,ctd.CRN,ctd.TEAM_TYPE_ID,ctt.TEAM_TYPE,ctd.OFFICE_ID,ctd.MANAGER_ID,ctd.MAIN_ANALYST,
			      to_char(ctd.REV_INTDUEDATE1, 'dd-mm-YY') REV_INTDUEDATE1,to_char(ctd.REV_INTDUEDATE2, 'dd-mm-YY') REV_INTDUEDATE2,
			      to_char(ctd.REV_FINDUEDATE, 'dd-mm-YY') REV_FINDUEDATE,ctd.BYPASS_INTERIM, ctd.RESEARCH_HEAD  
			    from CMS_TEAM_DETAILS ctd,CMS_TEAM_TYPE ctt 
			    where ctd.CRN = #crn# and ctd.TEAM_TYPE_ID = ctt.TEAM_TYPE_ID 
			    order by ctd.TEAM_TYPE_ID,ctd.TEAM_ID) a left join 
			(SELECT CSTRM.CRN,CSTRM.SUBJECT_ID,CSTRM.TEAM_ID,CSTRM.RE_ID,sum(JLPOINTS) JLPOINTS 
			  FROM CMS_SUB_TEAM_RE_MAP CSTRM 
			  WHERE CSTRM.CRN = #crn# group by CSTRM.TEAM_ID,CSTRM.SUBJECT_ID,CSTRM.RE_ID,CSTRM.CRN )d on a.TEAM_ID = d.TEAM_ID left join 
			(select OFFICE_MASTER_ID,OFFICE from CMS_OFFICE_MASTER)b  on a.OFFICE_ID = b.OFFICE_MASTER_ID left join 
			(select LOGIN_ID,USER_FULL_NAME from CMS_USER_MASTER )c on a.MANAGER_ID = c.LOGIN_ID
		</select>
		
		<resultMap id="tabCaseTeamDetailsVO" class="com.worldcheck.atlas.vo.CaseDetails" groupBy="crn">
			<result property="crn" column="CRN" />
			<result property="teamList" resultMap="OfficeAssignment.teamDetailsVO"/>
		</resultMap>
		
		<select id="getTabCaseTeamDetails" resultMap="tabCaseTeamDetailsVO" parameterClass="java.util.HashMap">
			select a.*,d.SUBJECT_ID,d.RE_ID,trunc(d.JLPOINTS,4) JLPOINTS,b.OFFICE,c.USER_FULL_NAME 
			from (select ctd.TEAM_ID,ctd.CRN,ctd.TEAM_TYPE_ID,ctt.TEAM_TYPE,ctd.OFFICE_ID,ctd.MANAGER_ID,ctd.MAIN_ANALYST,
			      to_char(ctd.REV_INTDUEDATE1, 'dd-mm-YY') REV_INTDUEDATE1,to_char(ctd.REV_INTDUEDATE2, 'dd-mm-YY') REV_INTDUEDATE2,
			      to_char(ctd.REV_FINDUEDATE, 'dd-mm-YY') REV_FINDUEDATE,ctd.BYPASS_INTERIM, ctd.RESEARCH_HEAD  
				    from CMS_TEAM_DETAILS ctd,CMS_TEAM_TYPE ctt 
				    where ctd.CRN in 
		            		<iterate property="crnList" open="(" close=")" conjunction=",">
					      		#crnList[]#
					      	</iterate>
						 and ctd.TEAM_TYPE_ID = ctt.TEAM_TYPE_ID 
				    order by ctd.CRN,ctd.TEAM_TYPE_ID,ctd.TEAM_ID) a 
			left join 
				(SELECT CSTRM.CRN,CSTRM.SUBJECT_ID,CSTRM.TEAM_ID,CSTRM.RE_ID,JLPOINTS 
					  FROM CMS_SUB_TEAM_RE_MAP CSTRM 
					  WHERE CSTRM.CRN in 
	            		<iterate property="crnList" open="(" close=")" conjunction=",">
				      		#crnList[]#
				      	</iterate> )d 
			on a.TEAM_ID = d.TEAM_ID left join 
				(select OFFICE_MASTER_ID,OFFICE from CMS_OFFICE_MASTER)b  on a.OFFICE_ID = b.OFFICE_MASTER_ID left join 
				(select LOGIN_ID,USER_FULL_NAME from CMS_USER_MASTER )c on a.MANAGER_ID = c.LOGIN_ID
		</select>
		
		<select id="isOfficeAssignmentDone" resultClass="java.lang.Integer" parameterClass="java.lang.String">
			SELECT  COUNT(CRN) 
		   	FROM CMS_SUB_TEAM_RE_MAP 
		   	WHERE CRN = #crn# 
		</select>
		
		<select id="getPIDForCRN" resultClass="java.lang.Long" parameterClass="java.lang.String">
			SELECT  PID 
		   	FROM CMS_CLIENTCASE  
		   	WHERE CRN = #crn# 
		</select>
		
		<update id="updatePSTOffice" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET TEAM_TYPE_ID = #teamTypeId#,
			  OFFICE_ID = #office#, 
			  REV_INTDUEDATE1 = decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')), 
			  REV_INTDUEDATE2 = decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')), 
			  REV_FINDUEDATE = to_date(#finalDueDate#,'dd-MM-YY'),
			  RESEARCH_HEAD = #researchHead#,
			  BYPASS_INTERIM = #byPassInterim#,
			  UPDATED_BY = #updatedBy#,
			  UPDATED_ON = SYSDATE
			  WHERE TEAM_ID =#teamId# and CRN = #crn#
	   </update>
	   
	   <update id="updateBIVTOffice" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET TEAM_TYPE_ID = #teamTypeId#,
			  MANAGER_ID = #managerName#, 
			  REV_INTDUEDATE1 = decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')), 
			  REV_INTDUEDATE2 = decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')), 
			  REV_FINDUEDATE = to_date(#finalDueDate#,'dd-MM-YY'),
			  BYPASS_INTERIM = #byPassInterim#,
			  UPDATED_BY = #updatedBy#,
			  UPDATED_ON = SYSDATE
			  WHERE TEAM_ID =#teamId# and CRN = #crn#
	   </update>
	   
	   <delete id="deleteTeams" parameterClass="java.util.HashMap">
			DELETE FROM CMS_TEAM_DETAILS
			WHERE CRN = #crn# and TEAM_ID not in ($teamIds$)
		</delete>
		
		<resultMap id="teamDetailVO" class="com.worldcheck.atlas.vo.TeamDetails" groupBy="teamId">
			<result property="crn" column="CRN"/>
			<result property="teamId" column="TEAM_ID"/>
			<result property="teamTypeId" column="TEAM_TYPE_ID"/>
			<result property="teamType" column="TEAM_TYPE"/>
			<result property="office" column="OFFICE_ID"/>
			<result property="officeName" column="officeName"/>
			<result property="managerName" column="MANAGER_ID"/>
			<result property="managerFullName" column="managerFullName"/>
		 	<result property="mainAnalyst" column="MAIN_ANALYST"/>
		 	<result property="researchHead" column="RESEARCH_HEAD"/>
		  	<result property="dueDate1" column="REV_INTDUEDATE1"/>
		   	<result property="dueDate2" column="REV_INTDUEDATE2"/>
		    <result property="finalDueDate" column="REV_FINDUEDATE"/>
			<result property="byPassInterim" column="BYPASS_INTERIM"/>
			<result property="teamSubjectREDetails" resultMap="OfficeAssignment.SubTeamReMapVO"/>
		</resultMap>
		
		<resultMap id="SubTeamReMapVO" class="com.worldcheck.atlas.vo.SubTeamReMapVO">
			<result property="crn" column="CRN"/>
			<result property="teamId" column="TEAM_ID"/>
			<result property="subjectId" column="SUBJECT_ID"/>
			<result property="reId" column="RE_ID"/>
			<result property="jlpPoints" column="JLPOINTS"/>
			<result property="performer" column="PERFORMER"/>
		 	<result property="updatedBy" column="UPDATED_BY"/>
		</resultMap>
		
		<select id="getCompleteTeamDetails" resultMap="teamDetailVO" parameterClass="java.lang.String">			
			select a.*,b.OFFICE officeName,c.USER_FULL_NAME managerFullName from 
				(select ctd.TEAM_ID,ctd.CRN,ctd.TEAM_TYPE_ID,ctt.TEAM_TYPE,ctd.OFFICE_ID,ctd.MANAGER_ID,ctd.MAIN_ANALYST,
				  to_char(ctd.REV_INTDUEDATE1, 'dd-mm-YY') REV_INTDUEDATE1,to_char(ctd.REV_INTDUEDATE2, 'dd-mm-YY') REV_INTDUEDATE2,
				  to_char(ctd.REV_FINDUEDATE, 'dd-mm-YY') REV_FINDUEDATE,ctd.BYPASS_INTERIM, ctd.RESEARCH_HEAD,
				  CSTRM.SUBJECT_ID,CSTRM.RE_ID,trunc(CSTRM.JLPOINTS,4) JLPOINTS,CSTRM.PERFORMER,CSTRM.UPDATED_BY 
			from CMS_TEAM_DETAILS ctd,CMS_TEAM_TYPE ctt,CMS_SUB_TEAM_RE_MAP CSTRM
			where ctd.CRN = #crn# and ctd.TEAM_TYPE_ID = ctt.TEAM_TYPE_ID 
			  AND CSTRM.CRN = ctd.CRN AND ctd.TEAM_ID = CSTRM.TEAM_ID
			order by ctd.TEAM_TYPE_ID,ctd.TEAM_ID) a
			left join (select OFFICE_MASTER_ID, OFFICE from CMS_OFFICE_MASTER where STATUS = 1) b 
			on a.OFFICE_ID = b.OFFICE_MASTER_ID 
			left join (select LOGIN_ID, USER_FULL_NAME from CMS_USER_MASTER where STATUS = 1) c 
			on a.MANAGER_ID = c.LOGIN_ID
		</select>
		
		<delete id="deleteSubjectMappingForTeam" parameterClass="java.util.HashMap">
			DELETE FROM CMS_SUB_TEAM_RE_MAP
			WHERE CRN = #crn# and TEAM_ID = #teamId# and SUBJECT_ID not in ($subjectIds$)
		</delete>
		
		<delete id="deleteSubjectREMappingForTeam" parameterClass="java.util.HashMap">
			DELETE FROM CMS_SUB_TEAM_RE_MAP
			WHERE CRN = #crn# 
			<isNotNull prepend="AND" property="teamId">
		 		 <isNotEmpty property="teamId">
				 	TEAM_ID = #teamId#
				 </isNotEmpty>
			</isNotNull>
			and SUBJECT_ID = #subjectId# and RE_ID not in ($reIds$)
		</delete>
		
		<delete id="deleteSubjectREMappingForBIVTTeam" parameterClass="java.util.HashMap">
			DELETE FROM CMS_SUB_TEAM_RE_MAP
			WHERE CRN = #crn# 
			<isNotNull prepend="AND" property="teamId">
		 		 <isNotEmpty property="teamId">
				 	TEAM_ID = #teamId#
				 </isNotEmpty>
			</isNotNull>
			and SUBJECT_ID = #subjectId# 
			and ((upper(PERFORMER) = upper(#performer#)  and RE_ID not in ($reIds$)) or upper(PERFORMER) != upper(#performer#) )  
		</delete>
		
		
		<resultMap id="userMasterVO" class="com.worldcheck.atlas.vo.masters.UserMasterVO" groupBy="userMasterId">
			<result property="userMasterId" column="USER_MASTER_ID" />
			<result property="loginId" column="userId" />
			<result property="officeId" column="OFFICE_ID" />
			<result property="office" column="OFFICE" />
			<result property="reportsTo" column="REPORTS_TO" />
			<result property="userFullName" column="USER_FULL_NAME" />
			<result property="jlpPoints" column="JLP" />
			<result property="wipCases" column="caseCount" />
			<result property="userCountryProfileList" resultMap="OfficeAssignment.userCountryProfileVO" />		
		</resultMap>
						
		<resultMap id="userCountryProfileVO" class="com.worldcheck.atlas.vo.masters.UserCountryProfileVO">
			<result property="engMediaList" column="ENG_MEDIA_CHECK" />
			<result property="locLangList" column="LOC_LANG_CHECK" />
			<result property="profileCountryId" column="COUNTRY_ID" />		
			<result property="userMasterId" column="USER_MASTER_ID" />	
		</resultMap>
	
		<select id="getUserDetailsForAnalyst" resultMap="userMasterVO" parameterClass="java.util.HashMap">
			select * from (
			select decode(m.wipcases,null,0,m.wipcases) caseCount,n.* 
			from (select a.*,decode(b.COUNTRY_ID,null,0,b.COUNTRY_ID) COUNTRY_ID, 
               decode(b.ENG_MEDIA_CHECK,null,0,b.ENG_MEDIA_CHECK) ENG_MEDIA_CHECK, decode(b.LOC_LANG_CHECK,null,0,b.LOC_LANG_CHECK) LOC_LANG_CHECK 
		        from(select users.userId,users.USER_MASTER_ID,users.OFFICE_ID,users.OFFICE,users.USER_FULL_NAME,users.REPORTS_TO,
		                decode(users.JLP,null,0,users.JLP) JLP
		              from (select q.login_id userId,q.USER_MASTER_ID,q.OFFICE_ID,q.OFFICE,q.USER_FULL_NAME,q.REPORTS_TO,(p.JLPOINTS*q.PROFILE_VALUE) JLP
		                  from (
		                  	(select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,com.OFFICE,cum.USER_FULL_NAME,cum.PROFILE_VALUE,cum.REPORTS_TO 
		                        from CMS_USER_MASTER cum,CMS_OFFICE_MASTER com,CMS_USER_ROLE_MAP curm  
                        		where curm.USER_ID = cum.USER_MASTER_ID and curm.ROLE_ID = 'R11' and cum.OFFICE_ID = com.OFFICE_MASTER_ID and cum.STATUS = 1 
                        		and cum.login_id in (select login_id from (
	                                    select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,cum.USER_FULL_NAME,cum.PROFILE_VALUE,cum.REPORTS_TO   
	                                        from CMS_USER_MASTER cum,CMS_USER_ROLE_MAP curm ,  CMS_USER_MASTER cum1 
	                                        where curm.USER_ID = cum.USER_MASTER_ID and curm.ROLE_ID = 'R11' and cum.STATUS = 1 
	                                        	 and cum.REPORTS_TO = cum1.login_id and cum1.status = 1
	                                        	and cum.login_id not in (select cul.user_id from CMS_USER_LEAVE cul,CMS_LEAVE_TYPE_MASTER cltm,CMS_CLIENTCASE ccc 
	                                                where ccc.CRN = #crn# and cul.LEAVE_TYPE = cltm.LEAVE_TYPE_MASTER_ID 
	                                                and (((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE ) 
	                                                		or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE))
	                                                or ( ccc.RSRCH_INT_DUEDATE1 is not null 
				                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1) 
				                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1)))
				                                    or ( ccc.RSRCH_INT_DUEDATE2 is not null 
				                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2) 
				                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2))))  
	                                                and cltm.LEAVE_TYPE_MASTER_ID in (1,2,3))
	                                     		and cum.OFFICE_ID not in (select clm.OFFICE_ID from CMS_HOLIDAY_MASTER clm,CMS_CLIENTCASE ccc 
	                                          		where ccc.CRN = #crn# and ( RSRCH_FINAL_DUE_DATE = clm.DATED_ON 
	                                          			 or (RSRCH_INT_DUEDATE1 is not null and RSRCH_INT_DUEDATE1 = clm.DATED_ON )
                                              			 or (RSRCH_INT_DUEDATE2 is not null and RSRCH_INT_DUEDATE2 = clm.DATED_ON))) 
	                                     		and cum.OFFICE_ID in (select OFFICE_MASTER_ID from CMS_OFFICE_MASTER where status = 1 
	                                                and OFFICE_MASTER_ID in (select office_id from CMS_USER_MASTER where IS_OFFICE_HEAD = 1 and STATUS = 1))))) q 
		                  left join     
		                        (select cstrm.performer userId,(sum(cstrm.JLPOINTS)) JLPOINTS 
		                        from CMS_SUB_TEAM_RE_MAP cstrm,CMS_CLIENTCASE ccc,CMS_CASE_STATUS_MASTER ccsm 
		                        where cstrm.CRN = ccc.CRN and ccc.CASE_STATUS_ID = ccsm.CASE_STATUS_ID 
	                                and ccsm.CASE_STATUS_ID in (1,2,3)  
	                                and cstrm.performer in (select login_id from (
	                                    select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,cum.USER_FULL_NAME,cum.PROFILE_VALUE,cum.REPORTS_TO   
	                                        from CMS_USER_MASTER cum,CMS_USER_ROLE_MAP curm,  CMS_USER_MASTER cum1  
	                                        where curm.USER_ID = cum.USER_MASTER_ID and curm.ROLE_ID = 'R11' and cum.STATUS = 1 
	                                         	and cum.REPORTS_TO = cum1.login_id and cum1.status = 1
	                                        	and cum.login_id not in (select cul.user_id from CMS_USER_LEAVE cul,CMS_LEAVE_TYPE_MASTER cltm,CMS_CLIENTCASE ccc 
	                                                where ccc.CRN = #crn# and cul.LEAVE_TYPE = cltm.LEAVE_TYPE_MASTER_ID 
	                                                and (((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE ) 
	                                                		or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE))
	                                                or ( ccc.RSRCH_INT_DUEDATE1 is not null 
				                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1) 
				                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1)))
				                                    or ( ccc.RSRCH_INT_DUEDATE2 is not null 
				                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2) 
				                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2)))) 
	                                                and cltm.LEAVE_TYPE_MASTER_ID in (1,2,3))
	                                     		and cum.OFFICE_ID not in (select clm.OFFICE_ID from CMS_HOLIDAY_MASTER clm,CMS_CLIENTCASE ccc 
	                                          		where ccc.CRN = #crn# and ( RSRCH_FINAL_DUE_DATE = clm.DATED_ON 
	                                          			 or (RSRCH_INT_DUEDATE1 is not null and RSRCH_INT_DUEDATE1 = clm.DATED_ON )
                                              			 or (RSRCH_INT_DUEDATE2 is not null and RSRCH_INT_DUEDATE2 = clm.DATED_ON)))
	                                     		and cum.OFFICE_ID in (select OFFICE_MASTER_ID from CMS_OFFICE_MASTER where status = 1 
	                                                and OFFICE_MASTER_ID in (select office_id from CMS_USER_MASTER where IS_OFFICE_HEAD = 1 and STATUS = 1)))) 
		                   group by cstrm.performer )p on q.login_id = p.userId )) users
		               where (users.JLP <![CDATA[ <= ]]> #threshHold# or users.JLP is null)
		            order by users.userId) a 
		    left join 
		        (select USER_ID,COUNTRY_ID,ENG_MEDIA_CHECK,LOC_LANG_CHECK from  CMS_USER_CNTRY_PROFILE)b 
		        on a.USER_MASTER_ID = b.USER_ID ) n
			left join
			        (select userId,count(CRN) wipcases from 
						   ( select distinct(ccc1.crn),ccc.RSRCH_FINAL_DUE_DATE,ccc.RSRCH_INT_DUEDATE1,ccc.RSRCH_INT_DUEDATE2 ,cstrm.performer userId,
						    	ctd.REV_INTDUEDATE1,ctd.REV_INTDUEDATE2,ctd.REV_FINDUEDATE
						     from CMS_CLIENTCASE ccc,CMS_TEAM_DETAILS ctd,cms_clientcase ccc1,CMS_CASE_STATUS_MASTER ccsm,CMS_SUB_TEAM_RE_MAP cstrm
						     where ccc.CRN = #crn# and ccc1.CASE_STATUS_ID = ccsm.CASE_STATUS_ID and ccsm.CASE_STATUS_ID in (1,2,3) 
						        and ccc1.crn = ctd.crn and ctd.team_id = cstrm.team_id and cstrm.CRN = ctd.CRN and cstrm.performer is not null 
						        and ((ccc.RSRCH_INT_DUEDATE1 = ctd.REV_INTDUEDATE1) or (ccc.RSRCH_INT_DUEDATE2 = ctd.REV_INTDUEDATE2) or 
				                          (ccc.RSRCH_FINAL_DUE_DATE = ctd.REV_FINDUEDATE))) 
				             group by userId )m 
			 on n.userId=m.userId 
			 order by n.jlp,m.wipcases,n.userId ) where caseCount <![CDATA[ <= ]]> #wipCount#
		</select>
		
		<resultMap id="biUserVO" class="com.worldcheck.atlas.vo.masters.UserMasterVO" groupBy="userMasterId">
			<result property="userMasterId" column="USER_MASTER_ID" />
			<result property="loginId" column="login_id" />
			<result property="office" column="OFFICE_ID" />
			<result property="reportsTo" column="REPORTS_TO" />
			<result property="userFullName" column="USER_FULL_NAME" />
			<result property="jlpPoints" column="JLP" />	
		</resultMap>
	
		<select id="getUserDetailsForBI" resultMap="biUserVO" parameterClass="java.lang.String">
			select login_id, USER_MASTER_ID,OFFICE_ID,USER_FULL_NAME,REPORTS_TO, decode(JLP,null,0,JLP) JLP    
			from (select q.*, (p.JLPOINTS*q.PROFILE_VALUE) JLP from
				  (select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,cum.USER_FULL_NAME,cum.PROFILE_VALUE,cum.REPORTS_TO 
				    from CMS_USER_MASTER cum,CMS_USER_ROLE_MAP curm  
				    where curm.USER_ID = cum.USER_MASTER_ID and curm.ROLE_ID = 'R6' and cum.STATUS = 1 
				    and cum.login_id in (select login_id from ( 
				    		select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,cum.USER_FULL_NAME,cum.REPORTS_TO   
				              from CMS_USER_MASTER cum   
				              where cum.login_id not in (select cul.user_id from CMS_USER_LEAVE cul,CMS_LEAVE_TYPE_MASTER cltm,CMS_CLIENTCASE ccc 
					                  where ccc.CRN = #crn# and cul.LEAVE_TYPE = cltm.LEAVE_TYPE_MASTER_ID 
					                      and (((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE ) 
                                              		or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE))
                                              or ( ccc.RSRCH_INT_DUEDATE1 is not null 
		                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1) 
		                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1)))
	                                   		  or ( ccc.RSRCH_INT_DUEDATE2 is not null 
		                                          and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2) 
		                                          	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2)))) 
					                      and cltm.LEAVE_TYPE_MASTER_ID in (1,2,3))
					         	and cum.OFFICE_ID not in (select clm.OFFICE_ID from CMS_HOLIDAY_MASTER clm,CMS_CLIENTCASE ccc 
				              		where ccc.CRN = #crn# and ( RSRCH_FINAL_DUE_DATE = clm.DATED_ON 
					              		or (RSRCH_INT_DUEDATE1 is not null and RSRCH_INT_DUEDATE1 = clm.DATED_ON ) 
		                                or (RSRCH_INT_DUEDATE2 is not null and RSRCH_INT_DUEDATE2 = clm.DATED_ON ))))) ) q 
				left join     
				(select cstrm.performer userId,(sum(cstrm.JLPOINTS)) JLPOINTS 
					from CMS_SUB_TEAM_RE_MAP cstrm,CMS_CLIENTCASE ccc,CMS_CASE_STATUS_MASTER ccsm   
					where cstrm.CRN = ccc.CRN and ccc.CASE_STATUS_ID = ccsm.CASE_STATUS_ID 
					    and ccsm.CASE_STATUS_ID in (1,2,3)  
					    and cstrm.performer in (select login_id from ( 
				    		select cum.login_id,cum.USER_MASTER_ID,cum.OFFICE_ID,cum.USER_FULL_NAME,cum.REPORTS_TO   
				              from CMS_USER_MASTER cum   
				              where cum.login_id not in (select cul.user_id from CMS_USER_LEAVE cul,CMS_LEAVE_TYPE_MASTER cltm,CMS_CLIENTCASE ccc 
				                  where ccc.CRN = #crn# and cul.LEAVE_TYPE = cltm.LEAVE_TYPE_MASTER_ID 
				                      and (((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE ) 
                                           	or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_FINAL_DUE_DATE and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_FINAL_DUE_DATE))
                                          or ( ccc.RSRCH_INT_DUEDATE1 is not null 
                                        	and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1) 
                                        		or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE1 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE1)))
                                  		  or ( ccc.RSRCH_INT_DUEDATE2 is not null 
                                        	and ((cul.FROM_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2) 
                                        		or (cul.FROM_DATE <![CDATA[ <= ]]> ccc.RSRCH_INT_DUEDATE2 and cul.TO_DATE <![CDATA[ >= ]]> ccc.RSRCH_INT_DUEDATE2)))) 
				                      and cltm.LEAVE_TYPE_MASTER_ID in (1,2,3))
				         and cum.OFFICE_ID not in (select clm.OFFICE_ID from CMS_HOLIDAY_MASTER clm,CMS_CLIENTCASE ccc 
				              where ccc.CRN = #crn# and ( RSRCH_FINAL_DUE_DATE = clm.DATED_ON 
				              		or (RSRCH_INT_DUEDATE1 is not null and RSRCH_INT_DUEDATE1 = clm.DATED_ON ) 
	                                or (RSRCH_INT_DUEDATE2 is not null and RSRCH_INT_DUEDATE2 = clm.DATED_ON ))))) 
				group by cstrm.performer) p 
				on q.login_id = p.userId 
				order by userId
			) order by login_id
		</select>
		
		<delete id="deleteBITeamForCase" parameterClass="java.lang.String">
			delete from CMS_TEAM_DETAILS ctd  
			where ctd.CRN = #crn# 
			  	and ctd.TEAM_TYPE_ID = (select TEAM_TYPE_ID from CMS_TEAM_TYPE where TEAM_TYPE = 'Supporting - BI')
		</delete>
		
		<delete id="deleteSubjectOfficeDetails" parameterClass="com.worldcheck.atlas.vo.SubjectDetails">
			delete from CMS_SUB_TEAM_RE_MAP where CRN = #crn# and SUBJECT_ID = #subjectId# and RE_ID in ($reIds$)
		</delete>
		
		<select id="isBITeamExistsForCase" parameterClass="java.lang.String" resultClass="java.lang.Integer">
			select count(ctd.team_id) 
			from CMS_TEAM_DETAILS ctd, CMS_TEAM_TYPE ctt 
			where ctd.CRN = #crn# and ctt.TEAM_TYPE_ID = ctd.TEAM_TYPE_ID and ctt.TEAM_TYPE = 'Supporting - BI'
		</select>
		
		<select id="getPrimarySubjectAssignmentDetails" resultClass="com.worldcheck.atlas.vo.SubTeamReMapVO" parameterClass="java.lang.String">
			select CSTRM.team_id teamId,CSTRM.CRN,CSTRM.SUBJECT_ID subjectId,CSTRM.RE_ID reId,CSTRM.PERFORMER,CSTRM.JLPOINTS jlpPoints,CRM.NAME "reName"
			from CMS_SUB_TEAM_RE_MAP CSTRM,CMS_RE_MASTER CRM 
			where CSTRM.CRN = #crn# and CSTRM.RE_ID = CRM.RE_MASTER_ID
			    and CSTRM.SUBJECT_ID = (select SUBJECT_ID from CMS_SUBJECT where CRN = #crn# and IS_PRIMARY_SUB=1)
		</select>
		
		<select id="getSubjectAsisgnmentDetails" resultClass="com.worldcheck.atlas.vo.SubTeamReMapVO" parameterClass="com.worldcheck.atlas.vo.SubjectDetails">
			select cstrm.team_id teamId,cstrm.CRN,cstrm.SUBJECT_ID subjectId,cstrm.RE_ID reId,cstrm.PERFORMER,cstrm.JLPOINTS jlpPoints
			from CMS_SUB_TEAM_RE_MAP cstrm   
			where cstrm.CRN = #crn# and cstrm.SUBJECT_ID = #subjectId#
		</select>
		
		<select id="getCRNWithSavedOfficeDetails" resultClass="java.lang.String" parameterClass="java.util.HashMap">
			SELECT  CRN 
			FROM CMS_TEAM_DETAILS 
			WHERE TEAM_TYPE_ID =1 and CRN in 
				<iterate property="taskList" open="(" close=")" conjunction=",">
		      		#taskList[].crn#
		      	</iterate>
      	</select>
      	
      	<select id="getCRNWithBIRE" resultClass="java.lang.String" parameterClass="java.util.HashMap">
	      	Select distinct a.CRN 
			from (SELECT CRN,SUBJECT_ID,SUBJECT_NAME,RE_IDS,
			            r,substr(','||csv||',',instr(','||csv||',',',',1,r)+1,instr(','||csv||',',',',1,r+1)-instr(','||csv||',',',',1,r)-1) RE_ID
			      FROM (SELECT SUB.CRN,SUB.SUBJECT_ID,SUB.SUBJECT_NAME,SUB.RE_IDS, SUB.RE_IDS csv
			            FROM CMS_SUBJECT SUB
			            WHERE SUB.CRN in 
									<iterate property="taskList" open="(" close=")" conjunction=",">
							      		#taskList[].crn#
							      	</iterate>
			            ),
			            (select rownum r from dual connect by level <![CDATA[ <= ]]> 500) 
			      where  instr(csv||',',',',1,r) > 0) a, CMS_RE_MASTER crm 
			where a.re_id = crm.RE_MASTER_ID and crm.STATUS = 1 and crm.BI_TEAM = 'Yes'
			ORDER BY a.crn
		</select>
		
		<update id="addInterim1CycleToPrimary" parameterClass="com.worldcheck.atlas.vo.CaseDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET REV_INTDUEDATE1 = #rInterim1#, 
				  BYPASS_INTERIM = 0,
				  UPDATED_BY = #updatedBy#,
				  UPDATED_ON = SYSDATE
			  WHERE CRN = #crn# and TEAM_TYPE_ID = (Select TEAM_TYPE_ID from CMS_TEAM_TYPE where TEAM_TYPE = 'Primary')
	   </update>
	   
	   <update id="addInterim2CycleToPrimary" parameterClass="com.worldcheck.atlas.vo.CaseDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET REV_INTDUEDATE2 = #rInterim2#, 
				  BYPASS_INTERIM = 0,
				  UPDATED_BY = #updatedBy#,
				  UPDATED_ON = SYSDATE
			  WHERE CRN = #crn# and TEAM_TYPE_ID = (Select TEAM_TYPE_ID from CMS_TEAM_TYPE where TEAM_TYPE = 'Primary')
	   </update>
	   
	   <update id="addInterimCyclesToPrimary" parameterClass="com.worldcheck.atlas.vo.CaseDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET REV_INTDUEDATE1 = #rInterim1#,
				  REV_INTDUEDATE2 = #rInterim2#, 
				  BYPASS_INTERIM = 0,
				  UPDATED_BY = #updatedBy#,
				  UPDATED_ON = SYSDATE
			  WHERE CRN = #crn# and TEAM_TYPE_ID = (Select TEAM_TYPE_ID from CMS_TEAM_TYPE where TEAM_TYPE = 'Primary')
	   </update>
	   
	  <update id="resetTeamResearchCMPDates" parameterClass="java.util.HashMap"> 
		   update CMS_TEAM_DETAILS set
			<isEqual property="cycleName" compareValue="Interim1">
				INT1RESEARCHCOMPDT = null
			</isEqual>
			<isEqual property="cycleName" compareValue="Interim2">
				INT2RESEARCHCOMPDT = null
			</isEqual>
			<isEqual property="cycleName" compareValue="Final">
				FINALRESEARCHCOMPDT = null
			</isEqual>
			where crn=#crn# and team_id=#team_ID#
		</update>
		
		<update id="resetTeamOfficeDetails" parameterClass="java.util.HashMap"> 
			update CMS_TEAM_DETAILS 
			  set MANAGER_ID = null, MAIN_ANALYST = null, REVIEWER1 = null, REVIEWER2 = null, REVIEWER3 = null,ANALYSTS = null, 
			  	REV_OTHER_OFF3 = 0,REV_OTHER_OFF2 = 0, REV_OTHER_OFF1 = 0,INT1RESEARCHCOMPDT = null, INT2RESEARCHCOMPDT = null, FINALRESEARCHCOMPDT = null 
			  where crn=#crn# and team_id=#team_ID#
  		</update>
  		
  		<delete id="deleteReMappingForTeam" parameterClass="java.util.HashMap">
			DELETE FROM CMS_SUB_TEAM_RE_MAP
			WHERE CRN = #crn# and TEAM_ID = #team_ID# 
		</delete>
		
	   <select id="getRHOffice" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.lang.String">			  
		   select cum.office_id office, com.OFFICE officeName
			from CMS_USER_MASTER cum,CMS_OFFICE_MASTER com  
			where LOGIN_ID = #researchHead# and cum.STATUS = 1 
			    and cum.office_id = com.OFFICE_MASTER_ID and com.status = 1
	   </select>
	   
	   <select id="checkForPSTHoliday" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		   	select to_char(dated_on,'dd-mm-yy') holidayDate from cms_holiday_master 
				where (dated_on = to_date(#FDD#,'dd-mm-yy') 
					or dated_on = to_date(#FDD1#,'dd-mm-yy') 
					or dated_on = to_date(#FDD2#,'dd-mm-yy') 
					or dated_on = to_date(#FDD3#,'dd-mm-yy') 
					
					<isNotEmpty property="IDD1" prepend="or">
						dated_on = to_date(#IDD1#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD11#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD12#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD13#,'dd-mm-yy') 
					</isNotEmpty>
					
					<isNotEmpty property="IDD2" prepend="or">
						dated_on = to_date(#IDD2#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD21#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD22#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD23#,'dd-mm-yy') 
					</isNotEmpty>
				 ) and office_id=#officeId#
			union
			<isEmpty property="IDD1">
				select holidayDate from (
					select DECODE(r,1,dt1,2,dt2,3,dt3) holidayDate,DECODE(r,1,dy1,2,dy2,3,dy3) dy from (
					select a.date1 dt1,b.date1 dt2,c.date1 dt3,a.dy dy1,b.dy dy2,c.dy dy3 from
						(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) c), 
					(select 1 r from dual union all select 2 r from dual union all select 3 r from dual)
				) where dy in (6,7)
			</isEmpty>
			<isNotEmpty property="IDD1">
				<isEmpty property="IDD2">
					select holidayDate from (
						select DECODE(r,1,dt1,2,dt2,3,dt3,4,dt4,5,dt5,6,dt6) holidayDate,DECODE(r,1,dy1,2,dy2,3,dy3,4,dy4,5,dy5,6,dy6) dy from (
						select a.date1 dt1,b.date1 dt2,c.date1 dt3,d.date1 dt4,e.date1 dt5,f.date1 dt6,a.dy dy1,b.dy dy2,c.dy dy3,d.dy dy4,e.dy dy5,f.dy dy6 from 
							(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) c,(select to_char(to_date(#IDD11#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD11#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) d,(select to_char(to_date(#IDD12#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD12#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) e,(select to_char(to_date(#IDD13#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD13#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) f), 
						(select 1 r from dual union all select 2 r from dual union all select 3 r from dual union all select 4 r from dual 
								union all select 5 r from dual union all select 6 r from dual)
					) where dy in (6,7)
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="IDD2">
				select holidayDate from (
					select DECODE(r,1,dt1,2,dt2,3,dt3,4,dt4,5,dt5,6,dt6,7,dt7,8,dt8,9,dt9) holidayDate,
							DECODE(r,1,dy1,2,dy2,3,dy3,4,dy4,5,dy5,6,dy6,7,dy7,8,dy8,9,dy9) dy from (
					select a.date1 dt1,b.date1 dt2,c.date1 dt3,d.date1 dt4,e.date1 dt5,f.date1 dt6,g.date1 dt7,h.date1 dt8,i.date1 dt9,
							a.dy dy1,b.dy dy2,c.dy dy3,d.dy dy4,e.dy dy5,f.dy dy6,g.dy dy7,h.dy dy8,i.dy dy9 from 
						(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) c,(select to_char(to_date(#IDD11#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD11#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) d,(select to_char(to_date(#IDD12#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD12#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) e,(select to_char(to_date(#IDD13#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD13#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) f,(select to_char(to_date(#IDD21#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD21#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) g,(select to_char(to_date(#IDD22#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD22#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) h,(select to_char(to_date(#IDD23#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD23#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) i), 
					(select 1 r from dual union all select 2 r from dual union all select 3 r from dual union all select 4 r from dual 
							union all select 5 r from dual union all select 6 r from dual union all select 7 r from dual 
							union all select 8 r from dual union all select 9 r from dual)
				) where dy in (6,7)
			</isNotEmpty>
			order by holidayDate
		</select>
		
		<select id="checkForBIVTHoliday" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		   	select to_char(dated_on,'dd-mm-yy') holidayDate from cms_holiday_master 
				where (dated_on = to_date(#FDD#,'dd-mm-yy') 
					or dated_on = to_date(#FDD1#,'dd-mm-yy') 
					or dated_on = to_date(#FDD2#,'dd-mm-yy') 
					or dated_on = to_date(#FDD3#,'dd-mm-yy') 
					
					<isNotEmpty property="IDD1" prepend="or">
						dated_on = to_date(#IDD1#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD11#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD12#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD13#,'dd-mm-yy') 
					</isNotEmpty>
					
					<isNotEmpty property="IDD2" prepend="or">
						dated_on = to_date(#IDD2#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD21#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD22#,'dd-mm-yy') 
						or
						dated_on = to_date(#IDD23#,'dd-mm-yy') 
					</isNotEmpty>
         	) and office_id = (select OFFICE_ID from CMS_USER_MASTER where LOGIN_ID = #manager#)
         	union
			<isEmpty property="IDD1">
				select holidayDate from (
					select DECODE(r,1,dt1,2,dt2,3,dt3) holidayDate,DECODE(r,1,dy1,2,dy2,3,dy3) dy from (
					select a.date1 dt1,b.date1 dt2,c.date1 dt3,a.dy dy1,b.dy dy2,c.dy dy3 from
						(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) c), 
					(select 1 r from dual union all select 2 r from dual union all select 3 r from dual)
				) where dy in (6,7)
			</isEmpty>
			<isNotEmpty property="IDD1">
				<isEmpty property="IDD2">
					select holidayDate from (
						select DECODE(r,1,dt1,2,dt2,3,dt3,4,dt4,5,dt5,6,dt6) holidayDate,DECODE(r,1,dy1,2,dy2,3,dy3,4,dy4,5,dy5,6,dy6) dy from (
						select a.date1 dt1,b.date1 dt2,c.date1 dt3,d.date1 dt4,e.date1 dt5,f.date1 dt6,a.dy dy1,b.dy dy2,c.dy dy3,d.dy dy4,e.dy dy5,f.dy dy6 from 
							(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) c,(select to_char(to_date(#IDD11#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD11#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) d,(select to_char(to_date(#IDD12#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD12#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) e,(select to_char(to_date(#IDD13#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD13#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
							from dual) f), 
						(select 1 r from dual union all select 2 r from dual union all select 3 r from dual union all select 4 r from dual 
								union all select 5 r from dual union all select 6 r from dual)
					) where dy in (6,7)
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="IDD2">
				select holidayDate from (
					select DECODE(r,1,dt1,2,dt2,3,dt3,4,dt4,5,dt5,6,dt6,7,dt7,8,dt8,9,dt9) holidayDate,
							DECODE(r,1,dy1,2,dy2,3,dy3,4,dy4,5,dy5,6,dy6,7,dy7,8,dy8,9,dy9) dy from (
					select a.date1 dt1,b.date1 dt2,c.date1 dt3,d.date1 dt4,e.date1 dt5,f.date1 dt6,g.date1 dt7,h.date1 dt8,i.date1 dt9,
							a.dy dy1,b.dy dy2,c.dy dy3,d.dy dy4,e.dy dy5,f.dy dy6,g.dy dy7,h.dy dy8,i.dy dy9 from 
						(select to_char(to_date(#FDD1#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD1#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) a,(select to_char(to_date(#FDD2#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD2#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) b,(select to_char(to_date(#FDD3#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#FDD3#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) c,(select to_char(to_date(#IDD11#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD11#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) d,(select to_char(to_date(#IDD12#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD12#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) e,(select to_char(to_date(#IDD13#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD13#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) f,(select to_char(to_date(#IDD21#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD21#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) g,(select to_char(to_date(#IDD22#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD22#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) h,(select to_char(to_date(#IDD23#, 'dd-mm-yy'), 'D') as dy,to_char(to_date(#IDD23#, 'dd-mm-yy'),'dd-mm-yy') as Date1 
						from dual) i), 
					(select 1 r from dual union all select 2 r from dual union all select 3 r from dual union all select 4 r from dual 
							union all select 5 r from dual union all select 6 r from dual union all select 7 r from dual 
							union all select 8 r from dual union all select 9 r from dual)
				) where dy in (6,7)
			</isNotEmpty>
			order by holidayDate
		</select>
		
		<update id="updatePTDueDates" parameterClass="com.worldcheck.atlas.vo.TeamDetails">
			UPDATE CMS_TEAM_DETAILS 
			  SET REV_INTDUEDATE1 = decode(#dueDate1#,'',null,to_date(#dueDate1#,'dd-MM-YY')), 
			  REV_INTDUEDATE2 = decode(#dueDate2#,'',null,to_date(#dueDate2#,'dd-MM-YY')), 
			  REV_FINDUEDATE = to_date(#finalDueDate#,'dd-MM-YY'),
			  UPDATED_BY = #updatedBy#,
			  UPDATED_ON = SYSDATE
			  WHERE CRN = #crn# and TEAM_TYPE_ID = (select TEAM_TYPE_ID from CMS_TEAM_TYPE where TEAM_TYPE = 'Primary')
	   </update>
	   
	   <select id="getStatusForCases" resultClass="com.worldcheck.atlas.vo.CaseDetails" parameterClass="java.util.HashMap">
			SELECT ccm.CRN crn,ccm.CASE_STATUS_ID caseStatusId,ccsm.DESCRIPTION caseStatus
			FROM cms_clientcase ccm,CMS_CASE_STATUS_MASTER ccsm
			WHERE ccsm.CASE_STATUS_ID = ccm.CASE_STATUS_ID and crn in
					<iterate property="crnList" open="(" close=")" conjunction=",">
			      		#crnList[]#
			      	</iterate>
		</select>
		
		<select id="getPTMainAnalystForCases" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.util.HashMap">
			select MAIN_ANALYST mainAnalyst,crn from CMS_TEAM_DETAILS where TEAM_TYPE_ID =1 and crn in 
					<iterate property="crnList" open="(" close=")" conjunction=",">
			      		#crnList[]#
			      	</iterate>
		</select>
	   
		<select id="getLegacyCaseDetails" resultClass="com.worldcheck.atlas.vo.CaseDetails" parameterClass="java.lang.String">
			select ccc.crn crn,ccc.INTCLIENTDUEDATE1 cInterim1,ccc.INTCLIENTDUEDATE2 cInterim2,ccc.FINALDUEDATE finalDueDate,
			        ccc.CASEMGRID caseManagerName,cs.SUBJECTNAME primarySubjectName,ccm.COUNTRY primarySubjectCountryName
			from CLIENTCASE@legacy ccc,SUBJECT@legacy cs,CMS_COUNTRY_MASTER ccm 
			where ccc.crn = cs.crn and ccc.crn = #crn# and cs.ISPRIMARYSUB =1 and ccm.CODE=cs.COUNTRYID
		</select>
		
		
		<select id="getLegacyTeamDetails" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.lang.String">
			select a.CRN crn,a.TEAMID teamId,a.team_type_id teamTypeId,
			        decode(a.team_type_id,'1','Primary','3','Supporting - BI','4','Supporting - Vendor','Supporting - Internal') teamType,
			        a.dueDate1 dueDate1, a.dueDate2 dueDate2,a.finalDueDate finalDueDate ,b.OFFICEID,
			        b.OFFICE officeName, a.manager managerFullName
			from 
			((select distinct ca.CRN, ca.TEAMTYPE,ca.TEAMID, decode(ca.TEAMTYPE,'bi',ca.Assignee,'vendor0',ca.Assignee,'vendor1',ca.Assignee,null) manager,
			decode(ca.TEAMTYPE,'primary','1','bi','3','vendor0','4','vendor1','4','2') team_type_id,
			to_char(ca.INTDUEDATE1, 'dd-mm-YY') dueDate1,to_char(ca.INTDUEDATE2, 'dd-mm-YY') dueDate2,to_char(ca.FINDUEDATE, 'dd-mm-YY') finalDueDate 
			from CASEASSIGNMENT@legacy ca where ca.CRN= #crn#) a
			left join (select ct.crn,ct.ID,com.OFFICE,ct.OFFICEID from CASETEAM@legacy ct,CMS_OFFICE_MASTER com 
			where com.OFFICE_MASTER_ID = ct.OFFICEID) b on b.ID = a.TEAMID and b.CRN = a.CRN )
			order by team_type_id
		</select>
	   
		<delete id="deleteTeamDetailsForCrn" parameterClass="java.lang.String">
			delete from CMS_TEAM_DETAILS ctd  
			where ctd.CRN = #crn# 
		</delete>
	   
		<select id="getBITeamDetails" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.lang.String">
			select ctd.TEAM_ID teamId,ctd.CRN crn,ctd.TEAM_TYPE_ID teamTypeId,ctd.OFFICE_ID office,ctd.MANAGER_ID managerName,ctd.MAIN_ANALYST mainAnalyst,
			      to_char(ctd.REV_INTDUEDATE1, 'dd-mm-YY') dueDate1,to_char(ctd.REV_INTDUEDATE2, 'dd-mm-YY') dueDate2,
			      to_char(ctd.REV_FINDUEDATE, 'dd-mm-YY') finalDueDate,ctd.BYPASS_INTERIM byPassInterim, ctd.RESEARCH_HEAD researchHead  
			from CMS_TEAM_DETAILS ctd 
			where ctd.CRN = #crn# and ctd.TEAM_TYPE_ID = 3
		</select>
	   
		<update id="updateCaseManager" parameterClass="com.worldcheck.atlas.vo.CaseDetails">
			UPDATE CMS_CLIENTCASE 
			  SET 
			  CASE_MGR_ID = #caseMgrId#,
			  UPDATED_BY = #updatedBy#,
			  UPDATED_ON = SYSDATE
			  WHERE CRN = #crn#
	   </update>
	   
	   <select id="getAssociatedSubjectsGCC" resultClass="com.worldcheck.atlas.vo.SubjectDetails" parameterClass="java.lang.String">		
			SELECT 
			a.subject_id subjectId,
			a.entity_type_id entityTypeId,
			SUBSTR(',' || csv || ',',   instr(',' || csv || ',',   ',',   1,   r) + 1,   instr(',' || csv || ',',   ',',   1,   r + 1) -instr(',' || csv || ',',   ',',   1,   r) -1) reIds,
			crm.JLPOINTS reJlpPoints
			FROM CMS_MATRIX_MAP matrix,
			CMS_RE_MASTER crm ,
			(SELECT ccc.crn,
			sub.subject_id,
			sub.subject_name,
			sub.is_primary_sub,
			sub.entity_type_id,
			cem.entity_name,
			sub.country_id,
			sub.re_ids,
			sub.re_ids csv,
			ccm.country
			FROM cms_clientcase ccc,
			cms_subject sub,
			cms_country_master ccm,
			cms_entitytype_master cem
			WHERE ccc.crn =#crn#
			AND sub.crn = ccc.crn
			AND sub.country_id = ccm.country_master_id
			AND sub.entity_type_id = cem.entity_type_id)a,
			(select rownum r from dual connect by level <![CDATA[ <= ]]> 500)
			WHERE instr(csv || ',',   ',',   1,   r) > 0 
			AND matrix.FOR_AUTO_RE_CHECK=1
            AND matrix.STATUS=1
			AND  a.entity_type_id = matrix.ENTITY_TYPE_ID
			AND a.country_id = matrix.COUNTRY_MASTER_ID
			AND crm.RE_MASTER_ID = matrix.RE_ID 
			AND SUBSTR(',' || csv || ',',   instr(',' || csv || ',',   ',',   1,   r) + 1,   instr(',' || csv || ',',   ',',   1,   r + 1) -instr(',' || csv || ',',   ',',   1,   r) -1) =matrix.RE_ID
	   </select>
	   
	   <select id="getDaysBeforePtRdd" resultClass="java.lang.Integer" parameterClass="java.util.HashMap">
			SELECT days_before
			FROM cms_st_rdd_criteria
			WHERE client_code = #clientCode#
			 AND report_type = #reportType#
			 AND st_type = #teamType#
			 AND office = #office#
		</select>

           <select id="getAutoAddedSubjectList" resultClass="java.lang.String" parameterClass="java.lang.String">
			select subject_id from cms_subject where isReplicated=1 and crn=#crn#
	   </select>
	   
	   <select id="getOfficesForAutoAddedSubject" resultClass="java.lang.String">
			SELECT ofc.office FROM cms_subrep_auto_team autoTeam, cms_office_master ofc 
			WHERE autoteam.officeid = ofc.office_master_id
	   </select>
	   

	   <select id="getCountryREList" resultClass="com.worldcheck.atlas.vo.TeamOfficeVO" parameterClass="java.lang.String">
		
			SELECT cid.RE_MASTER_ID reId,cid.CODE countryCode
			FROM cms_clientcase cc
			LEFT JOIN cms_client_master cm
			     ON cc.CLIENT_CODE = cm.CLIENT_CODE
			LEFT JOIN cms_subrep_insertdetails cid
			     ON cm.CLIENT_MASTER_ID = cid.CLIENT_MASTER_ID
			LEFT JOIN cms_subject sub
			     ON cc.crn         = sub.crn
			  WHERE cc.crn         = #crn#
			AND sub.isreplicated   = 1
			AND sub.ENTITY_TYPE_ID = cid.ENTITY_TYPE_ID
			GROUP BY cid.RE_MASTER_ID,
			  cid.CODE

	   </select>
	   
		
	<resultMap id="tabAutoCaseDetailsVO" class="com.worldcheck.atlas.vo.CaseDetails" groupBy="crn">
			<result property="crn" column="CRN" />
			<result property="officeBasedSubjectList" resultMap="OfficeAssignment.tabAutoOfficeVO"/>
	</resultMap>

	<resultMap id="tabAutoOfficeVO" class="com.worldcheck.atlas.vo.masters.BranchOfficeMasterVO" groupBy="branchOffice">
			<result property="branchOffice" column="OFFICE"/>
			<result property="subjectList" resultMap="OfficeAssignment.tabAutoSubjectDetailsVO"/>
	</resultMap>
	
	<resultMap id="tabAutoSubjectDetailsVO" class="com.worldcheck.atlas.vo.SubjectDetails" groupBy="subjectId">
			<result property="subjectId" column="SUBJECT_ID"/>
			<result property="reList" resultMap="OfficeAssignment.tabAutoREMasterVO"/>
	</resultMap>

	<resultMap id="tabAutoREMasterVO" class="com.worldcheck.atlas.vo.masters.ResearchElementMasterVO">
			<result property="rEMasterId" column="RE_ID"/>
			<result property="isShared" column="IS_SHARED"/>
		  	<result property="points" column="RE_POINTS"/>
	</resultMap>

	   <select id="getAutoPopulatedCases" resultMap="tabAutoCaseDetailsVO" parameterClass="java.util.HashMap">
			SELECT
			crn,
			subject_id, 
			 matrix.re_id,
			 matrix.is_shared,
			(select om.office from cms_office_master om where om.office_master_id = matrix.office_id) as office,
			(select JLPOINTS from cms_re_master where re_master_id = matrix.re_id) as re_points
			FROM CMS_MATRIX_MAP matrix,
			(SELECT ccc.crn,
			sub.subject_id,
			sub.subject_name,
			sub.is_primary_sub,
			sub.entity_type_id,
			cem.entity_name,
			sub.country_id,
			sub.re_ids,
			sub.re_ids csv,
			ccm.country
			FROM cms_clientcase ccc,
			cms_subject sub,
			cms_country_master ccm,
			cms_entitytype_master cem
			WHERE ccc.crn in
				 <iterate property="taskList" open="(" close=")" conjunction=",">
					  #taskList[].crn#
				 </iterate> 
			AND sub.crn = ccc.crn
			AND sub.country_id = ccm.country_master_id
			AND sub.entity_type_id =
			cem.entity_type_id
			order by ccc.crn) a,
			(select rownum r from dual connect by level <![CDATA[ <= ]]>
			500)
			WHERE instr(csv || ',', ',', 1, r) > 0
			AND a.entity_type_id = matrix.entity_type_id
			AND a.country_id = matrix.COUNTRY_MASTER_ID
			AND matrix.status = 1
			AND SUBSTR(',' || csv || ',', instr(',' || csv || ',', ',', 1, r) + 1,
			instr(',' || csv || ',', ',', 1, r + 1) -instr(',' || csv || ',', ',',
			1, r) -1) = matrix.RE_ID
	</select>


	<resultMap id="tabCaseDeatailCountryREList" class="com.worldcheck.atlas.vo.CaseDetails" groupBy="crn">
			<result property="crn" column="CRN" />
			<result property="subjectList" resultMap="OfficeAssignment.tabSubjectDetailsCountryREList"/>
	</resultMap>

	<resultMap id="tabSubjectDetailsCountryREList" class="com.worldcheck.atlas.vo.SubjectDetails">
			<result property="subjectId" column="SUBJECT_ID"/>
			<result property="replicationListofRE" resultMap="OfficeAssignment.tabTeamOfficeVOCountryREList"/>
	</resultMap>

	<resultMap id="tabTeamOfficeVOCountryREList" class="com.worldcheck.atlas.vo.TeamOfficeVO">
			<result property="reId" column="RE_MASTER_ID"/>
			<result property="countryCode" column="CODE"/>
			<result property="jlPoints" column="JLPOINTS"/>
	</resultMap>
	
	<select id="getTabCountryREList" resultMap="tabCaseDeatailCountryREList" parameterClass="java.util.HashMap">
			SELECT cc.crn,sub.subject_id, cid.RE_MASTER_ID,crm.jlpoints ,cid.CODE 
			FROM cms_clientcase cc
			LEFT JOIN cms_client_master cm
			ON cc.CLIENT_CODE = cm.CLIENT_CODE
			LEFT JOIN cms_subrep_insertdetails cid
			ON cm.CLIENT_MASTER_ID = cid.CLIENT_MASTER_ID
			LEFT JOIN cms_subject sub
			ON cc.crn         = sub.crn
			LEFT JOIN cms_re_master crm 
			on crm.re_master_id= cid.RE_MASTER_ID
			WHERE cc.crn in
				 <iterate property="taskList" open="(" close=")" conjunction=",">
					  #taskList[].crn#
				 </iterate> 
			AND sub.isreplicated   = 1
			AND sub.ENTITY_TYPE_ID = cid.ENTITY_TYPE_ID
			GROUP BY cc.crn,cid.RE_MASTER_ID,
			cid.CODE,sub.subject_id,crm.jlpoints
	</select>
	   
	</sqlMap>