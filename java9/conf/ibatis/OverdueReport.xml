<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="OverDueCases">

<!--==========================================================Query For OverDue Reports=================================================================  -->

<select id='overDueTeamLevel' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="com.worldcheck.atlas.vo.report.OverdueReportVO">

 SELECT *
   FROM
  (SELECT a.*,
    ROWNUM rn
     FROM
    (select CRN crn, PRIMARY_SUBJECT_NAME primarySubName,wm_concat(OFFICE) office, wm_concat(COUNTRY) countryName,
wm_concat(TO_CHAR(TEAM_INT_DUE_DATE1,'DD-MM-YYYY')) interim1DueDate, wm_concat(TO_CHAR(TEAM_INT_DUE_DATE2,'DD-MM-YYYY')) interim2DueDate, 
wm_concat(TO_CHAR(TEAM_FINAL_DUE_DATE,'DD-MM-YYYY')) finalDate, wm_concat(OVERDUE_BY) overDueBy, wm_concat(CASE_MANAGER) caseManager,
wm_concat(OVERDUE_STAGE) overdueStage
from (select * from dw_overdue_team_lvl)
Where 
(case when OVERDUE_STAGE=1 and  INT1RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=2 and  INT2RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=3 and  FINALRESEARCHCOMPDT is null then 1
else 0  end )=1
<!--<dynamic prepend = "AND"> -->
			<isNotNull prepend="AND" property="office">
			<isNotEmpty property="office">
				OFFICE_ID = #office#
				</isNotEmpty>
				</isNotNull>
<!--</dynamic> -->
GROUP BY CRN, PRIMARY_SUBJECT_NAME 
ORDER BY upper($sortColumnName$) $sortType$
    ) a WHERE ROWNUM <![CDATA[ <= ]]> $limit$) WHERE rn <![CDATA[ >= ]]> $start$ 

<!--
select CRN crn, PRIMARY_SUBJECT_NAME primarySubName,wm_concat(OFFICE) office, wm_concat(COUNTRY) countryName,
wm_concat(TO_CHAR(TEAM_INT_DUE_DATE1,'DD-MM-YYYY')) interim1DueDate, wm_concat(TO_CHAR(TEAM_INT_DUE_DATE2,'DD-MM-YYYY')) interim2DueDate, 
wm_concat(TO_CHAR(TEAM_FINAL_DUE_DATE,'DD-MM-YYYY')) finalDate, wm_concat(OVERDUE_BY) overDueBy, wm_concat(CASE_MANAGER) caseManager,
wm_concat(OVERDUE_STAGE) overdueStage
from (select * from (SELECT  a.*, ROWNUM rn FROM (select * from dw_overdue_team_lvl) a WHERE ROWNUM <![CDATA[ <= ]]> $limit$) WHERE rn <![CDATA[ >= ]]> $start$)
<dynamic prepend = "WHERE">
			<isNotNull prepend="AND" property="office">
			<isNotEmpty property="office">
				OFFICE_ID = #office#
				</isNotEmpty>
				</isNotNull>
</dynamic>
GROUP BY CRN, PRIMARY_SUBJECT_NAME
ORDER BY upper($sortColumnName$) $sortType$
!-->
</select>


<select id='overDueTeamLevel_Team' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="com.worldcheck.atlas.vo.report.OverdueReportVO">

 SELECT *
   FROM
  (SELECT a.*,
    ROWNUM rn
     FROM
    (
select CRN crn, PRIMARY_SUBJECT_NAME primarySubName,wm_concat(OFFICE) office, wm_concat(COUNTRY) countryName,
wm_concat(TO_CHAR(TEAM_INT_DUE_DATE1,'DD-MM-YYYY')) interim1DueDate, wm_concat(TO_CHAR(TEAM_INT_DUE_DATE2,'DD-MM-YYYY')) interim2DueDate, 
wm_concat(TO_CHAR(TEAM_FINAL_DUE_DATE,'DD-MM-YYYY')) finalDate, wm_concat(OVERDUE_BY) overDueBy, wm_concat(CASE_MANAGER) caseManager,
wm_concat(OVERDUE_STAGE) overdueStage
from (select * from dw_overdue_team_lvl) 
Where
TEAM_TYPE = #office#
AND (case when OVERDUE_STAGE=1 and  INT1RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=2 and  INT2RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=3 and  FINALRESEARCHCOMPDT is null then 1
else 0  end )=1
GROUP BY CRN, PRIMARY_SUBJECT_NAME
ORDER BY upper($sortColumnName$) $sortType$
) a WHERE ROWNUM <![CDATA[ <= ]]> $limit$) WHERE rn <![CDATA[ >= ]]> $start$ 
</select>

<select id='overDueCaseLevel' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="com.worldcheck.atlas.vo.report.OverdueReportVO">

<!-- SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
select distinct CRN crn, PRIMARY_SUBJECT_NAME primarySubName,COUNTRY countryName,
TO_CHAR(CLIENT_INT_DUE_DATE1, 'DD-MM-YYYY') interim1DueDate, TO_CHAR(CLIENT_INT_DUE_DATE2, 'DD-MM-YYYY') interim2DueDate, 
TO_CHAR(CLIENT_FINAL_DUE_DATE, 'DD-MM-YYYY') finalDate, OVERDUE_BY overDueBy,CASE_MANAGER caseManager,
OVERDUE_STAGE overdueStage
from dw_overdue_case_lvl
ORDER BY upper($sortColumnName$) $sortType$
) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start# -->


SELECT CRN crn, primarySubName, countryName, TO_CHAR(CLIENT_INT_DUE_DATE1, 'DD-MM-YYYY') interim1DueDate, 
TO_CHAR(CLIENT_INT_DUE_DATE2, 'DD-MM-YYYY') interim2DueDate,  TO_CHAR(CLIENT_FINAL_DUE_DATE, 'DD-MM-YYYY') finalDate, 
overDueBy, caseManager, OVERDUE_STAGE overdueStage 
FROM (SELECT  a.*, ROWNUM rn FROM ( 

select distinct CRN crn, 
PRIMARY_SUBJECT_NAME primarySubName,COUNTRY countryName, CLIENT_INT_DUE_DATE1, 
CLIENT_INT_DUE_DATE2,  CLIENT_FINAL_DUE_DATE, OVERDUE_BY overDueBy,CASE_MANAGER caseManager, OVERDUE_STAGE
from dw_overdue_case_lvl
where

(case when OVERDUE_STAGE=1 and  CLIENT_INT_SENTDATE1 is null then 1
when OVERDUE_STAGE=2 and  CLIENT_INT_SENTDATE2 is null then 1
when OVERDUE_STAGE=3 and  CLIENT_FINAL_SENTDATE is null then 1
else 0  end )=1
ORDER BY 
	<isEqual property="sortColumnName" compareValue="interim1DueDate">	
	(CLIENT_INT_DUE_DATE1) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="interim2DueDate">	
	(CLIENT_INT_DUE_DATE2) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="finalDate">	
	(CLIENT_FINAL_DUE_DATE) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="overDueBy">	
	(OVERDUE_BY) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="crn">	
	upper($sortColumnName$) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="primarySubName">	
	upper($sortColumnName$) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="countryName">	
	upper($sortColumnName$) 
	</isEqual>
	<isEqual property="sortColumnName" compareValue="caseManager">	
	upper($sortColumnName$) 
	</isEqual>
	
$sortType$
) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
</select>


<!-- ==============================================================<Count_Query>===================================== -->



<select id='overDueTeamLevel_Count' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="java.lang.Integer">

select count(*) from
(
select CRN crn, PRIMARY_SUBJECT_NAME primarySubName,wm_concat(OFFICE) office, wm_concat(COUNTRY) countryName,
wm_concat(TO_CHAR(TEAM_INT_DUE_DATE1,'DD-MM-YYYY')) interim1DueDate, wm_concat(TO_CHAR(TEAM_INT_DUE_DATE2,'DD-MM-YYYY')) interim2DueDate, 
wm_concat(TO_CHAR(TEAM_FINAL_DUE_DATE,'DD-MM-YYYY')) finalDate, wm_concat(OVERDUE_BY) overDueBy, wm_concat(CASE_MANAGER) caseManager,
wm_concat(OVERDUE_STAGE) overdueStage
from (select * from (SELECT  a.*, ROWNUM rn FROM (select * from dw_overdue_team_lvl) a ))
Where (case when OVERDUE_STAGE=1 and  INT1RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=2 and  INT2RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=3 and  FINALRESEARCHCOMPDT is null then 1
else 0  end )=1

<!-- <dynamic prepend = "WHERE">-->
			<isNotNull prepend="AND" property="office">
			<isNotEmpty property="office">
				OFFICE_ID = #office#
				</isNotEmpty>
				</isNotNull>
<!-- </dynamic> -->
GROUP BY CRN, PRIMARY_SUBJECT_NAME

)
</select>


<select id='overDueTeamLevel_Team_Count' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="java.lang.Integer">


select count(CRN) 
from (
select CRN crn, PRIMARY_SUBJECT_NAME primarySubName,wm_concat(OFFICE) office, wm_concat(COUNTRY) countryName,
wm_concat(TO_CHAR(TEAM_INT_DUE_DATE1,'DD-MM-YYYY')) interim1DueDate, wm_concat(TO_CHAR(TEAM_INT_DUE_DATE2,'DD-MM-YYYY')) interim2DueDate, 
wm_concat(TO_CHAR(TEAM_FINAL_DUE_DATE,'DD-MM-YYYY')) finalDate, wm_concat(OVERDUE_BY) overDueBy, wm_concat(CASE_MANAGER) caseManager,
wm_concat(OVERDUE_STAGE) overdueStage
from (select * from dw_overdue_team_lvl) 
Where
TEAM_TYPE = #office#
AND (case when OVERDUE_STAGE=1 and  INT1RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=2 and  INT2RESEARCHCOMPDT is null then 1
when OVERDUE_STAGE=3 and  FINALRESEARCHCOMPDT is null then 1
else 0  end )=1
GROUP BY CRN, PRIMARY_SUBJECT_NAME
) 


</select>



<select id='overDueCaseLevel_Count' parameterClass="com.worldcheck.atlas.vo.report.OverdueReportVO" resultClass="java.lang.Integer">


select count(CRN)
from dw_overdue_case_lvl
where

(case when OVERDUE_STAGE=1 and  CLIENT_INT_SENTDATE1 is null then 1
when OVERDUE_STAGE=2 and  CLIENT_INT_SENTDATE2 is null then 1
when OVERDUE_STAGE=3 and  CLIENT_FINAL_SENTDATE is null then 1
else 0  end )=1
</select>
<!-- ===================================================================================================== -->

<!-- ===================================Query for Due Today Report ======================================= -->

<select id='dueTodayDetails' parameterClass="com.worldcheck.atlas.vo.report.CaseDueTodayVO" resultClass="com.worldcheck.atlas.vo.report.CaseDueTodayVO">

	SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
select 
CRN crn,
decode(IS_EXPRESS,1,'Yes',0,'No') expressCase,
<!-- PRIORITY priority, -->
PRIMARY_SUBJECT_NAME primarySubName,
CURRENT_PROCESSCYCLE processCycle,
PRIMARY_ANALYST primaryAnalystName,
OFFICE office,
CASE_MANAGER caseManager
FROM DW_CASES_DUE_TODAY_TMRW
WHERE 
(CLIENT_INT_DUE_DATE1 = TO_DATE(sysdate,'DD-MON-RR') AND (overdue_stage = 1 OR overdue_stage = 0))
OR
(CLIENT_INT_DUE_DATE2 = TO_DATE(sysdate,'DD-MON-RR')  AND (overdue_stage = 2 OR overdue_stage = 0))
OR
(CLIENT_FINAL_DUE_DATE = TO_DATE(sysdate,'DD-MON-RR') AND (overdue_stage = 3 OR overdue_stage = 0))
ORDER BY upper($sortColumnName$) $sortType$
) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#

</select>


<select id="dueTodayDetailsCount" resultClass="java.lang.Integer">


 select count
(CRN)
FROM DW_CASES_DUE_TODAY_TMRW
WHERE 
(CLIENT_INT_DUE_DATE1 = TO_DATE(sysdate,'DD-MON-RR') AND (overdue_stage = 1 OR overdue_stage = 0))
OR
(CLIENT_INT_DUE_DATE2 = TO_DATE(sysdate,'DD-MON-RR')  AND (overdue_stage = 2 OR overdue_stage = 0))
OR
(CLIENT_FINAL_DUE_DATE = TO_DATE(sysdate,'DD-MON-RR') AND (overdue_stage = 3 OR overdue_stage = 0))
</select>

<!-- ================================================================================================== -->


<!-- ==========================================Query For ON Hold Reports=============================== -->

<select id="allOnHoldCasesDetails"  parameterClass="com.worldcheck.atlas.vo.report.AllOnHoldCaseVO" resultClass="com.worldcheck.atlas.vo.report.AllOnHoldCaseVO">

SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
SELECT
CRN crn,
SUBJECT_NAME subjectName,
OFFICE officeName,
CLIENT_NAME clientName,
CASE_RECEIVED_DATE caseReceivedDate,
CASE_DUE_DATE caseDueDate,
TOTAL totalDays,
CASE_MANAGER caseManager,
MAIN_ANALYST analystName
FROM
DW_ONHOLD_CASES
ORDER BY upper($sortColumnName$) $sortType$
) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
</select>


<select id="allOnHoldCasesDetailsCount" resultClass="java.lang.Integer">

Select count(CRN)
FROM DW_ONHOLD_CASES
</select>
<!-- =========================================================================================================== -->

</sqlMap>

