<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="FinanceOverview">

	<select id="reportTypeSummaryForCaseReceivedDdate"
		resultClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
<!--
	select
	distinct(
	drtos_mv.report_type) reportType,
	sum(drtos_mv.CASE_COUNT) numberOfCases,
	sum(drtos_mv.CASE_FEE) caseFee
	from dw_rpt_type_ofc_smry_case_lvl drtos_mv
	where
	TO_DATE(REQ_RECD_DT,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by drtos_mv.report_type 
    	
	-->
	SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
	select RCN reportType,report_type_id ,sum(numberOfCases) numberOfCases,
	sum(caseFee)caseFee
	from
	(
	select
	report_type_id ,
	sum(CASE_COUNT) numberOfCases,
	sum(CASE_FEE) caseFee,
	report_crn_initial	rcn
	from DW_RPT_TYPE_OFC_SMRY_case_lvl
	where
		TO_DATE(REQ_RECD_DT,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
		AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') <![CDATA[ <= ]]> TO_DATE(#endDate#,'DD-Mon-YYYY')
		group by report_type_id,sub_report_type_id,report_crn_initial
	order by report_type_id,sub_report_type_id
	) innerQuery
	group by RCN,report_type_id
	order by report_type_id,rcn) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
			
	
	</select>
	
	<select id="reportTypeSummaryForCaseReceivedDdateCount"
	resultClass="java.lang.Integer"
	parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
		select count(*) from
		(select RCN reportType,report_type_id ,sum(numberOfCases) numberOfCases,
		sum(caseFee)caseFee
		from
		(
		select
		report_type_id ,
		sum(CASE_COUNT)
		numberOfCases,
		sum(CASE_FEE) caseFee,
		report_crn_initial rcn
		from
		DW_RPT_TYPE_OFC_SMRY_case_lvl
		where
		TO_DATE(REQ_RECD_DT,'DD-Mon-RR') >=
		TO_DATE(#startDate#,'DD-Mon-YYYY')
		AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') <![CDATA[ <= ]]>
		TO_DATE(#endDate#,'DD-Mon-YYYY')
		group by
		report_type_id,sub_report_type_id,report_crn_initial
		order by
		report_type_id,sub_report_type_id
		) innerQuery
		group by
		RCN,report_type_id
		order by report_type_id,rcn)

	</select>
	
	<select id="OfficeSummaryForCaseReceivedDdate"
		resultClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	
	SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (select
	distinct(drtos_mv.OFFICE) office,	
	sum(drtos_mv.CASE_COUNT) numberOfCases,
	sum(drtos_mv.CASE_FEE) caseFee
	from dw_rpt_type_ofc_smry_case_lvl drtos_mv
	where
	office is not null
	AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by drtos_mv.office) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
    	
	</select>
	
	<select id="OfficeSummaryForCaseReceivedDdateCount"
		resultClass="java.lang.Integer"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	select count(*) from(
	select
	distinct(drtos_mv.OFFICE) office,	
	sum(drtos_mv.CASE_COUNT) numberOfCases,
	sum(drtos_mv.CASE_FEE) caseFee
	from dw_rpt_type_ofc_smry_case_lvl drtos_mv
	where
	office is not null
	AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(REQ_RECD_DT,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by drtos_mv.office)
    	
	</select>
	
	
	<select id="reportTypeSummaryForInvoiceDate"
		resultClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
	select
	distinct(
	report_type )reportType,
	count(distinct crn) numberOfCases,
	sum(distinct CASE_FEE) caseFee
	from DW_RPT_TYPE_OFC_SMRY_INV_LVL
	where
	TO_DATE(INVOICE_DATE,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(INVOICE_DATE,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by report_type) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
  
		
	</select>
	
	<select id="reportTypeSummaryForInvoiceDateCount"
		resultClass="java.lang.Integer"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	select count(*) from(
	select
	distinct(
	report_type )reportType,
	count(distinct crn) numberOfCases,
	sum(distinct CASE_FEE) caseFee
	from DW_RPT_TYPE_OFC_SMRY_INV_LVL
	where
	TO_DATE(INVOICE_DATE,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(INVOICE_DATE,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by report_type)
  
		
	</select>
	
	<select id="OfficeSummaryForInvoiceDate"
		resultClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
	select
	distinct (OFFICE) office,
	
	count(distinct crn) numberOfCases,
	sum(distinct CASE_FEE) caseFee
	from DW_RPT_TYPE_OFC_SMRY_INV_LVL
	where
	TO_DATE(INVOICE_DATE,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(INVOICE_DATE,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by office) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
  
		
	</select>
	
	<select id="OfficeSummaryForInvoiceDateCount"
		resultClass="java.lang.Integer"
		parameterClass="com.worldcheck.atlas.vo.report.ReportTypeAndOfficeSummaryVO">
	select count(*) from(
	select
	distinct (OFFICE) office,
	
	count(distinct crn) numberOfCases,
	sum(distinct CASE_FEE) caseFee
	from DW_RPT_TYPE_OFC_SMRY_INV_LVL
	where
	TO_DATE(INVOICE_DATE,'DD-Mon-RR') >= TO_DATE(#startDate#,'DD-Mon-YYYY')
	AND TO_DATE(INVOICE_DATE,'DD-Mon-RR') <![CDATA[ <= ]]>
	TO_DATE(#endDate#,'DD-Mon-YYYY')
	group by office)
  
		
	</select>
	
	
	
	
	<select id="invoiceTATReport" 
	resultClass="com.worldcheck.atlas.vo.report.InvoiceTATReportVO" 
	parameterClass ="java.util.HashMap">

	SELECT
	CASE_TOTAL totalCaseCount,
	DECODE(CASE_WITHIN_48HOURS,NULL,0,CASE_WITHIN_48HOURS)within48Hours,
	DECODE(CASE_OVER_48HOURS,NULL,0,CASE_OVER_48HOURS) over48Hours
	FROM DW_48_HOURS_TAT
	WHERE MONTH= #month#
	AND YEAR = #year#
	
	</select>
	
	<select id="completedCasesRevenueSummary" parameterClass = "java.lang.String" resultClass="com.worldcheck.atlas.vo.report.RevenueSummaryVO">
		SELECT NVL(sum(cmp_case_count),0) numberOfCases , NVL(sum(cmp_revenue),0) revenue, FINAL_SENT_MONTH month 
		FROM DW_REVENUE_SUMMARY
		WHERE FINAL_SENT_YEAR = #year# 
		GROUP BY FINAL_SENT_MONTH	
	
	</select>
	
	<select id="inProgressRevenueSummary" parameterClass = "java.lang.String" resultClass="com.worldcheck.atlas.vo.report.RevenueSummaryVO">
		SELECT NVL(SUM(WIP_CASE_COUNT),0) numberOfCases , NVL(SUM(WIP_REVENUE),0) revenue ,'In Progress' as caseStatus FROM
		DW_REVENUE_SUMMARY
		WHERE FINAL_SENT_YEAR = #year# 
		
	</select>
	
	
	
</sqlMap>
