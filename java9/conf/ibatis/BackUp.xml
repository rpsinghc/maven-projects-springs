<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="UserBackUp">

	<select id="getBackUp" parameterClass="java.util.HashMap" resultClass="com.worldcheck.atlas.vo.UserBackUpVO" >	  
		SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
		SELECT  
		CUM.USER_FULL_NAME userFullName,CUL.USER_ID userId, TO_CHAR(TO_DATE(CUL.FROM_DATE,'DD-Mon-RRRR'),'DD-Mon-RRRR') fromDate, 
		TO_CHAR(TO_DATE(CUL.TO_DATE,'DD-Mon-RRRR'),'DD-Mon-RRRR') toDate,CUL.LEAVE_TYPE leaveType,CLTM.DESCRIPTION leaveDesc
		FROM 
		CMS_USER_LEAVE CUL,
		CMS_Leave_Type_MASTER CLTM,
		CMS_USER_MASTER CUM
		WHERE (CUL.BACKUP1=#userId# OR  CUL.BACKUP2=#userId#)
		 AND
             CUM.LOGIN_ID = CUL.USER_ID
		AND to_date (sysdate, 'DD-MON-RRRR') between to_date (CUL.FROM_DATE, 'DD-MON-RRRR')
		AND to_date (CUL.TO_DATE, 'DD-MON-RRRR')
		AND
		CLTM.LEAVE_TYPE_MASTER_ID = CUL.LEAVE_TYPE
	
		ORDER By upper($sortColumnName$) $sortType$	) a WHERE ROWNUM <![CDATA[ <= ]]> #limit#) WHERE rn <![CDATA[ >= ]]> #start#
	  </select>    
	 
	 <select id="totalBackUpList" parameterClass="String" resultClass="int" >			
		SELECT  
		count(*)
		FROM 
		CMS_USER_LEAVE CUL,
		CMS_Leave_Type_MASTER CLTM,
		CMS_USER_MASTER CUM
		WHERE (CUL.BACKUP1=#userId# OR  CUL.BACKUP2=#userId#)
		 AND
             CUM.LOGIN_ID = CUL.USER_ID
		AND to_date (sysdate, 'DD-MON-RRRR') between to_date (CUL.FROM_DATE, 'DD-MON-RRRR')
		AND to_date (CUL.TO_DATE, 'DD-MON-RRRR')
		AND
		CLTM.LEAVE_TYPE_MASTER_ID = CUL.LEAVE_TYPE			
	  </select> 
</sqlMap>