<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="UpdateCTData">

<update id="updateCRNAccounts" parameterClass="com.worldcheck.atlas.vo.UpdateCTDataExcelVO">
	UPDATE CMS_TOCAPETOWN_INFO
	SET
	<dynamic prepend=" "> 
	<isNotNull  prepend="," property="invCurrency" removeFirstPrepend="true">
	
		CURRENCY_CODE = #invCurrency#
	
	</isNotNull>
	<isNotNull prepend="," property="invAmount" removeFirstPrepend="true">
	
		INVOICE_AMOUNT = #invAmount#
	
	</isNotNull>
	<isNotNull prepend="," property="invNumber" removeFirstPrepend="true">
	
		INVOICE_NUMBER = #invNumber#
	
	</isNotNull>
	<isNotNull prepend="," property="invDate" removeFirstPrepend="true">
	
		INVOICE_DATE = #invDate#
	
	</isNotNull>
	<isNotNull prepend="," property="ctDate" removeFirstPrepend="true">
	
		CT_DATE = #ctDate#
	
	</isNotNull>
	
	<isNotNull prepend="," property="updatedBy" removeFirstPrepend="true">
	
		UPDATED_BY = #updatedBy#
	
	</isNotNull>
	
	
		
	,	UPDATED_ON = SYSDATE	
	
	WHERE
	CRN = #crn#
	</dynamic>

</update>


<insert id="insertCRNAccounts" parameterClass="com.worldcheck.atlas.vo.UpdateCTDataExcelVO">

	
	INSERT INTO
	CMS_TOCAPETOWN_INFO(ID,CRN,CURRENCY_CODE,INVOICE_AMOUNT,INVOICE_NUMBER,INVOICE_DATE,CT_DATE,UPDATED_BY,UPDATED_ON)
	VALUES(CMS_TOCAPETOWNINFO_SEQ.nextval,
	#crn#,
	#invCurrency#,
	#invAmount#,
	#invNumber#,
	#invDate#,
	#ctDate#,
	#updatedBy#,
	SYSDATE)
	

	</insert>



<select id="isAvailActiveCurrencyCode" parameterClass="java.util.HashMap" 
resultClass="java.lang.Integer">
	SELECT COUNT(CURRENCY_CODE)
	 FROM CMS_CURRENCY_MASTER
	WHERE UPPER(CURRENCY_CODE) = UPPER(#currencyCode#)
	AND STATUS = 1


</select>

<select id="isAvailCRNinToCapeTown" parameterClass="com.worldcheck.atlas.vo.UpdateCTDataExcelVO" 
resultClass="java.lang.Integer">
	SELECT COUNT(CRN)
	 FROM CMS_TOCAPETOWN_INFO
	WHERE UPPER(CRN) = UPPER(#crn#)
	


</select>


<select id="getCRNData" resultClass="java.lang.String" parameterClass="java.util.List">
       SELECT CRN
		FROM CMS_TOCAPETOWN_INFO
		 WHERE CRN IN <iterate open="(" close=")" conjunction=",">
      #crnNumbers[]#
     </iterate>
</select>


<select id="getCRNListfromClientCase" resultClass="java.lang.String" parameterClass="java.util.List">
       SELECT upper(CRN) crn
		FROM CMS_CLIENTCASE
		WHERE CRN IN <iterate open="(" close=")" conjunction=",">
      #crnNumbers[]#
     </iterate>
		 
</select>

<select id="getAllActiveCurrencyCode"  resultClass="java.lang.String">
	SELECT upper(CURRENCY_CODE) currencyCode
	 FROM CMS_CURRENCY_MASTER	
	WHERE STATUS = 1


</select>



</sqlMap>
