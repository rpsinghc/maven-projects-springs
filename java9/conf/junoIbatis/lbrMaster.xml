<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="LBRMasterVO">

	<resultMap id="countryVO" class="com.worldcheck.juno.vo.master.CountryVO">
		<result property="id" column="country_master_id" />
		<result property="name" column="COUNTRY" />
	</resultMap>
	<resultMap id="entityMasterVO" class="com.worldcheck.juno.vo.master.EntityMasterVO">
		<result property="entityId" column="ENTITY_TYPE_ID" />
		<result property="entityName" column="ENTITY_NAME" />

	</resultMap>

    <resultMap id="lbrHeaderVO" class="com.worldcheck.juno.vo.master.LBRHeaderVO">
		<result property="lbrHeader" column="LBR_HEADER" />
		<result property="id" column="LBR_INFO_ID" />
	</resultMap>

	<resultMap id="result" class="com.worldcheck.juno.vo.master.LBRMasterRecordVO" groupBy="id">
		<result property="id" column="RG_LBR_COUNTRY_MASTER_ID" />
		<!-- <result property="dataSet" column="LBR_DATA_SET" />
		<result property="dataSetDescription" column="LBR_DATA_DESC" />-->
		<result property="status" column="STATUS" />
		<result property="countryVO" resultMap="LBRMasterVO.countryVO" />
		<!--<result property="entityMasterVO" resultMap="LBRMasterVO.entityMasterVO" />
		 <result property="lbrHeaderVO" resultMap="LBRMasterVO.lbrHeaderVO" />-->

	</resultMap> 
	
	<resultMap id="resultExport" class="com.worldcheck.juno.vo.master.LBRMasterRecordVO" groupBy="id">
		<result property="id" column="LBR_COUNTRY_MASTER_ID" />
		<result property="status" column="STATUS" />
		<result property="countryVO" resultMap="LBRMasterVO.countryVO" />
		<result property="datasets" resultMap="LBRMasterVO.getListByIdResult" />

	</resultMap> 
	
	<resultMap id="getByIdResult" class="com.worldcheck.juno.vo.master.LBRMasterRecordVO">
		<result property="id" column="RG_LBR_COUNTRY_MASTER_ID" />
		<result property="status" column="STATUS" />
		<result property="countryVO" resultMap="LBRMasterVO.countryVO" />
	</resultMap> 
	
	<resultMap id="getListByIdResult" class="com.worldcheck.juno.vo.master.LBRMasterVO">
		<result property="id" column="LBR_DATA_ID" />
		<result property="dataSet" column="LBR_DATA_SET" />
		<result property="dataSetDescription" column="LBR_DATA_DESC" />
		<result property="lbrHeaderVO" resultMap="LBRMasterVO.lbrHeaderVO" />
		<result property="entityMasterVO" resultMap="LBRMasterVO.entityMasterVO" />
	</resultMap> 
	
	<select id="checkActiveEntryForCountry" resultClass="java.lang.Boolean">
	
	select case when count(*) > 0 then 'true' else 'false' end
	
		from RG_LBR_COUNTRY_MASTER lbrcm
		
		where
		lbrcm.STATUS ='1'
	  and lbrcm.COUNTRY_MASTER_ID = (select country_master_id from rg_lbr_country_master rg where rg.rg_lbr_country_master_id = #recordId#)
	  and lbrcm.RG_LBR_COUNTRY_MASTER_ID!=#recordId#
	  
	</select>
	
	<select id="checkActiveEntry" resultClass="java.lang.Boolean">

		select case when count(*) > 0 then 'true' else 'false' end
		from RG_LBR_COUNTRY_MASTER lbrcm
		where
		lbrcm.STATUS ='1'
        and lbrcm.COUNTRY_MASTER_ID = #countryId#
        and lbrcm.RG_LBR_COUNTRY_MASTER_ID!=#recordId#
        
	</select>
	
	

  <select id="getById" resultMap="getByIdResult">

		select
		cm.COUNTRY,cm.country_master_id, lbrcm.RG_LBR_COUNTRY_MASTER_ID,lbrcm.STATUS
		
		from RG_LBR_COUNTRY_MASTER lbrcm, CMS_COUNTRY_MASTER cm
		
		where
		lbrcm.country_master_id = cm.country_master_id
        and lbrcm.rg_lbr_country_master_id = #id#
	</select>

   <select id="getByCountry" resultMap="result">
		select
		cm.COUNTRY,lbrdm.lbr_country_master_id,
		lbrdm.LBR_DATA_ID,lbrdm.LBR_DATA_SET,lbrdm.LBR_DATA_DESC,
		lbrim.LBR_INFO_ID,lbrim.LBR_HEADER,lbrim.NON_AVAILABILITY_COMMENTS,lbrim.LBR_ORDER,
		em.ENTITY_TYPE_ID,em.ENTITY_NAME
		from RG_LBR_DATA_MASTER lbrdm,
	    RG_LBR_COUNTRY_MASTER lbrcm,
	    CMS_COUNTRY_MASTER cm,
	    RG_LBR_INFO_MASTER lbrim,
	    CMS_ENTITYTYPE_MASTER em
		where lbrdm.lbr_country_master_id= lbrcm.rg_lbr_country_master_id
	    and cm.COUNTRY_MASTER_ID = lbrcm.country_master_id
		and lbrdm.LBR_INFO_ID = lbrim.LBR_INFO_ID
		and em.ENTITY_TYPE_ID = lbrdm.SUBJECT_TYPE_ID
		and	lbrdm.lbr_country_master_id=#id# 
    	order by lbrdm.lbr_data_order
	</select>
	
	<select id="listById" resultMap="getListByIdResult">
	
		select
		lbrdm.LBR_DATA_ID,lbrdm.LBR_DATA_SET,lbrdm.LBR_DATA_DESC,
		lbrim.LBR_INFO_ID,lbrim.LBR_HEADER,lbrim.NON_AVAILABILITY_COMMENTS,lbrim.LBR_ORDER,
		em.ENTITY_TYPE_ID,em.ENTITY_NAME
		from RG_LBR_DATA_MASTER lbrdm ,
		RG_LBR_INFO_MASTER lbrim, CMS_ENTITYTYPE_MASTER em
		where lbrdm.LBR_INFO_ID= lbrim.LBR_INFO_ID
		and em.ENTITY_TYPE_ID = lbrdm.SUBJECT_TYPE_ID
		and lbrdm.lbr_country_master_id=#id#
        order by lbrdm.lbr_data_order
		 
	</select>
	


	<!-- getLBREntityList from LBRMaster Main Page -->
  <select id="getLBREntitylist" resultMap="entityMasterVO">
		select * from
		CMS_ENTITYTYPE_MASTER 
				
	 </select>


	<!-- getSearchResults from LBRMaster Main Page -->
	  <select id="searchLBRCountry" resultMap="countryVO"
		parameterClass="java.util.HashMap">
		SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
		select
		distinct lbrcm.RG_LBR_COUNTRY_MASTER_ID as country_master_id,cm.COUNTRY
		from CMS_COUNTRY_MASTER cm,RG_LBR_COUNTRY_MASTER lbrcm,RG_LBR_INFO_MASTER
		lbrim,RG_LBR_DATA_MASTER lbrm
		where
		lbrm.LBR_COUNTRY_MASTER_ID=lbrcm.RG_LBR_COUNTRY_MASTER_ID and
		lbrm.LBR_INFO_ID =	lbrim.LBR_INFO_ID and
		cm.COUNTRY_MASTER_ID=lbrcm.COUNTRY_MASTER_ID

		<isNotEqual prepend="AND" property="countryId"
			compareValue="0">
			lbrcm.COUNTRY_MASTER_ID=#countryId# 
		</isNotEqual>
		<isNotNull property="status">
			<isNotEqual prepend="AND" property="status" compareValue="">
				upper(lbrcm.STATUS)=upper(#status#)
					</isNotEqual>
		</isNotNull>
		<isNotNull property="lbrHeaderId">
			<isNotEqual prepend="AND" property="lbrHeaderId"
				compareValue="0">
				lbrim.LBR_INFO_ID=#lbrHeaderId# 
					</isNotEqual>
		</isNotNull>
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				lbrm.SUBJECT_TYPE_ID=#subjectId# 
					</isNotEqual>
		</isNotNull>
		<isNotNull property="text">
			<isNotEmpty prepend="AND" property="text">
				(
				UPPER(lbrm.LBR_DATA_SET) LIKE UPPER(#text#||'%')
				OR
				UPPER(lbrm.LBR_DATA_DESC) LIKE UPPER(#text#||'%')
				)
			</isNotEmpty>
		</isNotNull>
		order by cm.COUNTRY
		) a WHERE
		ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#
	</select>
	<!-- getSearchResultsCount from LBRMaster Main Page -->
	<select id="searchLBRCountryCount" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">
		select count(distinct lbrcm.RG_LBR_COUNTRY_MASTER_ID)
		from CMS_COUNTRY_MASTER cm,RG_LBR_COUNTRY_MASTER lbrcm,RG_LBR_INFO_MASTER
		lbrim,RG_LBR_DATA_MASTER lbrm
		where
		lbrm.LBR_COUNTRY_MASTER_ID=lbrcm.RG_LBR_COUNTRY_MASTER_ID and
		lbrm.LBR_INFO_ID =	lbrim.LBR_INFO_ID and
		cm.COUNTRY_MASTER_ID=lbrcm.COUNTRY_MASTER_ID

		<isNotEqual prepend="AND" property="countryId"
			compareValue="0">
			lbrcm.COUNTRY_MASTER_ID=#countryId# 
				</isNotEqual>
		<isNotNull property="status">
			<isNotEqual prepend="AND" property="status" compareValue="">
				upper(lbrcm.STATUS)=upper(#status#)
					</isNotEqual>
		</isNotNull>
		<isNotNull property="lbrHeaderId">
			<isNotEqual prepend="AND" property="lbrHeaderId"
				compareValue="0">
				lbrim.LBR_INFO_ID=#lbrHeaderId# 
					</isNotEqual>
		</isNotNull>
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				lbrm.SUBJECT_TYPE_ID=#subjectId# 
					</isNotEqual>
		</isNotNull>
		<isNotNull property="text">
			<isNotEmpty prepend="AND" property="text">
				(
				UPPER(lbrm.LBR_DATA_SET) LIKE UPPER(#text#||'%')
				OR
				UPPER(lbrm.LBR_DATA_DESC) LIKE UPPER(#text#||'%')
				)
			</isNotEmpty>
		</isNotNull>

	</select>

	<!-- searchLBRForExport from LBRMaster Main Page -->
	 <select id="searchLBRForExport" resultMap="resultExport"
		parameterClass="java.util.HashMap">
		select
		cm.COUNTRY,lbrdm.LBR_COUNTRY_MASTER_ID,cm.COUNTRY_MASTER_ID,
		lbrdm.LBR_DATA_ID,lbrdm.LBR_DATA_SET,lbrdm.LBR_DATA_DESC,lbrcm.STATUS,
		lbrim.LBR_INFO_ID,lbrim.LBR_HEADER,lbrim.NON_AVAILABILITY_COMMENTS,lbrim.LBR_ORDER,
		em.ENTITY_TYPE_ID,em.ENTITY_NAME
        from CMS_COUNTRY_MASTER
		cm,RG_LBR_DATA_MASTER lbrdm,RG_LBR_INFO_MASTER
		lbrim,RG_LBR_COUNTRY_MASTER lbrcm
		,CMS_ENTITYTYPE_MASTER em
		
		where
		lbrdm.LBR_INFO_ID =lbrim.LBR_INFO_ID 
		and
		cm.COUNTRY_MASTER_ID = lbrcm.COUNTRY_MASTER_ID 
    	and lbrcm.RG_LBR_COUNTRY_MASTER_ID=lbrdm.LBR_COUNTRY_MASTER_ID
		and em.ENTITY_TYPE_ID = lbrdm.SUBJECT_TYPE_ID

		<isNotEqual prepend="AND" property="countryId"
			compareValue="0">
			cm.COUNTRY_MASTER_ID=#countryId# 
		</isNotEqual>
		<isNotNull property="status">
			<isNotEqual prepend="AND" property="status" compareValue="">
				upper(lbrcm.STATUS)=upper(#status#)
			</isNotEqual>
		</isNotNull>
		<isNotNull property="lbrHeaderId">
			<isNotEqual prepend="AND" property="lbrHeaderId"
				compareValue="0">
				lbrim.LBR_INFO_ID=#lbrHeaderId# 
			</isNotEqual>
		</isNotNull>
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				lbrdm.SUBJECT_TYPE_ID=#subjectId# 
					</isNotEqual>
		</isNotNull>
		<isNotNull property="text">
			<isNotEmpty prepend="AND" property="text">
				(
				UPPER(lbrdm.LBR_DATA_SET) LIKE UPPER(#text#||'%')
				OR
				UPPER(lbrdm.LBR_DATA_DESC) LIKE UPPER(#text#||'%')
				)
			</isNotEmpty>
		</isNotNull>
		 order by upper(cm.COUNTRY),lbrdm.SUBJECT_TYPE_ID desc,upper(lbrim.LBR_HEADER), lbrim.lbr_order asc
	</select>

	<!-- For insertion into LBR master Table -->
	<insert id="insert" parameterClass="com.worldcheck.juno.vo.master.LBRMasterRecordVO">
		<selectKey keyProperty="id"> select RG_LBR_COUNTRY_MASTER_SEQ.NEXTVAL from dual</selectKey>
		insert into RG_LBR_COUNTRY_MASTER(
		RG_LBR_COUNTRY_MASTER_ID,
		COUNTRY_MASTER_ID,
		STATUS,
		UPDATED_BY,
		UPDATED_ON)values(
		#id#,
		#countryVO.id#,
		#status#,
		#updatedBy#,
		sysdate
		)
	</insert>
	
	<insert id="insertLBR" parameterClass="com.worldcheck.juno.vo.master.LBRMasterVO">
		insert into
		RG_LBR_DATA_MASTER (
		LBR_DATA_ID,
		LBR_INFO_ID,
		LBR_DATA_SET,
		LBR_DATA_DESC,
		LBR_DATA_ORDER,
		SUBJECT_TYPE_ID,
		LBR_COUNTRY_MASTER_ID
		)values (
		RG_LBR_DATA_MASTER_SEQ .NEXTVAL,
		#lbrHeaderVO.id#,
		#dataSet#,
		#dataSetDescription#,
		#dataOrder#,
		#entityMasterVO.entityId#,
		#parentId#
		)	
	</insert>

   <!--   <update id="update" parameterClass="com.worldcheck.juno.vo.master.LBRMasterVO">

		update RG_LBR_DATA_MASTER set
         LBR_INFO_ID = #lbrHeaderVO.id#,
		LBR_DATA_SET = #dataSet#,
		LBR_DATA_DESC= #dataSetDescription#,
		LBR_DATA_ORDER = #dataOrder#,
		SUBJECT_TYPE_ID =
		#entityMasterVO.entityId#
        where
		LBR_DATA_ID = #id#
		
	  </update>-->
	  
	  <update id="update" parameterClass="com.worldcheck.juno.vo.master.LBRMasterRecordVO">

		update RG_LBR_COUNTRY_MASTER set
        STATUS=#status#
	    where
		RG_LBR_COUNTRY_MASTER_ID = #id#
		
	  </update>
	  
	<!-- <delete id="delete">
		delete from RG_LBR_DATA_MASTER where COUNTRY_ID =
		#id#
	
	</delete> -->
	
	 <delete id="deleteDataset">
		delete from RG_LBR_DATA_MASTER 
		where LBR_COUNTRY_MASTER_ID = #id#
	
	</delete>
     <delete id="delete">
		delete from RG_LBR_COUNTRY_MASTER 
		where RG_LBR_COUNTRY_MASTER_ID = #id#
	
	 </delete> 

	<!--  <update id="deActivate" parameterClass="map">
		update RG_LBR_DATA_MASTER set
		STATUS ='0'
		where
		COUNTRY_ID in
		<iterate property="id" open="(" close=")" conjunction=",">
			#id[]#
		</iterate>
	</update>

	<update id="activate" parameterClass="map">
		update RG_LBR_DATA_MASTER set
		STATUS ='1'
		where
		COUNTRY_ID in
		<iterate property="id" open="(" close=")" conjunction=",">
			#id[]#
		</iterate>
	</update>-->
	
	<update id="deActivate" parameterClass="map">
		update RG_LBR_COUNTRY_MASTER set
		STATUS ='0'
		where
		RG_LBR_COUNTRY_MASTER_ID in
		<iterate property="id" open="(" close=")" conjunction=",">
			#id[]#
		</iterate>
	</update>
	<update id="activate" parameterClass="map">
		update RG_LBR_COUNTRY_MASTER set
		STATUS ='1'
		where
		RG_LBR_COUNTRY_MASTER_ID in
		<iterate property="id" open="(" close=")" conjunction=",">
			#id[]#
		</iterate>
	</update>

	<!-- Checking if lbrheader is already present-->
	<!--<select id="checkIfexist" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">

		SELECT count(*)
		FROM RG_LBR_DATA_MASTER lbrdm
		WHERE
		STATUS = '1'
		<isNotEqual prepend="AND" property="countryId"
			compareValue="0">
			lbrdm.COUNTRY_ID=#countryId# 
		</isNotEqual>
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				lbrdm.SUBJECT_TYPE_ID=#subjectId# 
					</isNotEqual>
		</isNotNull>
	</select>-->


</sqlMap>