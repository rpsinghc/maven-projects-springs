<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ReportGenerator">
	
	<select id="isReportGenerationInProgress" resultClass="java.lang.Boolean" parameterClass="java.util.HashMap">
		SELECT CASE WHEN ((b.status = 'false') or (b.status = 'true' and b.updated_on_in_mins > 10)) THEN 'false' else 'true' end rg_status
		from (
		select decode(a.status,  'SUCCESS',  'false',
		 'FAIL',  'false',
		 'WIP',  'true','unknown') status, a.updated_on_in_mins from (
		select status, 
		( extract(minute from sysdate - updated_on) 
		+ extract(hour from sysdate - updated_on)*60
		+ extract(day from sysdate - updated_on)*24*60 ) updated_on_in_mins from rg_generation_log
		where action = 'GAU' and case_id = #crn# and processcycleid = #processCycleId#
		order by updated_on desc) a
		where rownum = 1) b
	</select>
	
</sqlMap>