<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="DirectRiskFactorVO">


	<resultMap id="riskVO" class="com.worldcheck.juno.vo.component.RiskVO">
		<result property="code" column="RISK_CODE" />
		<result property="name" column="RISK" />

	</resultMap>

	<!--- Showing data by ID -->
	<resultMap id="result"
		class="com.worldcheck.juno.vo.component.DirectRiskFactorVO">
		<result property="directRiskVal" column="RISKVAL" />
		<result property="riskVO" resultMap="DirectRiskFactorVO.riskVO" />
	</resultMap>

	<resultMap id="saveResult"
		class="com.worldcheck.juno.vo.component.DirectRiskFactorVO">
		<result property="directRiskVal" column="RISKVAL" />
		<result property="displayDate" column="displayDate" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="riskVO" resultMap="DirectRiskFactorVO.riskVO" />
		<result property="teamTypeId" column="TEAM_ID" />
		<result property="updateBy" column="UPDATED_BY" />
	</resultMap>

	<select id="getRisk" resultMap="result">

		select
		RISK_CODE,RISK,CONCAT(RISK_CODE, RISK) RISKVAL from cms_risk_master
		where status=1
	</select>
	
	<select id="canMarkDone" resultClass="java.lang.Boolean">
		select case when count(*) > 0 then 'true' else 'false' END
		from rg_direct_risks where case_id = #crn# and processcycleid = #processCycleId#
	</select>

	<insert id="insert" parameterClass="com.worldcheck.juno.vo.component.DirectRiskFactorVO">
		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_DIRECT_RISKS_SEQ.NEXTVAL from dual
	    </selectKey>
		INSERT INTO RG_DIRECT_RISKS
		(DIRECT_RISK_ID,RISK_MST_ID,RISK_VALUE,UPDATED_BY,UPDATED_ON,CASE_ID,PROCESSCYCLEID,IS_AUTO_SAVED,TEAM_ID)
		VALUES(#id#,#riskVO.code#,#directRiskVal#,#userName#,sysdate,#crn#,#processCycleId#,#isAutoSave#,#teamTypeId#)
	</insert>

	<delete id="delete" parameterClass="java.util.HashMap">
		delete from RG_DIRECT_RISKS
		where CASE_ID=#crn# and
		PROCESSCYCLEID=#processCycleId#
	</delete>

	<select id="getSaveData" parameterClass="java.util.HashMap"
		resultMap="saveResult">
		<!--
			select cmsrisk.risk, cmsrisk.risk_code, rgdir.risk_value RISKVAL from
			rg_direct_risks rgdir right outer join (select * from cms_risk_master
			cmsrisk where cmsrisk.status=1) cmsrisk on cmsrisk.risk_code=
			rgdir.risk_mst_id and upper(rgdir.case_id)=upper(#crn#) and
			rgdir.processcycleid=#processCycleId#
		-->


		select cmsrisk.risk, cmsrisk.risk_code, rgdir.risk_value
		RISKVAL,to_char(rgdir.UPDATED_ON, 'DD-MM-YY HH24:MI:SS') displayDate,rgdir.UPDATED_ON,rgdir.TEAM_ID,
		rgdir.UPDATED_BY
		from rg_direct_risks rgdir,cms_risk_master cmsrisk
		where
		cmsrisk.risk_code= rgdir.risk_mst_id
		and upper(rgdir.case_id)=upper(#crn#)
		and
		rgdir.processcycleid=#processCycleId#
		order by cmsrisk.risk
	</select>

	<select id="checkSaveData" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		select count(*) from rg_direct_risks where
		upper(case_id)=upper(#crn#) and
		processcycleid=#processCycleId#
	</select>

</sqlMap>