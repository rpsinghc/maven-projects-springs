<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="VisualKeysVO">
	<insert id="insert" parameterClass="com.worldcheck.juno.vo.component.VisualKeysVO">
		<selectKey keyProperty="id" resultClass="long">
			SELECT RG_VISUALKEYS_SEQ.NEXTVAL from dual
	  	</selectKey>
	  	INSERT INTO rg_visualkeys (
			VISUAL_KEYS_ID,
     		CASE_ID, 
     		CASE_MANAGER, 
     		BUSINESS_INTELLIGENCE, 
     		MANAGER,
     		SENIOR_ANALYST, 
     		PRIMARY_ANALYST, 
     		SUPPORTING_ANALYST,
     		UPDATED_BY, 
     		UPDATED_ON,
     		ISBUSINESSINTELLIGENCE,                                                                                                                                                                                       
			ISMANAGER,                                                                                                                                                                                       
			ISSENIORANALYST,                                                                                                                                                                                       
			ISPRIMARYANALYST,                                                                                                                                                                                       
			ISSUPPORTINGANALYST,                                                                                                                                                                                       
     		PROCESSCYCLEID
		)VALUES (
			#id#,
			#crn#,
			#caseManager#,
			#businessIntelligence#,
			#manager#,
			#seniorAnalyst#,
			#primaryAnalyst#,
			#supportingAnalyst#,
			#user#,
			sysdate,
			#businessIntelligenceFlag#,
     		#managerFlag#,
     		#seniorAlalystFlag#,
     		#primaryAnalystFlag#,
     		#supportingAnalystFlag#,
     		#processCycleId# 
		)
	</insert>
	
	<update id="update" parameterClass="com.worldcheck.juno.vo.component.VisualKeysVO">
		UPDATE RG_VISUALKEYS 
			SET CASE_MANAGER =#caseManager#,
				BUSINESS_INTELLIGENCE = #businessIntelligence#,
				MANAGER = #manager#,
				SENIOR_ANALYST = #seniorAnalyst#,
				PRIMARY_ANALYST = #primaryAnalyst#,
				SUPPORTING_ANALYST = #supportingAnalyst#,
				UPDATED_BY = #user#,
				UPDATED_ON = SYSDATE,
				ISBUSINESSINTELLIGENCE = #businessIntelligenceFlag#,                                                                                                                                                                                       
				ISMANAGER = #managerFlag#,                                                                                                                                                                                       
				ISSENIORANALYST = #seniorAlalystFlag#,                                                                                                                                                                                       
				ISPRIMARYANALYST = #primaryAnalystFlag#,                                                                                                                                                                                       
				ISSUPPORTINGANALYST = #supportingAnalystFlag#    
			WHERE VISUAL_KEYS_ID = #id#
	</update>
	
	<resultMap id="result" class="com.worldcheck.juno.vo.component.VisualKeysVO">
		<result property="id" column="visual_keys_id" />
		<result property="caseManager" column="case_manager" />
		<result property="businessIntelligence" column="business_intelligence" />
		<result property="manager" column="manager" />
		<result property="seniorAnalyst" column="senior_analyst" />
		<result property="primaryAnalyst" column="primary_analyst" />
		<result property="supportingAnalyst" column="supporting_analyst" />
		<result property="user" column="updated_by" />
		<result property="updatedOn" column="updated_on" />
		<result property="lastUpdate" column="last_update" />
		<result property="updateBy" column="updated_by" />
		<result property="businessIntelligenceFlag" column="ISBUSINESSINTELLIGENCE" javaType="java.lang.String" />
		<result property="managerFlag" column="ISMANAGER" javaType="java.lang.String"/>
		<result property="seniorAlalystFlag" column="ISSENIORANALYST" javaType="java.lang.String"/>
		<result property="primaryAnalystFlag" column="ISPRIMARYANALYST" javaType="java.lang.String"/>
		<result property="supportingAnalystFlag" column="ISSUPPORTINGANALYST" javaType="java.lang.String"/>
		<result property="processCycleId" column="PROCESSCYCLEID" />
	</resultMap>
	
	<select id="getRecordByCrn" resultMap="result" parameterClass="java.util.HashMap">
		select visual_keys_id, case_manager, 
			business_intelligence, 
			manager, 
			senior_analyst, 
			primary_analyst, 
			supporting_analyst, 
			rgv.updated_by, 
			to_char(updated_on,'DD-MM-YYYY hh:mm') updated_on,
			to_char(updated_on,'DD-MM-YYYY HH24:MI:SS')  last_update,
			ISBUSINESSINTELLIGENCE,
			ISMANAGER,
			ISSENIORANALYST,
			ISPRIMARYANALYST,
			ISSUPPORTINGANALYST,
			PROCESSCYCLEID
        from rg_visualkeys rgv where case_id =#crn# and PROCESSCYCLEID=#processCycleId#
	</select>
	
	<select id="canMarkDone" resultClass="java.lang.Boolean">
		select case when count(*) > 0 then 'true' else 'false' END
		from rg_visualkeys where case_id = #crn# and PROCESSCYCLEID = #processCycleId#
	</select>
	
</sqlMap>