<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CompanyCorporateAnalysisSummaryVO">


	<!-- Inserting into Individual Details Component  -->
	<insert id="insert"
		parameterClass="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_CMPY_CORP_ANA_SUMRY_SEQ.NEXTVAL from dual
		</selectKey>

		insert into RG_CMPY_CORP_ANA_SUMRY (
		CMPY_CORP_ANA_SUMRY_ID,
		CASE_ID,
		PROCESSCYCLEID,
		TABLE_BOTTOM_NOTES,
		TITLE,
		UPDATED_ON,UPDATED_BY,
		SUBJECT_ID,
		IS_AUTO_SAVED,
		DESCRIPTION_OF_STATUS,
		STATUS,
		CMPY_CORP_TYPE,TEAM_ID
		)values (
		#id#,
		#crn#,#processCycleId#,#tableBottomNotes#,
		#title#,
		sysdate,#updateBy#,
		#subjectId#,
		#isAutoSave#,
		#descriptionOfStatus#,
		#status#,
		#compType#,#teamTypeId#
		)
	</insert>
	<!--generic query-->
	<insert id="insertAutoSave">
		<selectKey keyProperty="autoSaveId" resultClass="long">
			SELECT
			RG_CMPY_CORP_ANA_SUMRY_SEQ.NEXTVAL from dual
	  </selectKey>
		insert into RG_CMPY_CORP_ANA_SUMRY (
		CMPY_CORP_ANA_SUMRY_ID,
		CASE_ID,
		PROCESSCYCLEID,
		SUBJECT_ID,
		TITLE,
		UPDATED_ON,
		UPDATED_BY,
		TABLE_BOTTOM_NOTES,
		IS_AUTO_SAVED,
		PARENT_RECORD_ID,
		DESCRIPTION_OF_STATUS,
		STATUS,
		CMPY_CORP_TYPE
		)values (
		#autoSaveId#,
		#crn#,
		#processCycleId#,
		#subjectId#,
		#title#,
		sysdate,
		#updateBy#,
		#tableBottomNotes#,
		'Y',
		#id#,
		#descriptionOfStatus#,
		#status#,
		#compType#
		)
	</insert>



	<insert id="inserthistory"
		parameterClass="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		<selectKey keyProperty="historyId" resultClass="long">
			SELECT
			RG_CMPY_CORP_ANA_SUMRY_HST_SEQ.NEXTVAL from dual
	 	</selectKey>
		insert into
		RG_CMPY_CORP_ANA_SUMRY_HST (
		HISTORY_ID,
		CMPY_CORP_ANA_SUMRY_ID,
		SUBJECT_ID,
		PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,
		TITLE,
		TABLE_BOTTOM_NOTES,STATUS
		)
		(select
		#historyId#,CMPY_CORP_ANA_SUMRY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,TITLE,TABLE_BOTTOM_NOTES,STATUS from
		RG_CMPY_CORP_ANA_SUMRY where CMPY_CORP_ANA_SUMRY_ID =#id#)

	</insert>
	<insert id="insertTableHistory" parameterClass="map">
		insert into
		RG_CMPY_CORP_ANA_DTL_HST
		(HISTORY_ID,CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,SUMMARY_HISTORY_ID,ROW_NO,FIELD_NAME,FIELD_VALUE,COMMENTS)
		(select RG_CMPY_CORP_ANA_DTL_HST_SEQ.nextval,
		CMPY_CORP_ANA_DTL_ID,#pdId#,#historyId#,ROW_NO,
		FIELD_NAME,FIELD_VALUE,COMMENTS
		from RG_CMPY_CORP_ANA_DTL where
		CMPY_CORP_ANA_SUMRY_ID =#pdId#)
	</insert>

	<resultMap id="companyCorporateDetailsTableRows"
		class="com.worldcheck.juno.vo.component.CompanyBackgroundDetailsVO"
		groupBy="id">
		<result property="id" column="CMPY_CORP_ANA_DTL_ID" />
		<result property="fieldName" column="FIELD_NAME" />
		<result property="fieldValue" column="FIELD_VALUE" />
		<result property="comment" column="COMMENTS" />
		<result property="rowNo" column="ROW_NO" />
		<result property="parentId" column="CMPY_CORP_ANA_SUMRY_ID" />
	</resultMap>
	<resultMap id="resultVO"
		class="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO"
		groupBy="id">
		<result property="id" column="CMPY_CORP_ANA_SUMRY_ID" />
		<result property="crn" column="CASE_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="subjectName" column="SUBJECT_NAME" />

		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
		<result property="title" column="TITLE" />
		<result property="descriptionOfStatus" column="DESCRIPTION_OF_STATUS" />
		<result property="status" column="STATUS" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="compType" column="CMPY_CORP_TYPE" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="isAutoSave" column="IS_AUTO_SAVED" />
		<result property="companyCorporateDetailsTableRows"
			resultMap="CompanyCorporateAnalysisSummaryVO.companyCorporateDetailsTableRows"
			notNullColumn="CMPY_CORP_ANA_DTL_ID" />
	</resultMap>

	<!--generic query-->
	<select id="getById" resultMap="resultVO">
		SELECT rg.CMPY_CORP_ANA_SUMRY_ID,
		rg.CASE_ID,
		rg.PROCESSCYCLEID,
		cc.DESCRIPTION,
		rg.SUBJECT_ID,
		cs.REPORT_SUBJECT_NAME SUBJECT_NAME,
		rg.TABLE_BOTTOM_NOTES,
		rg.TITLE,
		rg.UPDATED_ON,rg.UPDATED_BY,
		rg.IS_AUTO_SAVED,
		rg.DESCRIPTION_OF_STATUS,
		rg.STATUS,
		rg.CMPY_CORP_TYPE,
		pd.ROW_NO,
		pd.FIELD_NAME,pd.FIELD_VALUE,
		pd.CMPY_CORP_ANA_DTL_ID,pd.COMMENTS,
		pd.CMPY_CORP_ANA_SUMRY_ID

		FROM
		RG_CMPY_CORP_ANA_SUMRY rg
		LEFT
		OUTER JOIN
		RG_CMPY_CORP_ANA_DTL pd ON
		pd.CMPY_CORP_ANA_SUMRY_ID =
		rg.CMPY_CORP_ANA_SUMRY_ID
		JOIN CMS_CASECYCLE
		cc ON cc.CASECYCLE_ID =
		rg.PROCESSCYCLEID
		JOIN rg_subject cs ON
		cs.SUBJECT_ID = rg.SUBJECT_ID
		WHERE
		rg.CMPY_CORP_ANA_SUMRY_ID =#id#
		ORDER
		BY pd.ROW_NO ASC
	</select>

	<!--generic query-->
	<update id="update"
		parameterClass="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		update RG_CMPY_CORP_ANA_SUMRY
		set TITLE = #title#,
		TABLE_BOTTOM_NOTES = #tableBottomNotes#,
		PROCESSCYCLEID=#processCycleId# ,
		DESCRIPTION_OF_STATUS =
		#descriptionOfStatus#,
		STATUS=#status# ,
		UPDATED_ON=sysdate,
		UPDATED_BY=#updateBy#,
		IS_AUTO_SAVED = 'N',TEAM_ID=#teamTypeId#,
		PARENT_RECORD_ID = null
		where CMPY_CORP_ANA_SUMRY_ID = #id#
	</update>

	<!--generic query-->
	<update id="updateAutoSave"
		parameterClass="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		update RG_CMPY_CORP_ANA_SUMRY set
		TITLE=#title#,
		TABLE_BOTTOM_NOTES=#tableBottomNotes#,
		PROCESSCYCLEID=#processCycleId#,
		DESCRIPTION_OF_STATUS =
		#descriptionOfStatus#,
		STATUS=#status# ,
		UPDATED_ON=sysdate,
		UPDATED_BY=#updateBy#,
		IS_AUTO_SAVED = 'Y',
		PARENT_RECORD_ID = #id#
		where
		CMPY_CORP_ANA_SUMRY_ID = #autoSaveId#
	</update>

	<resultMap id="companyDtlList"
		class="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO"
		groupBy="id">
		<result property="id" column="CMPY_CORP_ANA_SUMRY_ID" />
		<result property="crn" column="CASE_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="subjectName" column="SUBJECT_NAME" />
		<result property="displayDate" column="displayDate" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="compType" column="CMPY_CORP_TYPE" />
		<result property="teamTypeId" column="TEAM_ID" />
	</resultMap>
	<!--generic query-->

	<select id="listByCRN" resultMap="companyDtlList"
		parameterClass="java.util.HashMap">
		SELECT * FROM (SELECT a.*, ROWNUM rn FROM (
		SELECT
		rg.CMPY_CORP_ANA_SUMRY_ID,
		rg.CASE_ID,
		rg.PROCESSCYCLEID,
		cc.DESCRIPTION,rg.team_id,
		rg.SUBJECT_ID,
		cs.SUBJECT_NAME,
		to_char(rg.UPDATED_ON,
		'DD-Mon-YY
		HH24:MI:SS') as displayDate,
		NVL(rg.UPDATED_BY,'System') UPDATED_BY,
		CMPY_CORP_TYPE
		FROM
		RG_CMPY_CORP_ANA_SUMRY
		rg
		,CMS_CASECYCLE cc, rg_subject cs,rg_report_subcomponents sbcmp
		WHERE
		CASE_ID=#crn# and
		rg.PROCESSCYCLEID = cc.CASECYCLE_ID and rg.SUBJECT_ID
		= cs.SUBJECT_ID
		AND
		upper(rg.IS_AUTO_SAVED)=upper('N')
		AND rg.CMPY_CORP_TYPE = sbcmp.subcomponent_name
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				rg.SUBJECT_ID=#subjectId# 
			</isNotEqual>
		</isNotNull>

		<isNotNull property="processCycleId">
			<isNotEqual prepend="AND" property="processCycleId"
				compareValue="0">
				rg.PROCESSCYCLEID=#processCycleId# 
			</isNotEqual>
		</isNotNull>

		order by cs.is_primary_sub desc,cs.REPORT_ORDER
		asc,upper(cs.REPORT_SUBJECT_NAME) asc,cc.processcycle_order desc,sbcmp.subcomponent_order
		) a <isNotNull property="limit">
			<isNotEqual property="limit" compareValue="0">

				WHERE ROWNUM <![CDATA[ <= ]]>
				#limit#
			</isNotEqual>
		</isNotNull>
		)
		<isNotNull property="limit">
			<isNotEqual property="limit" compareValue="0">

				WHERE rn <![CDATA[ >= ]]>
				#start#
			</isNotEqual>
		</isNotNull>
	</select>

	<resultMap id="subjProcList"
		class="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		<result property="crn" column="CASE_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="subjectId" column="SUBJECT_ID" />
	</resultMap>

	<select id="getSubjectProcessList" parameterClass="java.util.HashMap"
		resultMap="subjProcList">
		SELECT * FROM (select subpc.*, ROWNUM rn from (
		select distinct
		rg.subject_id, rg.processcycleid, rg.case_id,
		sub.report_order,cc.processcycle_order,rg.IS_AUTO_SAVED,sub.is_primary_sub ,sub.REPORT_SUBJECT_NAME
		from RG_CMPY_CORP_ANA_SUMRY rg
		join rg_subject sub on sub.subject_id = rg.subject_id
		join
		cms_casecycle cc on cc.casecycle_id = rg.processcycleid
		group by
		rg.subject_id, rg.processcycleid, rg.case_id, sub.REPORT_ORDER,
		cc.processcycle_order,rg.IS_AUTO_SAVED,sub.is_primary_sub ,sub.REPORT_SUBJECT_NAME
		having rg.case_id = #crn# and upper(rg.IS_AUTO_SAVED)=upper('N')
		order by
		sub.is_primary_sub desc,sub.REPORT_ORDER
		asc,upper(sub.REPORT_SUBJECT_NAME) asc,cc.processcycle_order desc 
		) subpc WHERE ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#
	</select>

	<select id="listByIndividualType" resultMap="companyDtlList"
		parameterClass="java.util.HashMap">
		SELECT
		rg.CMPY_CORP_ANA_SUMRY_ID,
		rg.CASE_ID,rg.team_id,
		rg.PROCESSCYCLEID,
		cc.DESCRIPTION,
		rg.SUBJECT_ID,
		cs.SUBJECT_NAME,
		to_char(rg.UPDATED_ON,
		'DD-Mon-YY
		HH24:MI:SS') as displayDate,
		NVL(rg.UPDATED_BY,'System') UPDATED_BY,
		CMPY_CORP_TYPE
		FROM
		RG_CMPY_CORP_ANA_SUMRY
		rg
		,CMS_CASECYCLE cc, rg_subject cs,rg_report_subcomponents sbcmp
		WHERE
		rg.PROCESSCYCLEID = cc.CASECYCLE_ID and rg.SUBJECT_ID
		= cs.SUBJECT_ID
		<iterate prepend="AND" property="subProcList" open="(" close=")"
			conjunction="or">
			( rg.SUBJECT_ID = #subProcList[].subjectId# and
			rg.PROCESSCYCLEID=#subProcList[].processCycleId#
			and rg.CASE_ID
			=#subProcList[].crn# )
		</iterate>
		AND
		upper(rg.IS_AUTO_SAVED)=upper('N')
		and rg.CMPY_CORP_TYPE = sbcmp.subcomponent_name
		order by  cs.is_primary_sub desc,cs.REPORT_ORDER
		asc,upper(cs.REPORT_SUBJECT_NAME) asc,cc.processcycle_order desc ,sbcmp.subcomponent_order

	</select>
	<select id="getSearchCount" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		SELECT count(*) from
		(
		select distinct
		rg.subject_id,
		rg.processcycleid, rg.case_id,
		sub.report_order,cc.processcycle_order,rg.IS_AUTO_SAVED
		from
		RG_CMPY_CORP_ANA_SUMRY
		rg
		join rg_subject sub on sub.subject_id
		=
		rg.subject_id
		join
		cms_casecycle cc on cc.casecycle_id =
		rg.processcycleid
		group by
		rg.subject_id, rg.processcycleid, rg.case_id,
		sub.REPORT_ORDER,
		cc.processcycle_order,rg.IS_AUTO_SAVED
		having
		rg.case_id =
		#crn# and upper(rg.IS_AUTO_SAVED)=upper('N')
		) cdata


	</select>
	<!-- Procedure for Default Entries into Individual Component -->
	<select id="getHistoryCountForCRN" resultClass="java.lang.Long"
		parameterClass="java.lang.String">
		select count(*) from (
		select case_id from RG_CMPY_CORP_ANA_SUMRY where
		case_id=#crn#
		union
		select case_id from RG_CMPY_CORP_ANA_SUMRY_HST where
		case_id=#crn#
		)
  
  	</select>
	<!-- Update Summary table by entry of Default records.-->
	<update id="insertDefaultEntries" parameterClass="java.util.HashMap">
		declare
		recordId number(10);
		hstId number(10);
		detailHistId number(10);
		subList varray_varchar;
		indTypeArray varray_varchar;
		indTypeTitleArray
		varray_varchar;
		subId number;
		crn VARCHAR2(200):=#crn#;
		processCycle
		number:=#processCycleId#;
		userName VARCHAR2(200):=#userName#;
		indType
		VARCHAR2(200);
		indTypeTitle VARCHAR2(2000);
		detailId number(10);
		fieldArray
		varray_varchar;

		begin
		subList:=
		varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].subjectId#
		</iterate>
		;
		indTypeArray
		:=varray_varchar('companyRegistryDetailsFCPAForm','otherCompanyInfoFCPAForm','assoIndividualDetailsFCPAForm','otherAssoIndividualDetailsFCPAForm','remarksFCPAForm','shareholdersFCPAForm');
		indTypeTitleArray
		:=varray_varchar('COMPANY REGISTRY DETAILS','OTHER
		COMPANY INFORMATION','ASSOCIATED INDIVIDUALS / ENTITIES','OTHER ASSOCIATED INDIVIDUALS / ENTITIES','','SHAREHOLDERS (AS ON)');
		fieldArray
		:=varray_varchar(<![CDATA['<p>Name</p>']]>,<![CDATA['<p>Identifiers (if any)</p>']]>,<![CDATA['<p>No. of Shares /
		Investment (Currency)</p>']]>,<![CDATA['<p>Percentage (%)</p>']]>,<![CDATA['<p>Total</p>']]>);
		for elem
		in 1 ..
		subList.count loop

		subId:=subList(elem);
		for elem2 in 1 ..
		indTypeArray.count loop
		indType :=indTypeArray(elem2);
		indTypeTitle
		:=indTypeTitleArray(elem2);

		select
		RG_CMPY_CORP_ANA_SUMRY_SEQ.nextval
		into
		recordId from dual;

		if indType ='companyRegistryDetailsFCPAForm'
		then
		INSERT INTO
		RG_CMPY_CORP_ANA_SUMRY
		(CMPY_CORP_ANA_SUMRY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,IS_AUTO_SAVED,TITLE,CMPY_CORP_TYPE,TEAM_ID,STATUS,DESCRIPTION_OF_STATUS)
		values(recordId, subId ,
		processCycle, crn
		,sysdate,userName
		,'N',indTypeTitle,indType,-1,'Available',(select DEFAULT_TEXT from rg_component_default_text where component_id=43));
		else
		INSERT INTO
		RG_CMPY_CORP_ANA_SUMRY
		(CMPY_CORP_ANA_SUMRY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,IS_AUTO_SAVED,TITLE,CMPY_CORP_TYPE,TEAM_ID)
		values(recordId, subId ,
		processCycle, crn
		,sysdate,userName
		,'N',indTypeTitle,indType,-1);
		end if;
		if indType ='shareholdersFCPAForm' then
		for rown in 1..4 Loop

		if rown = 1 then

		for
		coln in 1..4 Loop
		select
		RG_CMPY_CORP_SHARE_DTL_SEQ.nextval into
		detailId from dual;

		insert into RG_CMPY_CORP_SHARE_DTL
		(CMPY_CORP_SHARE_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,COLUMN_NO,FIELD_VALUE)
		values(detailId,recordId,1,coln-1,fieldArray(coln));

		END LOOP;

		else
		if rown = 4 then
		for
		coln in 1..4 Loop
		if coln = 1 then
		select RG_CMPY_CORP_SHARE_DTL_SEQ.nextval into
		detailId from
		dual;
		insert into RG_CMPY_CORP_SHARE_DTL
		(CMPY_CORP_SHARE_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,COLUMN_NO,FIELD_VALUE)
		values(detailId,recordId,rown,coln-1,fieldArray(5));
		else
		select RG_CMPY_CORP_SHARE_DTL_SEQ.nextval into
		detailId from
		dual;
		insert into RG_CMPY_CORP_SHARE_DTL
		(CMPY_CORP_SHARE_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,COLUMN_NO)
		values(detailId,recordId,rown,coln-1);
		end if;
		END LOOP;
		else
		for
		coln in 1..4 Loop
		select RG_CMPY_CORP_SHARE_DTL_SEQ.nextval into
		detailId from
		dual;
		insert into RG_CMPY_CORP_SHARE_DTL
		(CMPY_CORP_SHARE_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,COLUMN_NO)
		values(detailId,recordId,rown,coln-1);

		END LOOP;
		end if;
		end if;
		END LOOP;


		else
		insert
		into
		RG_CMPY_CORP_ANA_DTL
		(CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,FIELD_NAME,COMMENTS)
		SELECT
		RG_CMPY_CORP_ANA_DTL_SEQ.nextval,recordId,ROW_NO,FIELD_NAME,COMMENTS
		FROM
		RG_CMPY_CORP_ANA_STATIC where SUB_COMPONENT_TYPE=indType;

		end if;

		END LOOP;
		END LOOP;
		END;

	</update>

	<!--generic query-->
	<select id="findAutoSave" parameterClass="java.util.HashMap"
		resultClass="java.lang.Long">
		SELECT rg.CMPY_CORP_ANA_SUMRY_ID
		FROM
		RG_CMPY_CORP_ANA_SUMRY
		rg
		WHERE
		upper(rg.IS_AUTO_SAVED)=upper('Y') AND
		rg.PARENT_RECORD_ID =
		#parentId#
	</select>

	<!--generic query-->
	<select id="findNewAutoSave" parameterClass="java.util.HashMap"
		resultClass="java.lang.Long">
		SELECT rg.CMPY_CORP_ANA_SUMRY_ID
		FROM
		RG_CMPY_CORP_ANA_SUMRY
		rg
		WHERE CASE_ID=#crn# AND
		upper(rg.IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID IS NULL
		and
		CMPY_CORP_TYPE =#componentType#
	</select>

	<!--generic query-->
	<select id="findById" resultClass="int">
		select
		count(rg.CMPY_CORP_ANA_SUMRY_ID)
		FROM RG_CMPY_CORP_ANA_SUMRY rg
		WHERE
		rg.CMPY_CORP_ANA_SUMRY_ID = #id#
	</select>

	<!--generic query-->
	<delete id="deleteNewAutoSave">
		delete FROM RG_CMPY_CORP_ANA_SUMRY WHERE
		CASE_ID=#crn#
		AND
		upper(IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID IS
		NULL
	</delete>

	<!--generic query-->
	<delete id="deleteAutoSave">
		delete FROM RG_CMPY_CORP_ANA_SUMRY WHERE
		CASE_ID=#crn#
		AND
		upper(IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID =
		#parentId#
	</delete>

	<!--generic query-->
	<delete id="delete">
		delete FROM RG_CMPY_CORP_ANA_SUMRY WHERE
		CMPY_CORP_ANA_SUMRY_ID = #id#
	</delete>

	<!--generic query-->
	<delete id="deleteIds">
		delete FROM RG_CMPY_CORP_ANA_SUMRY WHERE
		CMPY_CORP_ANA_SUMRY_ID in
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[]#
	    </iterate>
	</delete>
	<!-- Table Row Operations -->
	<insert id="insertRow"
		parameterClass="java.util.HashMap">
		<!-- insert into
		RG_CMPY_CORP_ANA_DTL (
		CMPY_CORP_ANA_DTL_ID,
		ROW_NO,
		FIELD_NAME,
		FIELD_VALUE,
		COMMENTS,
		CMPY_CORP_ANA_SUMRY_ID
		)values (
		RG_CMPY_CORP_ANA_DTL_SEQ.NEXTVAL,
		#rowNo#,
		#fieldName#,
		#fieldValue#,
		#comment#,
		#parentId#
		)-->
		
		
		
		
		declare

		recordId number;
		rowNoList varray_varchar;
		fieldNameList
		varray_varchar;
		fieldValueList varray_varchar;
		commentValList
		varray_varchar;
		detailIdList varray_varchar;


		rowNoId number(10);
		fieldName VARCHAR2(4000);
		fieldValue VARCHAR2(4000);
		commentVal
		VARCHAR2(4000);
		parentId number:=#parentId#;
		detailId
		number(10);


		begin
		rowNoList:= varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].rowNo#
				 </iterate>
		;
		fieldNameList:= varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].fieldName#
				 </iterate>
		;
		fieldValueList:= varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].fieldValue#
				 </iterate>
		;

		commentValList:= varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].comment#
				 </iterate>
		;

		detailIdList:= varray_varchar
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[].id#
				 </iterate>
		;

		for elem in 1 .. rowNoList.count
		loop
		rowNoId:=rowNoList(elem);
		fieldName:=fieldNameList(elem);
		fieldValue:=fieldValueList(elem);
		commentVal:=commentValList(elem);
		detailId := detailIdList(elem);

		IF
		detailId = 0 THEN

		select RG_CMPY_CORP_ANA_DTL_SEQ.NEXTVAL
		into recordId
		from dual;

		insert into
		RG_CMPY_CORP_ANA_DTL (
		CMPY_CORP_ANA_DTL_ID,
		ROW_NO,
		FIELD_NAME,
		FIELD_VALUE,
		COMMENTS,
		CMPY_CORP_ANA_SUMRY_ID
		)

		values(recordId, rowNoId ,
		fieldName , fieldValue, commentVal,
		parentId);

		ELSE

		update
		RG_CMPY_CORP_ANA_DTL set
		ROW_NO=rowNoId,
		FIELD_NAME
		=fieldName,
		FIELD_VALUE =fieldValue
		where
		CMPY_CORP_ANA_DTL_ID =
		detailId;

		END IF;
		end loop;
		commit;
		END;
	</insert>

	<update id="updateRow"
		parameterClass="com.worldcheck.juno.vo.component.CompanyBackgroundDetailsVO">
		update
		RG_CMPY_CORP_ANA_DTL set
		ROW_NO=#rowNo#,
		FIELD_NAME =#fieldName#,
		FIELD_VALUE =#fieldValue#
		where
		CMPY_CORP_ANA_DTL_ID = #id#
	</update>

	<delete id="deleteRowsForParent">
		delete FROM RG_CMPY_CORP_ANA_DTL WHERE
		CMPY_CORP_ANA_SUMRY_ID = #id#
	</delete>

	<delete id="deleteRows">
		delete FROM RG_CMPY_CORP_ANA_DTL WHERE
		CMPY_CORP_ANA_DTL_ID IN
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[]#
	    </iterate>
	</delete>

	<!--generic query-->
	<select id="getSubProcCycleList" resultMap="ReportSubjectVO.subProcCycleList">
		select rem.subject_id
		subject_id,
		rem.processcycleid
		Process_Cycle_Id,cs.subject_name
		subject_name,
		ccl.DESCRIPTION
		Process_Cycle
		from RG_CMPY_CORP_ANA_SUMRY
		rem,
		rg_subject cs
		,CMS_CASECYCLE ccl
		where cs.CRN = rem.case_id
		and
		ccl.CASECYCLE_ID=
		rem.processcycleid
		and cs.subject_id =rem.subject_id
		and rem.case_id =
		#crn# and rem.CMPY_CORP_TYPE =
		#compType# and
		upper(rem.IS_AUTO_SAVED)=upper('N')
		order by cs.is_primary_sub desc,cs.REPORT_ORDER
		asc,upper(cs.REPORT_SUBJECT_NAME) asc,ccl.processcycle_order desc 

	</select>
	<!--generic query-->
	<select id="getProcessCycleList" parameterClass="java.util.HashMap"
		resultMap="ProcessCycleVO.processCycleList">
		select rem.processcycleid Process_Cycle_Id,cc.DESCRIPTION
		Process_Cycle
		from RG_CMPY_CORP_ANA_SUMRY rem, cms_casecycle cc
		where
		rem.subject_id=#subId# and rem.case_id=#crn#
		and cc.casecycle_id=
		rem.processcycleid
		and upper(rem.IS_AUTO_SAVED)=upper('N')
		and
		rem.CMPY_CORP_TYPE =
		#compType#
		<isNotNull property="recordId">
			<isNotEqual prepend="AND" property="recordId"
				compareValue="0">
				rem.CMPY_CORP_ANA_SUMRY_ID != #recordId#
			</isNotEqual>
		</isNotNull>


	</select>

	<select id="checkIfExist" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		select count(*) from RG_CMPY_CORP_ANA_SUMRY where
		PROCESSCYCLEID=#processCycleId# and SUBJECT_ID = #subjectId# and
		case_id=#crn# and upper(CMPY_CORP_TYPE)=upper(#companyCorpType#) and 
		upper(IS_AUTO_SAVED)=upper('N')
	</select>
	<!-- makeCopyIndividual  Of Summary -->

	<insert id="makeCopy" parameterClass="java.util.HashMap">

		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_CMPY_CORP_ANA_SUMRY_SEQ.nextval from dual
	  </selectKey>

		insert into RG_CMPY_CORP_ANA_SUMRY (
		CMPY_CORP_ANA_SUMRY_ID,
		CASE_ID,
		PROCESSCYCLEID,
		TABLE_BOTTOM_NOTES,
		TITLE,
		UPDATED_ON,UPDATED_BY,
		SUBJECT_ID,
		DESCRIPTION_OF_STATUS,
		STATUS,
		IS_AUTO_SAVED,
		CMPY_CORP_TYPE,TEAM_ID
		)
		select #id#,
		CASE_ID,
		#processCycleId#,
		TABLE_BOTTOM_NOTES,
		TITLE,
		sysdate,#userName#,
		SUBJECT_ID,
		DESCRIPTION_OF_STATUS,
		STATUS,
		IS_AUTO_SAVED,
		CMPY_CORP_TYPE,#teamId#
		from
		RG_CMPY_CORP_ANA_SUMRY
		where
		CMPY_CORP_ANA_SUMRY_ID =#recordId#
	</insert>

	<!-- makeCopyIndividual  Of Details -->
	<insert id="makeCopyDetails" parameterClass="java.util.HashMap">
		insert
		into
		RG_CMPY_CORP_ANA_DTL
		(CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,FIELD_NAME,FIELD_VALUE,COMMENTS)
		SELECT
		RG_CMPY_CORP_ANA_DTL_SEQ.NEXTVAL,#genSumryId#,
		ROW_NO,
		FIELD_NAME,
		FIELD_VALUE,COMMENTS
		from RG_CMPY_CORP_ANA_DTL
		Where
		CMPY_CORP_ANA_SUMRY_ID=#recordId#
	</insert>

	<!-- history of makeCopyIndividual  Summary -->
	<insert id="makeCopyHst" parameterClass="java.util.HashMap">
		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_CMPY_CORP_ANA_SUMRY_HST_SEQ.nextval from dual
	  </selectKey>
		INSERT INTO RG_CMPY_CORP_ANA_SUMRY_HST
		(HISTORY_ID,CMPY_CORP_ANA_SUMRY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,TITLE,TABLE_BOTTOM_NOTES,DESCRIPTION_OF_STATUS,
		STATUS)

		select
		#id#,#genSumryId#, SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		sysdate,UPDATED_BY,TITLE,TABLE_BOTTOM_NOTES,DESCRIPTION_OF_STATUS,
		STATUS from
		RG_CMPY_CORP_ANA_SUMRY
		where
		CMPY_CORP_ANA_SUMRY_ID=#genSumryId#
	</insert>
	<!-- history of makeCopy Individual  details -->
	<insert id="makeCopyDetailsHistory" parameterClass="java.util.HashMap">
		insert into
		RG_CMPY_CORP_ANA_DTL_HST
		(HISTORY_ID,CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,SUMMARY_HISTORY_ID,ROW_NO,FIELD_NAME,COMMENTS,FIELD_VALUE)
		select
		RG_CMPY_CORP_ANA_DTL_HST_SEQ.nextval,CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,#genHistoryId#,ROW_NO,FIELD_NAME,COMMENTS,FIELD_VALUE
		from RG_CMPY_CORP_ANA_DTL where CMPY_CORP_ANA_SUMRY_ID=#genSumryId#
	</insert>

	<resultMap id="defaultIndividualDetailsTableRows"
		class="com.worldcheck.juno.vo.component.CompanyCorporateDetailsVO"
		groupBy="id">

		<result property="fieldName" column="FIELD_NAME" />
		<result property="comment" column="COMMENTS" />
		<result property="rowNo" column="ROW_NO" />

	</resultMap>
	<select id="defaultTable" resultMap="defaultIndividualDetailsTableRows">
		SELECT
		ROW_NO,FIELD_NAME,COMMENTS FROM
		RG_CMPY_CORP_ANA_STATIC where
		sub_component_type=#compType# ORDER
		BY
		ROW_NO
	</select>

	<select id="getHistoryCount" resultClass="java.lang.Integer">
		SELECT count(*)
		FROM
		RG_CMPY_CORP_ANA_SUMRY_HST
		rg where
		rg.CMPY_CORP_ANA_SUMRY_ID=#recordId#
	</select>

	<resultMap id="resultHistory"
		class="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO">
		<result property="id" column="HISTORY_ID" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
		<result property="status" column="STATUS" />

	</resultMap>

	<select id="getHistory" resultMap="resultHistory"
		parameterClass="java.util.HashMap">

		SELECT * FROM (SELECT a.*, ROWNUM rn FROM (SELECT
		rg.HISTORY_ID,
		rg.UPDATED_ON, rg.UPDATED_BY,
		rg.PROCESSCYCLEID,
		cc.DESCRIPTION,
		rg.TABLE_BOTTOM_NOTES,rg.STATUS

		FROM RG_CMPY_CORP_ANA_SUMRY_HST
		rg,CMS_CASECYCLE
		cc

		WHERE rg.PROCESSCYCLEID =
		cc.CASECYCLE_ID
		and
		rg.CMPY_CORP_ANA_SUMRY_ID=#recordId#
		order by
		rg.UPDATED_ON desc
		) a
		WHERE
		ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#

	</select>
	<resultMap id="individualDetailsHistoryRows"
		class="com.worldcheck.juno.vo.component.CompanyBackgroundDetailsVO">
		<result property="id" column="CMPY_CORP_ANA_DTL_ID" />
		<result property="fieldName" column="FIELD_NAME" />
		<result property="fieldValue" column="FIELD_VALUE" />
		<result property="comment" column="COMMENTS" />
		<result property="rowNo" column="ROW_NO" />
		<result property="parentId" column="CMPY_CORP_ANA_SUMRY_ID" />
	</resultMap>
	<select id="getTableValues" resultMap="individualDetailsHistoryRows">

		select
		pd.CMPY_CORP_ANA_DTL_ID,
		pd.ROW_NO,
		pd.FIELD_NAME,pd.FIELD_VALUE,
		pd.COMMENTS,
		pd.CMPY_CORP_ANA_SUMRY_ID

		from
		RG_CMPY_CORP_ANA_DTL_HST pd
		where pd.SUMMARY_HISTORY_ID=#recordId#
		ORDER BY ROW_NO ASC
	</select>
	<!--
		Include General Functionality for Make Copy and Mark Done Calling
		stored procedure For Make Copy, Pass the Component name same as that
		present in RG_Component table's column : component_Desc <parameterMap
		id="getParameterMap" class="java.util.Map"> <parameter property="crn"
		jdbcType="VARCHAR" javaType="java.lang.String" mode="IN" /> <parameter
		property="processCycle" jdbcType="LONG" javaType="java.lang.Long"
		mode="IN" /> <parameter property="documentColumnId" jdbcType="LONG"
		javaType="java.lang.Long" mode="IN" /> <parameter property="userCode"
		jdbcType="VARCHAR" javaType="java.lang.String" mode="IN" /> <parameter
		property="errorCode" jdbcType="INTEGER" javaType="java.lang.Integer"
		mode="OUT" /> </parameterMap> <procedure id="callMakeCopy"
		parameterMap="getParameterMap"> { call RG_PROC_MAKE_COPY( ?, ?, ?, ?,
		?, 'PERSONAL_DETAILS','N','CMPY_CORP_ANA_SUMRY_ID','Y','N','N')}
		</procedure> Calling stored procedure For Mark Done <parameterMap
		id="getParameterMapMD" class="java.util.Map"> <parameter
		property="crn" jdbcType="VARCHAR" javaType="java.lang.String"
		mode="IN" /> <parameter property="componentName" jdbcType="VARCHAR"
		javaType="java.lang.String" mode="IN" /> <parameter
		property="errorCode" jdbcType="INTEGER" javaType="java.lang.Integer"
		mode="OUT" /> </parameterMap> <procedure id="callMarkDone"
		parameterMap="getParameterMapMD"> { call RG_PROC_MARK_DONE(?,?,?)}
		</procedure>
	-->
	<insert id="insertHistoryBeforeDeletion" parameterClass="map">
		insert into
		RG_CMPY_CORP_ANA_SUMRY_HST(HISTORY_ID,CMPY_CORP_ANA_SUMRY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,TITLE,TABLE_BOTTOM_NOTES,DESCRIPTION_OF_STATUS,
		STATUS)
		SELECT
		RG_CMPY_CORP_ANA_SUMRY_HST_SEQ.nextval,inner_view.*
		FROM
		<iterate property="recList" conjunction="UNION ALL" open="("
			close=")">
			(SELECT #recList[]# CMPY_CORP_ANA_SUMRY_ID ,SUBJECT_ID,
			PROCESSCYCLEID ,
			CASE_ID ,sysdate,#userName# UPDATED_BY ,TITLE
			,TABLE_BOTTOM_NOTES,DESCRIPTION_OF_STATUS,
			STATUS
			from
			RG_CMPY_CORP_ANA_SUMRY
			where
			CMPY_CORP_ANA_SUMRY_ID=#recList[]#)
		</iterate>
		inner_view

	</insert>
	<resultMap id="miniRecord"
		class="com.worldcheck.juno.vo.component.CompanyCorporateAnalysisSummaryVO"
		groupBy="id">
		<result property="id" column="CMPY_CORP_ANA_SUMRY_ID" />
		<result property="updateOn" column="UPDATED_ON" />
	</resultMap>
	<!--generic query-->
	<select id="getUpdationTimeById" resultMap="miniRecord">
		SELECT
		rg.CMPY_CORP_ANA_SUMRY_ID,
		rg.UPDATED_ON
		FROM RG_CMPY_CORP_ANA_SUMRY rg
		WHERE
		rg.CMPY_CORP_ANA_SUMRY_ID = #id#
	</select>

	<select id="getByType" resultMap="resultVO">
		SELECT
		rg.CMPY_CORP_ANA_SUMRY_ID,
		rg.CASE_ID,
		rg.PROCESSCYCLEID,
		cc.DESCRIPTION,
		rg.SUBJECT_ID,
		cs.REPORT_SUBJECT_NAME SUBJECT_NAME,
		rg.TABLE_BOTTOM_NOTES,
		rg.TITLE,
		rg.UPDATED_ON,rg.UPDATED_BY,
		rg.IS_AUTO_SAVED,
		rg.CMPY_CORP_TYPE,
		rg.STATUS,
		rg.DESCRIPTION_OF_STATUS,
		pd.ROW_NO,
		pd.FIELD_NAME,pd.FIELD_VALUE,
		pd.CMPY_CORP_ANA_DTL_ID,pd.COMMENTS,
		pd.CMPY_CORP_ANA_SUMRY_ID

		FROM RG_CMPY_CORP_ANA_SUMRY rg
		LEFT
		OUTER JOIN
		RG_CMPY_CORP_ANA_DTL pd ON pd.CMPY_CORP_ANA_SUMRY_ID =
		rg.CMPY_CORP_ANA_SUMRY_ID
		JOIN CMS_CASECYCLE cc ON cc.CASECYCLE_ID =
		rg.PROCESSCYCLEID
		JOIN rg_subject cs ON cs.SUBJECT_ID = rg.SUBJECT_ID
		WHERE
		rg.SUBJECT_ID =#subjectId# and
		rg.PROCESSCYCLEID=#processCycleId# and
		rg.CASE_ID=#crn# and rg.CMPY_CORP_TYPE =#otherCompanyInfoFCPAForm#
		AND
		upper(rg.IS_AUTO_SAVED)=upper('N')
		ORDER
		BY pd.ROW_NO ASC
	</select>
	<insert id="updateDefaultTable" parameterClass="map">
		insert
		into
		RG_CMPY_CORP_ANA_DTL
		(CMPY_CORP_ANA_DTL_ID,CMPY_CORP_ANA_SUMRY_ID,ROW_NO,FIELD_NAME,COMMENTS)
		SELECT
		RG_CMPY_CORP_ANA_DTL_SEQ.NEXTVAL,#id#,ROW_NO,FIELD_NAME,COMMENTS
		FROM
		RG_CMPY_CORP_ANA_STATIC where SUB_COMPONENT_TYPE=#compType#
	</insert>
	
	<delete id="deleteComponentData" parameterClass="java.util.HashMap">
		delete from RG_CMPY_CORP_ANA_SUMRY where case_id = #crn# and processcycleid in ($processCycleId$) and subject_id != #subjectId#
	</delete>
</sqlMap>