<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TouchPoints">

	<resultMap id="processCycleLst" class="com.worldcheck.juno.vo.common.ProcessCycleVO">
		<result property="id" column="Process_Cycle_Id" />
		<result property="description" column="Process_Cycle" />
	</resultMap>

	<select id="processCycleList" resultMap="processCycleLst" parameterClass="java.lang.String">
	select  cs.DESCRIPTION Process_Cycle,cs.CASECYCLE_ID Process_Cycle_Id
    from CMS_CASECYCLE cs ,RG_CASE_PROCESSCYCLES rgs
    where rgs.process_cycle_id= cs.casecycle_id
    and rgs.crn=#crn#
    order by cs.CASECYCLE_ID
	</select>

	<resultMap id="subjectLst" class="com.worldcheck.juno.vo.common.ReportSubjectVO">
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="reportSubjectName" column="SUBJECT_NAME" />
		<result property="subjectType" column="ENTITY_TYPE_ID" />
		<result property="junoOrder" column="REPORT_ORDER" />
	</resultMap>

	<select id="subjectList" resultMap="subjectLst" parameterClass="java.lang.String">
		SELECT SUBJECT_ID,SUBJECT_NAME,ENTITY_TYPE_ID,REPORT_ORDER FROM RG_SUBJECT WHERE CRN=#crn# order by REPORT_ORDER
	</select>

	<resultMap id="risksLst" class="com.worldcheck.juno.vo.component.RiskVO">
		<result property="code" column="RISK_CODE" />
		<result property="name" column="RISK" />
		<result property="juno" column="juno" />
	</resultMap>

	<select id="getAllRisks" resultMap="risksLst" parameterClass="java.lang.String">
		SELECT RISK_CODE,RISK, juno FROM CMS_RISK_MASTER where status=1 and (juno = 1 or juno = 0) order by risk
	</select>

	<select id="getFCPARisks" resultMap="risksLst" parameterClass="java.lang.String">
		SELECT RISK_CODE,RISK, juno FROM CMS_RISK_MASTER where status=1 and (juno = 2 or juno = 0) order by risk
	</select>

	<resultMap id="ReportSubjectVO.countryVO" class="com.worldcheck.juno.vo.master.CountryVO">
		<result property="id" column="COUNTRY_ID" />
		<result property="name" column="COUNTRY" />

	</resultMap>
	<resultMap id="subjectDetailLst" class="com.worldcheck.juno.vo.common.ReportSubjectVO">
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="cmsSubjectName" column="SUBJECT_NAME" />
		<result property="reportSubjectName" column="REPORT_SUBJECT_NAME" />
		
		<result property="countryVO" resultMap="ReportSubjectVO.countryVO" />
		<result property="priSubIdentifier" column="IS_PRIMARY_SUB" />
		<result property="junoOrder" column="REPORT_ORDER" />
	</resultMap>
	


	<select id="subjectDetailList" resultMap="subjectDetailLst"
		parameterClass="java.lang.String">
		SELECT
		SUBJECT_ID,SUBJECT_NAME, cms.COUNTRY,COUNTRY_ID,
                
               IS_PRIMARY_SUB,REPORT_SUBJECT_NAME,REPORT_ORDER
		FROM RG_SUBJECT,CMS_COUNTRY_MASTER cms WHERE CRN=#crn# AND COUNTRY_ID=cms.COUNTRY_MASTER_ID
                ORDER BY IS_PRIMARY_SUB desc ,REPORT_ORDER asc
	</select>
	<select id="companySubjectList" resultMap="subjectLst" parameterClass="java.lang.String">
		SELECT SUBJECT_ID,SUBJECT_NAME,ENTITY_TYPE_ID,REPORT_ORDER FROM RG_SUBJECT WHERE CRN=#crn# and ENTITY_TYPE_ID = 2 order by REPORT_ORDER
	</select>
	<select id="individualSubjectList" resultMap="subjectLst" parameterClass="java.lang.String">
		SELECT SUBJECT_ID,SUBJECT_NAME,ENTITY_TYPE_ID,REPORT_ORDER FROM RG_SUBJECT WHERE CRN=#crn# and ENTITY_TYPE_ID = 1 order by REPORT_ORDER
	</select>
	
	<parameterMap id="paramsDeleteAutoSaveData" class="java.util.Map">
		<parameter property="crn" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN" />
		<parameter property="processCycleId" jdbcType="Integer" javaType="java.lang.Integer" mode="IN" />
	</parameterMap>
	<!--- Calling stored procedure -->
	<procedure id="callDeleteAutoSaveData" parameterMap="paramsDeleteAutoSaveData">
		{ call RG_PROC_DELETE_AUTOSAVE_DATA(?, ?)}
	</procedure>
	
	<select id="getBITeamDetails" resultClass="com.worldcheck.atlas.vo.TeamDetails" parameterClass="java.util.HashMap">
		select ctd.TEAM_ID teamId,ctd.CRN crn,ctd.TEAM_TYPE_ID teamTypeId,ctd.OFFICE_ID office,ctd.MANAGER_ID managerName,ctd.MAIN_ANALYST mainAnalyst,
		      to_char(ctd.REV_INTDUEDATE1, 'dd-mm-YY') dueDate1,to_char(ctd.REV_INTDUEDATE2, 'dd-mm-YY') dueDate2,
		      to_char(ctd.REV_FINDUEDATE, 'dd-mm-YY') finalDueDate,ctd.BYPASS_INTERIM byPassInterim, ctd.RESEARCH_HEAD researchHead  
		from CMS_TEAM_DETAILS ctd 
		where ctd.CRN = #crn# and ctd.TEAM_TYPE_ID = 3
	</select>
</sqlMap>
