<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="LbreTypeTwoVO">

	<resultMap id="result"
		class="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		<result property="id" column="LBRE_SUMMARY_ID" />
		<result property="crn" column="CASE_ID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="subjectName" column="SUBJECT_NAME" />
		<result property="tableName" column="TABLE_NAME" />
		<result property="title" column="TITLE" />
		<result property="sameNameSubject" column="SAME_NAME_IND" />
		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="teamTypeId" column="TEAM_ID" />
		<result property="lbreType" column="LBRE_COMP_TYPE" />
	</resultMap>

	<resultMap id="formResult"
		class="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		<result property="id" column="LBRE_SUMMARY_ID" />
		<result property="crn" column="CASE_ID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="subjectName" column="SUBJECT_NAME" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="tableName" column="TABLE_NAME" />
		<result property="title" column="TITLE" />
		<result property="sameNameSubject" column="SAME_NAME_IND" />
		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
		<result property="tableCells" resultMap="LbreTypeTwoVO.matrixCells1"
			notNullColumn="LBRE_TABLE_TYPE2_DET_ID" />
		<result property="lbreType" column="LBRE_COMP_TYPE" />
	</resultMap>


	<resultMap id="resultHistory"
		class="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		<result property="updateBy" column="UPDATED_BY" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="id" column="HISTORY_ID" />
		<result property="title" column="TITLE" />
		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
	</resultMap>

	<resultMap id="matrixCells1" class="com.worldcheck.juno.vo.component.MatrixCellVO"
		groupBy="id" >
		<result property="id" column="LBRE_TABLE_TYPE2_DET_ID" />
		<result property="rowNo" column="ROW_NO" />
		<result property="columnNo" column="COLUMN_NO" />
		<result property="fieldValue" column="FIELD_VALUE" />
		<result property="parentId" column="LBRE_SUMMARY_ID" />
	</resultMap>

	<resultMap id="matrixCells2" class="com.worldcheck.juno.vo.component.MatrixCellVO" >
		<result property="id" column="HISTORY_ID" />
		<result property="rowNo" column="ROW_NO" />
		<result property="columnNo" column="COLUMN_NO" />
		<result property="fieldValue" column="FIELD_VALUE" />
		<result property="parentId" column="LBRE_SUMMARY_ID" />
	</resultMap>
	<resultMap id="resultVO"
		class="com.worldcheck.juno.vo.component.LbreTypeTwoVO" groupBy="id">
		<result property="id" column="LBRE_SUMMARY_ID" />
		<result property="crn" column="CASE_ID" />
		<result property="processCycleName" column="DESCRIPTION" />
		<result property="subjectName" column="REPORT_SUBJECT_NAME" />
		<result property="updateOn" column="UPDATED_ON" />
		<result property="updateBy" column="UPDATED_BY" />
		<result property="subjectId" column="SUBJECT_ID" />
		<result property="processCycleId" column="PROCESSCYCLEID" />
		<result property="title" column="TITLE" />
		<result property="tableName" column="TABLE_NAME" />
		<result property="sameNameSubject" column="SAME_NAME_IND" />
		<result property="tableBottomNotes" column="TABLE_BOTTOM_NOTES" />
		<result property="teamTypeId" column="TEAM_ID" />
		<result property="tableCells" resultMap="LbreTypeTwoVO.matrixCells1"
			notNullColumn="LBRE_TABLE_TYPE2_DET_ID" />
		<result property="lbreType" column="LBRE_COMP_TYPE" />

	</resultMap>


	<!-- Insert example, using the Account parameter class -->
	<insert id="insert"
		parameterClass="com.worldcheck.juno.vo.component.LbreTypeTwoVO">

		<selectKey keyProperty="id" resultClass="long">
			SELECT RG_LBRE_SUMMARY_SEQ.NEXTVAL from dual
		</selectKey>
		INSERT INTO RG_LBRE_SUMMARY
		(LBRE_SUMMARY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,TABLE_BOTTOM_NOTES,SAME_NAME_IND,TABLE_NAME,TITLE,
		UPDATED_ON,UPDATED_BY,IS_AUTO_SAVED,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,TEAM_ID,LBRE_COMP_TYPE)
		VALUES
		(#id#,#subjectId#,#processCycleId#,#crn#,#tableBottomNotes#,#sameNameSubject#,#tableName#,#title#,sysdate,#updateBy#,'N',
		'Y','Type 2',#teamTypeId#,#lbreType#)
	</insert>

	<update id="update"
		parameterClass = "com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		update RG_LBRE_SUMMARY set
		TABLE_BOTTOM_NOTES = #tableBottomNotes#,
		SAME_NAME_IND = #sameNameSubject# ,
		TITLE = #title# ,
		PROCESSCYCLEID = #processCycleId# ,
		UPDATED_ON = sysdate,
		UPDATED_BY = #updateBy#
		where
		LBRE_SUMMARY_ID =#id# AND
		upper(IS_AUTO_SAVED)=upper('N')
	  </update>



	<select id="getProcessList" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">
		SELECT PROCESSCYCLEID FROM RG_LBRE_SUMMARY
		WHERE SUBJECT_ID=#subId#
		AND CASE_ID=#crn# AND upper(IS_AUTO_SAVED)=upper('N')
    </select>


	<select id="getBySubject" resultMap="formResult" >

		SELECT
		rbs.LBRE_SUMMARY_ID,rbs.SUBJECT_ID,rbs.PROCESSCYCLEID,rbs.CASE_ID,
		rbs.UPDATED_ON,rbs.UPDATED_BY, rbs.TABLE_NAME,rbs.TABLE_BOTTOM_NOTES,rbs.SAME_NAME_IND,TITLE,
		cs.SUBJECT_NAME,cc.DESCRIPTION,
		rgdtl.LBRE_TABLE_TYPE2_DET_ID,
		rgdtl.ROW_NO,
		rgdtl.COLUMN_NO,
		rgdtl.FIELD_VALUE,
		rgdtl.LBRE_SUMMARY_ID
		FROM RG_LBRE_SUMMARY rbs 
		LEFT OUTER JOIN RG_LBRE_TABLE_TYPE2_DET rgdtl ON rgdtl.LBRE_SUMMARY_ID = rbs.LBRE_SUMMARY_ID
		JOIN CMS_CASECYCLE cc ON cc.CASECYCLE_ID = rbs.PROCESSCYCLEID
		JOIN RG_SUBJECT cs ON cs.SUBJECT_ID = rbs.SUBJECT_ID
		WHERE
		rbs.LBRE_SUMMARY_ID =#id# AND upper(IS_AUTO_SAVED)=upper('N')

	</select>


	

	<delete id="deleteId">
		delete FROM RG_LBRE_SUMMARY WHERE
		LBRE_SUMMARY_ID in (#backInformation_id#)
	</delete>


	<insert id="insertHistory" parameterClass="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		
		<selectKey keyProperty="summaryHstId" resultClass="long">
			SELECT RG_LBRE_SUMMARY_HST_SEQ.nextval from dual
		</selectKey>
		INSERT INTO RG_LBRE_SUMMARY_HST
		(HISTORY_ID,LBRE_SUMMARY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		UPDATED_ON,UPDATED_BY,TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,LBRE_COMP_TYPE,TABLE_NAME)
		SELECT #summaryHstId#,LBRE_SUMMARY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,
		sysdate,#updateBy#,TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,LBRE_COMP_TYPE,TABLE_NAME
		FROM RG_LBRE_SUMMARY WHERE LBRE_SUMMARY_ID = #id#
	
	  </insert>

	<select id="getHistory" resultMap="resultHistory"
		parameterClass="java.util.HashMap">
		SELECT * FROM (SELECT a.*, ROWNUM rn FROM (
		SELECT rghst.UPDATED_ON, rghst.HISTORY_ID,rghst.UPDATED_BY, rghst.title,cmscase.DESCRIPTION,rghst.TABLE_BOTTOM_NOTES 
		FROM
		RG_LBRE_SUMMARY_HST rghst, cms_casecycle cmscase
		WHERE rghst.LBRE_SUMMARY_ID = #recordId#
    	AND cmscase.casecycle_id= rghst.processcycleid
    	order by rghst.UPDATED_ON desc
		) a WHERE ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#

	</select>

	<insert id="insertMatrixHistory" parameterClass="map">
		insert into
		RG_LBRE_TABLE_TYPE2_DET_HST
		(HISTORY_ID,LBRE_TABLE_TYPE2_DET_ID,LBRE_SUMMARY_ID,SUMMARY_HISTORY_ID,ROW_NO,COLUMN_NO,FIELD_VALUE)
		select RG_LBRE_TBL_TY2_DET_HST_SEQ.nextval, inner_view.* from

		<iterate property="matrixVoLst" conjunction="UNION ALL" open="("
			close=")">
			select
			#matrixVoLst[].id#,#mgmtId#,#historyId#,#matrixVoLst[].rowNo#,#matrixVoLst[].columnNo#,#matrixVoLst[].fieldValue#
			FROM DUAL
		
		</iterate>

		inner_view
	</insert>

	<select id="getTableValues" resultMap="matrixCells2">

		select
		HISTORY_ID,ROW_NO,COLUMN_NO,FIELD_VALUE,LBRE_SUMMARY_ID
		from
		RG_LBRE_TABLE_TYPE2_DET_HST where SUMMARY_HISTORY_ID=#recordId#
		ORDER BY ROW_NO ASC, COLUMN_NO ASC
	</select>
	
		<!-- Matrix Operations -->
	<insert id="insertCell" parameterClass="com.worldcheck.juno.vo.component.MatrixCellVO">
		insert into
		RG_LBRE_TABLE_TYPE2_DET (
		LBRE_TABLE_TYPE2_DET_ID,
		ROW_NO,
		COLUMN_NO,
		FIELD_VALUE,
		LBRE_SUMMARY_ID
		)values (
		RG_LBRE_TBL_TY2_DET_SEQ.NEXTVAL,
		#rowNo#,
		#columnNo#,
		#fieldValue#,
		#parentId#
		)
	</insert>

	<update id="updateCell" parameterClass="com.worldcheck.juno.vo.component.MatrixCellVO">
		update
		RG_LBRE_TABLE_TYPE2_DET set
		ROW_NO=#rowNo#,
		COLUMN_NO=#columnNo#,
		FIELD_VALUE=#fieldValue#
		where
		LBRE_TABLE_TYPE2_DET_ID = #id#
	</update>

	<delete id="deleteCellsForParent">
		delete FROM RG_LBRE_TABLE_TYPE2_DET WHERE
		LBRE_SUMMARY_ID = #id#
	</delete>

	<delete id="deleteCells">
		delete FROM RG_LBRE_TABLE_TYPE2_DET WHERE
		LBRE_TABLE_TYPE2_DET_ID IN
		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[]#
	    </iterate>
	</delete>
	<select id="getAutoSaveById" resultMap="resultVO" >

		SELECT
		rbs.LBRE_SUMMARY_ID,rbs.SUBJECT_ID,rbs.PROCESSCYCLEID,rbs.CASE_ID,
		rbs.UPDATED_ON,rbs.UPDATED_BY, rbs.TITLE,rbs.TABLE_BOTTOM_NOTES,
		cms.REPORT_SUBJECT_NAME,cmscase.DESCRIPTION

		FROM RG_LBRE_SUMMARY rbs,RG_SUBJECT cms,CMS_CASECYCLE cmscase
		WHERE cms.SUBJECT_ID=rbs.SUBJECT_ID ANd
		rbs.PROCESSCYCLEID=cmscase.CASECYCLE_ID
		AND rbs.LBRE_SUMMARY_ID=#id#
		AND upper(IS_AUTO_SAVED)=upper('Y')

	</select>
	<select id="getAutoSave" resultMap="resultVO" parameterClass="java.util.HashMap">

		SELECT
		rbs.LBRE_SUMMARY_ID,rbs.SUBJECT_ID,rbs.PROCESSCYCLEID,rbs.CASE_ID,
		rbs.UPDATED_ON,rbs.UPDATED_BY, rbs.TITLE,rbs.TABLE_BOTTOM_NOTES,
		cms.REPORT_SUBJECT_NAME,cmscase.DESCRIPTION

		FROM RG_LBRE_SUMMARY rbs,RG_SUBJECT cms,CMS_CASECYCLE cmscase
		WHERE cms.SUBJECT_ID=rbs.SUBJECT_ID ANd
		rbs.PROCESSCYCLEID=cmscase.CASECYCLE_ID
		ANd rbs.CASE_ID=#crn#
		AND rbs.SUBJECT_ID=#subId#
		ANd rbs.PROCESSCYCLEID=#processCycle#

		AND upper(IS_AUTO_SAVED)=upper('Y')

	</select>

	<update id="updateAutoSave"
		parameterClass="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		update RG_LBRE_SUMMARY set
		TITLE = #title#,
		TABLE_BOTTOM_NOTES=#tableBottomNotes# ,
		PROCESSCYCLEID=#processCycleId# ,
		UPDATED_ON=sysdate
		where LBRE_SUMMARY_ID=#autoSaveId#
		
		AND upper(IS_AUTO_SAVED)=upper('Y')
	</update>


	<delete id="deleteAutoSaveById">
		delete FROM RG_LBRE_SUMMARY
		WHERE
		LBRE_SUMMARY_ID=#id#
		AND
		upper(IS_AUTO_SAVED)=upper('Y')
	</delete>
	
	<!--generic query-->
	<delete id="deleteNewAutoSave">
		delete FROM RG_LBRE_SUMMARY WHERE
		CASE_ID=#crn#
		AND
		upper(IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID IS NULL
	</delete>

	<!--generic query-->
	<delete id="deleteAutoSave">
		delete FROM RG_LBRE_SUMMARY
		where CASE_ID=#crn#
		AND
		upper(IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID = #parentId#
	</delete>

	<!--generic query-->
	<select id="findAutoSave" parameterClass="java.util.HashMap"
		resultClass="java.lang.Long">
		SELECT rg.LBRE_SUMMARY_ID
		FROM RG_LBRE_SUMMARY rg
		WHERE
		upper(rg.IS_AUTO_SAVED)=upper('Y') AND
		rg.PARENT_RECORD_ID =
		#parentId#
	</select>

	<!--generic query-->
	<select id="findNewAutoSave" parameterClass="java.util.HashMap"
		resultClass="java.lang.Long">
		SELECT rg.LBRE_SUMMARY_ID
		FROM RG_LBRE_SUMMARY rg
		WHERE CASE_ID=#crn# AND
		upper(rg.IS_AUTO_SAVED)=upper('Y') AND
		PARENT_RECORD_ID IS NULL
	</select>
	
	
	<!--generic query-->
	<select id="findById" resultClass="int">
		select
		count(rg.LBRE_SUMMARY_ID)
		FROM RG_LBRE_SUMMARY rg
		WHERE
		rg.LBRE_SUMMARY_ID = #id#
	</select>

	<!--generic query-->
	<delete id="delete">
		delete FROM RG_LBRE_SUMMARY WHERE
		LBRE_SUMMARY_ID = #id#
	</delete>

	<!--generic query-->
	<delete id="deleteIds" parameterClass="java.util.HashMap">
		delete FROM RG_LBRE_SUMMARY WHERE
		LBRE_SUMMARY_ID IN

		<iterate property="ids" open="(" close=")" conjunction=",">
			#ids[]#
	    </iterate>
	</delete>
	
	
	<select id="getSearchCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">

		SELECT
		count(*)
		FROM RG_LBRE_SUMMARY rbs,RG_SUBJECT cms,CMS_CASECYCLE cmscase
		WHERE cms.SUBJECT_ID=rbs.SUBJECT_ID ANd
		rbs.PROCESSCYCLEID=cmscase.CASECYCLE_ID
		ANd CASE_ID=#crn# AND upper(IS_AUTO_SAVED)=upper('N')
		
		<isNotNull property="subjectId">
			<isNotEqual prepend="AND" property="subjectId"
				compareValue="0">
				rbs.SUBJECT_ID=#subjectId# 
			</isNotEqual>
		</isNotNull>

		<isNotNull property="processCycleId">
			<isNotEqual prepend="AND" property="processCycleId"
				compareValue="0">
				rbs.PROCESSCYCLEID=#processCycleId# 
			</isNotEqual>
		</isNotNull>
		<isNotNull property="componentType">
			<isNotEqual prepend="AND" property="componentType" compareValue="">
				rbs.LBRE_COMP_TYPE=#componentType# 
			</isNotEqual>
		</isNotNull>
		</select>
	
		<!-- GCC History  -->
	<select id="getArticleText" resultClass="java.lang.String">
		select ARTICLE_TEXT from
		RG_LBRE_TABLE_TYPE1_DET_HST where history_id = #recordId#
	</select>

	<select id="getHistoryCount" resultClass="java.lang.Integer">
		SELECT count(*)
		FROM RG_LBRE_SUMMARY_HST
		rg where
		rg.LBRE_SUMMARY_ID=#recordId#
	</select>
	
	<select id="getById" resultMap="resultVO" >

		SELECT
		rbs.LBRE_SUMMARY_ID,rbs.SUBJECT_ID,rbs.PROCESSCYCLEID,rbs.CASE_ID,rbs.TEAM_ID,
		rbs.UPDATED_ON,rbs.UPDATED_BY, rbs.TABLE_NAME,rbs.TABLE_BOTTOM_NOTES,rbs.SAME_NAME_IND,TITLE,
		cs.REPORT_SUBJECT_NAME,cc.DESCRIPTION,rbs.LBRE_COMP_TYPE,
		rgdtl.LBRE_TABLE_TYPE2_DET_ID,
		rgdtl.ROW_NO,
		rgdtl.COLUMN_NO,
		rgdtl.FIELD_VALUE,
		rgdtl.LBRE_SUMMARY_ID
		FROM RG_LBRE_SUMMARY rbs 
		LEFT OUTER JOIN RG_LBRE_TABLE_TYPE2_DET rgdtl ON rgdtl.LBRE_SUMMARY_ID = rbs.LBRE_SUMMARY_ID
		JOIN CMS_CASECYCLE cc ON cc.CASECYCLE_ID = rbs.PROCESSCYCLEID
		JOIN RG_SUBJECT cs ON cs.SUBJECT_ID = rbs.SUBJECT_ID
		WHERE
		rbs.LBRE_SUMMARY_ID =#id#
		ORDER BY rgdtl.ROW_NO ASC, rgdtl.COLUMN_NO ASC
		
	</select>
	
	
	<!--generic query-->
	<select id="getSubProcCycleList" resultMap="ReportSubjectVO.subProcCycleList">

		select cs.subject_id subject_id, cs.subject_name subject_name, 'Interim 1'
		Process_Cycle , 2 Process_Cycle_Id from cms_clientcase cc
		join RG_SUBJECT cs on cs.CRN = cc.CRN
		where cc.CLIENT_INT_DUEDATE1 is not
		null
		AND
		cs.subject_id not in
		(select summarry.subject_id from RG_LBRE_SUMMARY summarry where
		summarry.subject_id = cs.subject_id and summarry.processcycleid = 2
		and upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn#
		UNION
		ALL
		select cs.subject_id subject_id, cs.subject_name subject_name,
		'Interim 2' Process_Cycle, 3 Process_Cycle_Id from cms_clientcase cc
		join RG_SUBJECT cs on cs.CRN = cc.CRN
		where cc.CLIENT_INT_DUEDATE2 is
		not null
		AND
		cs.subject_id not in
		(select summarry.subject_id from RG_LBRE_SUMMARY summarry where
		summarry.subject_id = cs.subject_id and summarry.processcycleid = 3
		and upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn#
		UNION
		ALL
		select cs.subject_id subject_id, cs.subject_name subject_name,
		'Final' Process_Cycle, 1 Process_Cycle_Id from cms_clientcase cc
		join RG_SUBJECT cs on cs.CRN = cc.CRN
		where cc.FINAL_DUE_DATE is not null
		AND
		cs.subject_id not in
		(select summarry.subject_id from RG_LBRE_SUMMARY summarry where
		summarry.subject_id = cs.subject_id and summarry.processcycleid = 1
		and upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn# order
		by subject_id, process_cycle_id
	</select>
	
	
	<select id="getProcessCycleList" parameterClass="java.util.HashMap"
		resultMap="ProcessCycleVO.processCycleList">
		select 'Interim 1' Process_Cycle , 2 Process_Cycle_Id from cms_clientcase cc
		where cc.CLIENT_INT_DUEDATE1 is not null
		AND
		NOT EXISTS
		(select
		summarry.LBRE_SUMMARY_ID from RG_LBRE_SUMMARY summarry
		where summarry.LBRE_SUMMARY_ID != #recordId# and summarry.subject_id = #subId#
		and summarry.processcycleid = 2 and
		upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn#
		UNION ALL
		select 'Interim 2' Process_Cycle, 3 Process_Cycle_Id from
		cms_clientcase cc
		where cc.CLIENT_INT_DUEDATE2 is not null
		AND
		NOT EXISTS
		(select summarry.LBRE_SUMMARY_ID from RG_LBRE_SUMMARY summarry
		where summarry.LBRE_SUMMARY_ID != #recordId# and summarry.subject_id = #subId#
		and summarry.processcycleid = 3 and
		upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn#
		UNION ALL
		select 'Final' Process_Cycle, 1 Process_Cycle_Id from cms_clientcase
		cc
		where cc.FINAL_DUE_DATE is not null
		AND
		NOT EXISTS
		(select
		summarry.LBRE_SUMMARY_ID from RG_LBRE_SUMMARY summarry
		where summarry.LBRE_SUMMARY_ID != #recordId# and summarry.subject_id = #subId#
		and summarry.processcycleid = 1 and
		upper(summarry.IS_AUTO_SAVED)=upper('N'))
		and cc.crn = #crn# order by
		process_cycle_id
</select>



	<insert id="insertAutoSave" parameterClass="com.worldcheck.juno.vo.component.LbreTypeTwoVO">
		<selectKey keyProperty="autoSaveId" resultClass="long">
			SELECT RG_LBRE_SUMMARY_SEQ.NEXTVAL from dual
		</selectKey>
		INSERT INTO RG_LBRE_SUMMARY
		(LBRE_SUMMARY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,TITLE,
		UPDATED_ON,UPDATED_BY,SAME_NAME_IND,IS_AUTO_SAVED,PARENT_RECORD_ID,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,LBRE_COMP_TYPE)
		VALUES
		(#autoSaveId#,#subjectId#,#processCycleId#,#crn#,#title#,sysdate,#updateBy#,
		#sameNameSubject#,'Y',#id#,'Y','Type 2',#lbreType#)
	</insert>

  <select id="getHistoryCountForCRN" resultClass="java.lang.Long" parameterClass="java.lang.String">  
  select count(*) from RG_LBRE_SUMMARY_HST where case_id=#crn#
  
  </select>
  
	<parameterMap id="getParameterMapIncExdReport" class="java.util.Map">
		<parameter property="includeExcludeIds" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="includeExcludeIdentifire" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="userCode" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="errorCode" jdbcType="INTEGER" javaType="java.lang.Integer"
			mode="OUT" />
	</parameterMap>


	<!--- Calling stored procedure -->
	<procedure id="callIncExdReport" parameterMap="getParameterMapIncExdReport">
		{call RG_PROC_IND_EXD_REPORT( ?, ?, ?,?,'LBRE','N','LBRE_SUMMARY_ID','N','N')} 
   </procedure>
     	<parameterMap id="getParameterMapResetTableName" class="java.util.Map">
		<parameter property="crn" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="processCycleId" jdbcType="INTEGER"
			javaType="java.lang.Long" mode="IN" />
		<parameter property="subjectId" jdbcType="INTEGER" javaType="java.lang.Long"
			mode="IN" />
		<parameter property="errorCode" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="OUT" />
	</parameterMap>


	<!--- Calling stored procedure -->
	<procedure id="callresetTableName" parameterMap="getParameterMapResetTableName">
		{call RG_PROC_RESET_TABLE_NAME( ?, ?, ?,?)} 
   </procedure>
	  <insert id="makeCopy"
		parameterClass="java.util.HashMap">

		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_LBRE_SUMMARY_SEQ.NEXTVAL from dual
		</selectKey>

		INSERT INTO RG_LBRE_SUMMARY
		(LBRE_SUMMARY_ID,SUBJECT_ID,PROCESSCYCLEID,CASE_ID,TABLE_NAME,UPDATED_ON,UPDATED_BY,
		TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,IS_AUTO_SAVED,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,TEAM_ID,LBRE_COMP_TYPE)
		select	#id#, SUBJECT_ID,#processCycleId#,CASE_ID,TABLE_NAME,
		sysdate,#updatedBy#,TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,IS_AUTO_SAVED,'Y',SUBCOMPONENT_NAME,TEAM_ID,LBRE_COMP_TYPE
		 from RG_LBRE_SUMMARY
		where LBRE_SUMMARY_ID=#recordId#
	</insert>
	
	<insert id="makeCopyDetails" parameterClass="java.util.HashMap">
		insert into
		RG_LBRE_TABLE_TYPE2_DET (
		LBRE_TABLE_TYPE2_DET_ID,
		ROW_NO,
		COLUMN_NO,
		FIELD_VALUE,
		LBRE_SUMMARY_ID
		)
		SELECT
		RG_LBRE_TBL_TY2_DET_SEQ.NEXTVAL,
		ROW_NO,
		COLUMN_NO,
		FIELD_VALUE,#genSumryId#
		from RG_LBRE_TABLE_TYPE2_DET
		Where
		LBRE_SUMMARY_ID=#recordId#
	</insert>
	<select id="checkIfExist" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(*) from RG_LBRE_SUMMARY where PROCESSCYCLEID=#processCycleId# and SUBJECT_ID = #subjectId#  and case_id=#crn#
		and upper(IS_AUTO_SAVED)=upper('N') and subcomponent_name = #subcomponentName#
	</select>
	
	
	<insert id="makeCopyHst"
		parameterClass="java.util.HashMap">
		<selectKey keyProperty="id" resultClass="long">
			SELECT
			RG_LBRE_SUMMARY_HST_SEQ.nextval from dual
		</selectKey>

		insert into RG_LBRE_SUMMARY_HST(HISTORY_ID ,
		LBRE_SUMMARY_ID ,SUBJECT_ID,
		PROCESSCYCLEID ,
		CASE_ID ,
		TABLE_NAME ,
		UPDATED_ON ,
		UPDATED_BY ,
		TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,TEAM_ID,LBRE_COMP_TYPE
		)

		select
		#id#,#genSumryId#, SUBJECT_ID,PROCESSCYCLEID,CASE_ID,TABLE_NAME,
		sysdate,#updatedBy#,TABLE_BOTTOM_NOTES,SAME_NAME_IND,TITLE,REPORT_INCLUDE_IND,SUBCOMPONENT_NAME,TEAM_ID,LBRE_COMP_TYPE from RG_LBRE_SUMMARY
		where LBRE_SUMMARY_ID = #recordId#
	</insert>
	
	<insert id="makeCopyDetailsHistory" parameterClass="java.util.HashMap">
		insert into
		RG_LBRE_TABLE_TYPE2_DET_HST
		(HISTORY_ID,LBRE_TABLE_TYPE2_DET_ID,LBRE_SUMMARY_ID,SUMMARY_HISTORY_ID,ROW_NO,COLUMN_NO,FIELD_VALUE)
		select
		RG_LBRE_TBL_TY2_DET_HST_SEQ.nextval,LBRE_TABLE_TYPE2_DET_ID,LBRE_SUMMARY_ID,#genHistoryId#,ROW_NO,COLUMN_NO,FIELD_VALUE
		from RG_LBRE_TABLE_TYPE2_DET where LBRE_SUMMARY_ID = #genSumryId#
	</insert>
	  
	<resultMap id="miniComponentRecord"
		class="com.worldcheck.juno.vo.component.LbreTypeTwoVO" groupBy="id">
		<result property="id" column="LBRE_SUMMARY_ID" />
		<result property="updateOn" column="UPDATED_ON" />
	</resultMap>

	<!--generic query-->
	<select id="getUpdationTimeById" resultMap="miniComponentRecord">
		SELECT
		rg.LBRE_SUMMARY_ID,
		rg.UPDATED_ON
		FROM RG_LBRE_SUMMARY rg
		WHERE
		rg.LBRE_SUMMARY_ID = #id#
	</select>
</sqlMap>

		