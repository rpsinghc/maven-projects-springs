<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="MSwordPasswordVO">

	<resultMap id="rptTypeVO" class="com.worldcheck.juno.vo.master.ReportTypeVO">
		<result property="rptId" column="REPORT_TYPE_ID" />
		<result property="rptName" column="REPORT_TYPE" />

	</resultMap>

	<resultMap id="result"
		class="com.worldcheck.juno.vo.master.MSwordPasswordVO">
		<result property="id" column="RPT_PWD_MST_ID" />
		<result property="password" column="PASSWORD" />
		<result property="rptTypeVO" resultMap="MSwordPasswordVO.rptTypeVO" />
		<result property="status" column="STATUS" />
	</resultMap>
	
	<resultMap id="resultHistory"
		class="com.worldcheck.juno.vo.master.MSwordPasswordVO">
		<result property="password" column="PASSWORD" />
		<result property="historyDate" column="historyDate" />
		<result property="id" column="HISTORY_ID" />
	</resultMap>

	<insert id="insert" parameterClass="com.worldcheck.juno.vo.master.MSwordPasswordVO">


		insert into
		RG_REPORT_PASSWORD_MASTER (
		RPT_PWD_MST_ID,
		REPORT_TYPE_ID,PASSWORD,UPDATED_BY,UPDATED_ON,STATUS
		)values (
		RG_REPORT_PASSWORD_MASTER_SEQ.NEXTVAL, #rptTypeVO.rptId#,
		#password#,#userName#,sysdate,#status#
		)        
	  </insert>


	<select id="searchPasswordMaster" resultMap="result"
		parameterClass="java.util.HashMap">
		SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
		select distinct
		rpm.RPT_PWD_MST_ID,rpm.PASSWORD,rpm.REPORT_TYPE_ID,
		rpm.status,
		rtm.REPORT_TYPE

		from
		CMS_REPORT_TYPE_MASTER rtm,RG_REPORT_PASSWORD_MASTER rpm
		where
		rtm.REPORT_TYPE_MASTER_ID = rpm.REPORT_TYPE_ID
		<isNotNull property="status">
			<isNotEqual prepend="AND" property="status" compareValue="">
				upper(rpm.STATUS)=upper(#status#)
					</isNotEqual>
		</isNotNull>

		<isNotNull property="rptId">
			<isNotEqual prepend="AND" property="rptId" compareValue="0">
				rpm.REPORT_TYPE_ID= #rptId#
					</isNotEqual>
		</isNotNull>
		order by rtm.REPORT_TYPE
		) a WHERE ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#
	</select>

	<select id="searchPasswordCount" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">
		select count(*)
		from
		CMS_REPORT_TYPE_MASTER rtm,RG_REPORT_PASSWORD_MASTER rpm
		where
		rtm.REPORT_TYPE_MASTER_ID = rpm.REPORT_TYPE_ID
		<isNotNull property="status">
			<isNotEqual prepend="AND" property="status" compareValue="">
				upper(rpm.STATUS)=upper(#status#)
					</isNotEqual>
		</isNotNull>

		<isNotNull property="rptId">
			<isNotEqual prepend="AND" property="rptId" compareValue="0">
				rpm.REPORT_TYPE_ID= #rptId#
					</isNotEqual>
		</isNotNull>
		order by rtm.REPORT_TYPE
	</select>
	
	<select id="getById" resultMap="result">
		select
		rpm.RPT_PWD_MST_ID,rpm.PASSWORD,rpm.REPORT_TYPE_ID,
		rpm.status,
		rtm.REPORT_TYPE
		from
		CMS_REPORT_TYPE_MASTER rtm,RG_REPORT_PASSWORD_MASTER rpm
		where
		rtm.REPORT_TYPE_MASTER_ID = rpm.REPORT_TYPE_ID AND rpm.RPT_PWD_MST_ID = #id#
	   
	   	
	  </select>

	<update id="update" parameterClass="com.worldcheck.juno.vo.master.MSwordPasswordVO">
		update
		RG_REPORT_PASSWORD_MASTER
		set
		PASSWORD = #password#,
		STATUS = #status#,
		UPDATED_BY = #userName#,
		UPDATED_ON = sysdate
		WHERE
		RPT_PWD_MST_ID = #id#
	  </update>

	<update id="deActivate" parameterClass="map">
		update RG_REPORT_PASSWORD_MASTER set
		STATUS ='0',
		UPDATED_ON = sysdate
		where
		RPT_PWD_MST_ID in 
		<iterate property="id" open="(" close=")" conjunction=",">
						#id[]#
	    </iterate>
	  </update>

	  <update id="activate" parameterClass="map">
		update RG_REPORT_PASSWORD_MASTER set
		STATUS ='1',
		UPDATED_ON = sysdate
		where
		RPT_PWD_MST_ID in 
		<iterate property="id" open="(" close=")" conjunction=",">
						#id[]#
	    </iterate>
	  </update>

	<select id="getMSHistory" resultMap="resultHistory">
		SELECT * FROM (SELECT  a.*, ROWNUM rn FROM (
			select
			psm.PASSWORD,
			to_char(HISTORY_DATE ,'DD MON YY  HH24:MI:SS') as historyDate,
			psm.HISTORY_ID
			from
			RG_REPORT_PASSWORD_MST_HST psm
			where
			psm.REPORT_TYPE_ID = #rptId#
			order by psm.HISTORY_DATE DESC
		) a WHERE ROWNUM <![CDATA[ <= ]]>
		#limit#) WHERE rn <![CDATA[ >= ]]>
		#start#
	   	
	  </select>

	<select id="getHistoryCount" resultClass="java.lang.Integer">
			select count(*)
			from
			RG_REPORT_PASSWORD_MST_HST psm
			where
			psm.REPORT_TYPE_ID = #rptId#
	</select>
	<insert id="insertHistory" parameterClass="map">


		insert into
		RG_REPORT_PASSWORD_MST_HST (
		HISTORY_ID,
		REPORT_TYPE_ID,RPT_PWD_MST_ID,PASSWORD,HISTORY_DATE
		)(select
		RG_REPORT_PASSWORD_MST_HST_SEQ.NEXTVAL, REPORT_TYPE_ID,RPT_PWD_MST_ID,
		PASSWORD,sysdate  from RG_REPORT_PASSWORD_MASTER psm where
		psm.REPORT_TYPE_ID =  #reportID#
		and psm.STATUS = #status#
		and psm.PASSWORD = #password#
		)
    </insert>
	<!-- Checking if password is already present-->
	<select id="checkIfexist" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">

		SELECT count(*)
		FROM RG_REPORT_PASSWORD_MASTER passMst
		WHERE
			passMst.STATUS = #status#  
		and
			passMst.REPORT_TYPE_ID=#rptId# 
		<!-- and
			passMst.PASSWORD=#password# -->
					
	</select>
	<!-- Checking if password is already present-->
	<select id="checkIfActiveExist" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">

		SELECT count(*)
		FROM RG_REPORT_PASSWORD_MASTER passMst
		WHERE
			passMst.STATUS = '1'  
		and
			passMst.REPORT_TYPE_ID=#rptId# 
		and
			passMst.PASSWORD=#password# 
		
					
	</select>
	
	<select id="checkReportStatus" resultClass="java.lang.Integer"
		parameterClass="java.util.HashMap">

		SELECT count(*)
		FROM RG_REPORT_PASSWORD_MASTER passMst
		WHERE
			passMst.STATUS = '1'  
		and
			passMst.REPORT_TYPE_ID=#rptId# 
		
		
					
	</select>
	
	
	<select id="getReportName" resultClass="java.lang.String" parameterClass="java.lang.Long">
		select REPORT_TYPE from CMS_REPORT_TYPE_MASTER  where
		REPORT_TYPE_MASTER_ID=#id#
	</select>

</sqlMap>
